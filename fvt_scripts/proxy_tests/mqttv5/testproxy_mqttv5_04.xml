<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2016-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
-->
<IsmWSTest name="testproxy_mqttv5_04" >

<SyncClient>
    <server>
        <include>../common/JMS_syncip.xml</include>
        <include>../common/JMS_syncport.xml</include>
    </server>
    <solution>testproxy_mqttv5_04</solution>
</SyncClient>


<Action name="clearSessions" type="CompositeAction">

    <Action name="CreateConnection-1" type="CreateConnection">
        <ActionParameter name="structure_id">Con1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-1</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-2" type="CreateConnection">
        <ActionParameter name="structure_id">Con2</ActionParameter>
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-2</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-3" type="CreateConnection">
        <ActionParameter name="structure_id">Con3</ActionParameter>
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-3</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-4" type="CreateConnection">
        <ActionParameter name="structure_id">Con4</ActionParameter>
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-4</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-5" type="CreateConnection">
        <ActionParameter name="structure_id">Con5</ActionParameter>
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-5</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-6" type="CreateConnection">
        <ActionParameter name="structure_id">Con6</ActionParameter>
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-6</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-7</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-8" type="CreateConnection">
        <ActionParameter name="structure_id">Con8</ActionParameter>
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-8</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="SubscriptionMonitor" type="RestAPI">
        <dependsOn action_id="CreateConnection-8" interval="5000"/>
        <ActionParameter name="structureID">status_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client04*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="ClientMonitor" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client04*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="CloseConnection1" type="CloseConnection">
        <dependsOn action_id="ClientMonitor" interval="2000"/>
        <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>
    <Action name="CloseConnection2" type="CloseConnection">
        <ActionParameter name="connection_id">CF2</ActionParameter>
    </Action>
    <Action name="CloseConnection3" type="CloseConnection">
        <ActionParameter name="connection_id">CF3</ActionParameter>
    </Action>
    <Action name="CloseConnection4" type="CloseConnection">
        <ActionParameter name="connection_id">CF4</ActionParameter>
    </Action>
    <Action name="CloseConnection5" type="CloseConnection">
        <ActionParameter name="connection_id">CF5</ActionParameter>
    </Action>
    <Action name="CloseConnection6" type="CloseConnection">
        <ActionParameter name="connection_id">CF6</ActionParameter>
    </Action>
    <Action name="CloseConnection7" type="CloseConnection">
        <ActionParameter name="connection_id">CF7</ActionParameter>
    </Action>
    <Action name="CloseConnection8" type="CloseConnection">
        <ActionParameter name="connection_id">CF8</ActionParameter>
    </Action>

    <Action name="SubscriptionMonitor2" type="RestAPI">
        <dependsOn action_id="CloseConnection8" interval="5000"/>
        <ActionParameter name="structureID">status_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client04*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="ClientMonitor2" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client04*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

</Action>







<Action name="Test" type="CompositeAction">
    <!-- nondurable -->
    <Action name="CreateConnection-1" type="CreateConnection">
        <ActionParameter name="structure_id">Con1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-1</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <!-- <ApiParameter name="sessionExpire">0</ApiParameter> -->
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- nondurable -->
    <Action name="CreateConnection-2" type="CreateConnection">
        <ActionParameter name="structure_id">Con2</ActionParameter>
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-2</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <!-- <ApiParameter name="sessionExpire">0</ApiParameter> -->
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- nondurable -->
    <Action name="CreateConnection-3" type="CreateConnection">
        <ActionParameter name="structure_id">Con3</ActionParameter>
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-3</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- nondurable -->
    <Action name="CreateConnection-4" type="CreateConnection">
        <ActionParameter name="structure_id">Con4</ActionParameter>
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-4</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-5" type="CreateConnection">
        <ActionParameter name="structure_id">Con5</ActionParameter>
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-5</ApiParameter>
        		<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-6" type="CreateConnection">
        <ActionParameter name="structure_id">Con6</ActionParameter>
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-6</ApiParameter>
				<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-7</ApiParameter>
				<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-8" type="CreateConnection">
        <ActionParameter name="structure_id">Con8</ActionParameter>
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <ApiParameter name="clientId">v5client04-8</ApiParameter>
				<include>../common/PROXY_port.xml</include>
        <!-- In MQTTv5 cleanSession means cleanStart -->
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>



<!--     <Action name="sync_components_1" type="SyncComponentAction"> 
        <ActionParameter name="component_name">pub</ActionParameter>
        <ActionParameter name="component_list">pub;sub</ActionParameter>
        <ActionParameter name="timeout">15000</ActionParameter>
    </Action> -->


    <Action name="Subscribe1" type="Subscribe">
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ApiParameter name="topic">mqttv5-04/topic1</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe2" type="Subscribe">
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ApiParameter name="topic">mqttv5-04/topic2</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe3" type="Subscribe">
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ApiParameter name="topic">mqttv5-04/topic3</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe4" type="Subscribe">
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ApiParameter name="topic">mqttv5-04/topic4</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe5" type="Subscribe">
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ApiParameter name="topic">mqttv5-04/topic5</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe6" type="Subscribe">
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ApiParameter name="topic">mqttv5-04/topic6</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe7" type="Subscribe">
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ApiParameter name="topic">mqttv5-04/topic7</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe8" type="Subscribe">
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ApiParameter name="topic">mqttv5-04/topic8</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>





    <Action name="SubscriptionMonitor" type="RestAPI">
        <dependsOn action_id="Subscribe8" interval="5000"/>
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client04*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="VerifyDurable-1" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-1</ActionParameter>
        <!-- <ObjectProperty name="IsShared" value="true"/> -->
        <!-- <ObjectProperty name="TopicString" value="ErrorTopic/+"/> -->
        <!-- <ObjectProperty name="Consumers" value="1"/> -->
        <ObjectProperty name="IsDurable" value="false"/>
    </Action>   

    <Action name="VerifyDurable-2" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-2</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 
    <Action name="VerifyDurable-3" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-3</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 
    <Action name="VerifyDurable-4" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-4</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 
    <Action name="VerifyDurable-5" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-5</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-6" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-6</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-7" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-7</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-8" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-8</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 

    <Action name="ClientMonitor" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client04*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>




    <!-- session deleted immediately -->
    <Action name="CloseConnection1" type="CloseConnection">
        <dependsOn action_id="ClientMonitor" interval="5000"/>
        <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>

    <!-- session deleted immediately -->
    <Action name="CloseConnection2" type="CloseConnection">
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>

    <!-- session deleted immediately -->
    <Action name="CloseConnection3" type="CloseConnection">
        <ActionParameter name="connection_id">CF3</ActionParameter>
    </Action>

    <!-- session deleted immediately -->
    <Action name="CloseConnection4" type="CloseConnection">
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>

    <!-- DURABLE Sessions clients 5 thru 8 -->
	<!-- session deleted immediately -->
    <Action name="CloseConnection5" type="CloseConnection">
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>

    <!-- session deleted after 30 seconds -->
    <Action name="CloseConnection6" type="CloseConnection">
        <ActionParameter name="connection_id">CF6</ActionParameter>
    </Action>

    <!-- session persisted -->
    <Action name="CloseConnection7" type="CloseConnection">
        <ActionParameter name="connection_id">CF7</ActionParameter>
    </Action>

    <!-- session deleted immediately -->
    <Action name="CloseConnection8" type="CloseConnection">
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>





    <Action name="ClientMonitor-after10s" type="RestAPI">
        <dependsOn action_id="CloseConnection8" interval="10000"/>
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client04*%26ResultCount=50%26ConnectionState=All</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <!-- NonDurable or Force Expire on Close -->
    <Action name="VerifyClientExpiresAfter10-1" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-1</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClientExpiresAfter10-2" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-2</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClientExpiresAfter10-3" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-3</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClientExpiresAfter10-4" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-4</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClientExpiresAfter10-5" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-5</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClientExpiresAfter10-8" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-8</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    
    <!-- Durable Sessions remaining after 10 sec -->
    <Action name="VerifyClientPersistAfter10-6" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-6</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  
    <Action name="VerifyClientPersistAfter10-7" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-7</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  


    <Action name="ClientMonitor-after40s" type="RestAPI">
        <dependsOn action_id="VerifyClientPersistAfter10-7" interval="40000"/>
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client04*%26ResultCount=50%26ConnectionState=All</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <!-- Client 6 session expires, Client 7 is forever -->
    <Action name="VerifyClientExpiresAfter40-6" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-6</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  
    <Action name="VerifyClientPersistAfter40-7" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client04-7</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  
    <!-- remove Lingering Durable Subscription -->
    <Action name="CleanUpConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <include>../common/PROXY_server.xml</include>
        		<include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client04-7</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CloseCleanUpConnection7" type="CloseConnection">
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>

</Action>




</IsmWSTest>
                
