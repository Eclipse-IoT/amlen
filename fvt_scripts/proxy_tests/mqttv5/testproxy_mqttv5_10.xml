<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2016-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
-->
<IsmWSTest name="testproxy_mqttv5_10" >

<Action name="clearSessions" type="CompositeAction">
    <!-- clean sessions before test starts -->
    <Action name="CreateConnection-1" type="CreateConnection">
        <ActionParameter name="structure_id">Con1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-1</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-2" type="CreateConnection">
        <ActionParameter name="structure_id">Con2</ActionParameter>
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-2</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-3" type="CreateConnection">
        <ActionParameter name="structure_id">Con3</ActionParameter>
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-3</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-4" type="CreateConnection">
        <ActionParameter name="structure_id">Con4</ActionParameter>
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-4</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-5" type="CreateConnection">
        <ActionParameter name="structure_id">Con5</ActionParameter>
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-5</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-6" type="CreateConnection">
        <ActionParameter name="structure_id">Con6</ActionParameter>
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-6</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-7</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-8" type="CreateConnection">
        <ActionParameter name="structure_id">Con8</ActionParameter>
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-8</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-9" type="CreateConnection">
        <ActionParameter name="structure_id">Con9</ActionParameter>
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-9</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-10" type="CreateConnection">
        <ActionParameter name="structure_id">Con10</ActionParameter>
        <ActionParameter name="connection_id">CF10</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-10</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-11" type="CreateConnection">
        <ActionParameter name="structure_id">Con11</ActionParameter>
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-11</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="SubscriptionMonitor" type="RestAPI">
        <dependsOn action_id="CreateConnection-8" interval="5000"/>
        <ActionParameter name="structureID">status_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client01*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="ClientMonitor" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="CloseConnection1" type="CloseConnection">
        <dependsOn action_id="CreateConnection-1" interval="2000"/>
        <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>
    <Action name="CloseConnection2" type="CloseConnection">
        <ActionParameter name="connection_id">CF2</ActionParameter>
    </Action>
    <Action name="CloseConnection3" type="CloseConnection">
        <ActionParameter name="connection_id">CF3</ActionParameter>
    </Action>
    <Action name="CloseConnection4" type="CloseConnection">
        <ActionParameter name="connection_id">CF4</ActionParameter>
    </Action>
    <Action name="CloseConnection5" type="CloseConnection">
        <ActionParameter name="connection_id">CF5</ActionParameter>
    </Action>
    <Action name="CloseConnection6" type="CloseConnection">
        <ActionParameter name="connection_id">CF6</ActionParameter>
    </Action>
    <Action name="CloseConnection7" type="CloseConnection">
        <ActionParameter name="connection_id">CF7</ActionParameter>
    </Action>
    <Action name="CloseConnection8" type="CloseConnection">
        <ActionParameter name="connection_id">CF8</ActionParameter>
    </Action>
    <Action name="CloseConnection9" type="CloseConnection">
        <ActionParameter name="connection_id">CF9</ActionParameter>
    </Action>
    <Action name="CloseConnection10" type="CloseConnection">
        <ActionParameter name="connection_id">CF10</ActionParameter>
    </Action>
    <Action name="CloseConnection11" type="CloseConnection">
        <ActionParameter name="connection_id">CF11</ActionParameter>
    </Action>


    <Action name="SubscriptionMonitor2" type="RestAPI">
        <dependsOn action_id="CloseConnection8" interval="5000"/>
        <ActionParameter name="structureID">status_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client01*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="ClientMonitor2" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

</Action>







<Action name="Test" type="CompositeAction">

    <Action name="CreateConnection-1" type="CreateConnection">
        <ActionParameter name="structure_id">Con1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-1</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <!-- <ApiParameter name="sessionExpire">0</ApiParameter> -->
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>


    <Action name="CreateConnection-2" type="CreateConnection">
        <ActionParameter name="structure_id">Con2</ActionParameter>
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-2</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-3" type="CreateConnection">
        <ActionParameter name="structure_id">Con3</ActionParameter>
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-3</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-4" type="CreateConnection">
        <ActionParameter name="structure_id">Con4</ActionParameter>
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-4</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-5" type="CreateConnection">
        <ActionParameter name="structure_id">Con5</ActionParameter>
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-5</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-6" type="CreateConnection">
        <ActionParameter name="structure_id">Con6</ActionParameter>
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-6</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-7</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-8" type="CreateConnection">
        <ActionParameter name="structure_id">Con8</ActionParameter>
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-8</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-9" type="CreateConnection">
        <ActionParameter name="structure_id">Con9</ActionParameter>
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-9</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-10" type="CreateConnection">
        <ActionParameter name="structure_id">Con10</ActionParameter>
        <ActionParameter name="connection_id">CF10</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-10</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CreateConnection-11" type="CreateConnection">
        <ActionParameter name="structure_id">Con11</ActionParameter>
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-11</ApiParameter>

        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="Subscribe1" type="Subscribe">
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic1</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe2" type="Subscribe">
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic2</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe3" type="Subscribe">
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic3</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe4" type="Subscribe">
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic4</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe5" type="Subscribe">
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic5</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe6" type="Subscribe">
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic6</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe7" type="Subscribe">
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic7</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe8" type="Subscribe">
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic8</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe9" type="Subscribe">
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic9</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe10" type="Subscribe">
        <ActionParameter name="connection_id">CF10</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic10</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe11" type="Subscribe">
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic11</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>



    <Action name="SubscriptionMonitor" type="RestAPI">
        <dependsOn action_id="Subscribe1" interval="5000"/>
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client01*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="VerifyDurable-1" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-1</ActionParameter>
        <!-- <ObjectProperty name="IsShared" value="true"/> -->
        <!-- <ObjectProperty name="TopicString" value="ErrorTopic/+"/> -->
        <!-- <ObjectProperty name="Consumers" value="1"/> -->
        <ObjectProperty name="IsDurable" value="false"/>
    </Action>   

    <Action name="VerifyDurable-2" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-2</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 
    <Action name="VerifyDurable-3" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-3</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-4" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-4</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-5" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-5</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-6" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-6</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-7" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-7</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-8" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-8</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-9" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-9</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-10" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-10</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-11" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-11</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 

    <Action name="ClientMonitor" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>



    <!-- kill server here -->





    <!-- crash a1 non-gracefully (shell action) -->
    <Action name="KillServer" type="ShellAction">
        <dependsOn action_id="ClientMonitor" interval="5000"/>
        <ActionParameter name="command">../scripts/cluster.py -a killClusterMember -m 1 -v 2 -f testmqtt_mqttv5_10.killServer.log</ActionParameter>
        <ActionParameter name="print_result">1</ActionParameter>
    </Action>



    <Action name="StartServer" type="ShellAction">
        <dependsOn action_id="KillServer" interval="10000" />
        <ActionParameter name="command">../scripts/serverControl.sh -a startServer -i 1 -t 20</ActionParameter>  
        <ActionParameter name="print_result">true</ActionParameter>
    </Action>


    <Action name="ReCreateConnection-3" type="CreateConnection">
        <dependsOn action_id="StartServer" interval="10000" />
        <ActionParameter name="structure_id">Con3</ActionParameter>
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-3</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="ReCreateConnection-4" type="CreateConnection">
        <ActionParameter name="structure_id">Con4</ActionParameter>
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-4</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <!-- <ApiParameter name="sessionExpire">30</ApiParameter> -->
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>


    <Action name="ReCreateConnection-5" type="CreateConnection">
        <ActionParameter name="structure_id">Con5</ActionParameter>
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-5</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="ReCreateConnection-6" type="CreateConnection">
        <ActionParameter name="structure_id">Con6</ActionParameter>
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-6</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <!-- <ApiParameter name="sessionExpire">30</ApiParameter> -->
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="ReCreateConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-7</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="ReCreateConnection-8" type="CreateConnection">
        <ActionParameter name="structure_id">Con8</ActionParameter>
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-8</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <!-- <ApiParameter name="sessionExpire">30</ApiParameter> -->
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="ReCreateConnection-9" type="CreateConnection">
        <ActionParameter name="structure_id">Con9</ActionParameter>
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-9</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="ReCreateConnection-10" type="CreateConnection">
        <ActionParameter name="structure_id">Con10</ActionParameter>
        <ActionParameter name="connection_id">CF10</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-10</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>


    <Action name="ReCreateConnection-11" type="CreateConnection">
        <ActionParameter name="structure_id">Con11</ActionParameter>
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/PROXY_server.xml</include>
        <include>../common/PROXY_port.xml</include>
        <ApiParameter name="clientId">v5client01-11</ApiParameter>

        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>


    <Action name="ClientMonitor-afterFailover" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>


    <Action name="VerifyClientPersist-1" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-1</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>   

    <Action name="VerifyClientPersist-2" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-2</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  

    <Action name="VerifyClientPersist-3" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-3</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  

    <Action name="VerifyClientPersist-4" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-4</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  

    <Action name="VerifyClientPersist-5" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-5</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  

    <Action name="VerifyClientPersist-6" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-6</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  

    <Action name="VerifyClientPersist-7" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-7</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  

    <Action name="VerifyClientPersist-8" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-8</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  

    <Action name="VerifyClientPersist-9" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-9</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  

    <Action name="VerifyClientPersist-10" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-10</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  

    <Action name="VerifyClientPersist-11" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-11</ActionParameter>
        <ObjectProperty name="IsConnected" value="true"/>
    </Action>  




    <Action name="CloseConnection3" type="CloseConnection">
        <dependsOn action_id="ClientMonitor-afterFailover" interval="10000" />
        <ActionParameter name="connection_id">CF3</ActionParameter>
    </Action>

    <Action name="CloseConnection4" type="CloseConnection">
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>

    <Action name="CloseConnection5" type="CloseConnection">
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>

    <Action name="CloseConnection6" type="CloseConnection">
        <ActionParameter name="connection_id">CF6</ActionParameter>
    </Action>

    <Action name="CloseConnection7" type="CloseConnection">
        <ActionParameter name="connection_id">CF7</ActionParameter>
    </Action>

    <Action name="CloseConnection8" type="CloseConnection">
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>

    <Action name="CloseConnection9" type="CloseConnection">
        <ActionParameter name="connection_id">CF9</ActionParameter>
    </Action>

    <Action name="CloseConnection10" type="CloseConnection">
        <ActionParameter name="connection_id">CF10</ActionParameter>
    </Action>

    <Action name="CloseConnection11" type="CloseConnection">
        <ActionParameter name="connection_id">CF11</ActionParameter>
    </Action>




    <Action name="ClientMonitor-after10s" type="RestAPI">
        <dependsOn action_id="CloseConnection3" interval="10000"/>
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=All</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="VerifyClientPersist-6-after10" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-6</ActionParameter>
        <!-- <ObjectProperty name="IsShared" value="true"/> -->
        <!-- <ObjectProperty name="TopicString" value="ErrorTopic/+"/> -->
        <!-- <ObjectProperty name="Consumers" value="1"/> -->
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>   

    <Action name="VerifyClientPersist-7-after10" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-7</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  

<!--     <Action name="VerifyClientPersist-10-after10" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-10</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>   -->




    <Action name="ClientMonitor-after40s" type="RestAPI">
        <dependsOn action_id="CloseConnection3" interval="40000"/>
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=All</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="VerifyClientPersist-6-after40" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-6</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  
    <Action name="VerifyClientPersist-7-after40" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-7</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  

    <Action name="VerifyClientPersist-11-after40" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-11</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  

    <Action name="SubscriptionMonitorAfterSessionExpires" type="RestAPI">
        <ActionParameter name="structureID">status_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

</Action>




</IsmWSTest>
                
