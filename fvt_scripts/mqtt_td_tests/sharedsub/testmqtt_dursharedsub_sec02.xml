<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2013-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
-->
<!--
	This test will test a large set of various authorizations allow or do not
	allow the appropriate access to a SharedDurableSubscription in MQTT.   
	
	The test variations joining an existing Shared Subscriptions with MQTT,
	
	These require a TopicPolicy and a SubscriptionPolicy 
	
	Note: per design change, and different from JMS, an unsubscribe of the 
	last MQTT Subscriber will cause the subscription to be deleted even if the
	client does not have "Control" authority on a Subscription policy, unless 
	JMS has registered an interest in the same shared Subscription.  
	
	
	See the setupSS section of Policy_config.cli for mqtt 
	
	The topic being used is: 
	
	$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1
	
	Each variation uses a short code of the form Y_X in the name where: 
	
	Y is the authority granted on the Subscription policy as follows: 
	
		C = Control only
		CR = Control and Receive
		R = Receive only
		N = None
		
		The Subscription Policy is different on each of the four Endpoints used. 
		
	X is the authority granted via the Topic Policy as follows: 
	
		P = Publish only
		S = Subsribe only
		PS = Publish and Subscribe
		N = None
		
		The Topic policy is different for each userid used.  
-->

<IsmWSTest name="testmqtt_dursharedsub_sec02" >
	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionClear1" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
        <ApiParameter name="port">29310</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionClear1" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>
    
	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionClear2" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
    	<ApiParameter name="port">29311</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionClear2" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>    
    
	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionClear3" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
	    <ApiParameter name="port">29312</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionClear3" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action> 

	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionClear4" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
	    <ApiParameter name="port">29313</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionClear4" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action> 
    
	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionClearSetup" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionClearSetup" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>    
    
     <!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionClearSetup_sameClient" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec02</ApiParameter>
	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionClearSetup_sameClient" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>     
 
	<!-- *************************************************************************** -->
	<!-- Section Setup: Create the DurableSharedSubscription, using the Demo Policy which has all access.
		ClientID is one which will be used for 'reconnect client to same subscription' --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_Setup" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Create a Subscription that we be used for reconnect client testing.   --> 
	<Action name="Subscribe_Setup" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Should have one consumer on this subscription.  --> 
	<!-- Action name="ShowSubCreated_Setup" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=MQTTDSS_SecSub02 ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->
	
	<Action name="ShowSubCreated_Setup" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_Setup</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowSubCreated_Setup" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		   	

	<Action name="CloseConnection_Setup" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	<!-- Should have no consumer on this subscription.  -->  
	<!-- Action name="ShowSubCreated_Setup_NoConsumers" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=MQTTDSS_SecSub02 ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->
	
	<Action name="ShowSubCreated_Setup_NoConsumers" type="RestAPI">
		<dependsOn action_id="CloseConnection_Setup" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup2</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowSubCreated_Setup_NoConsumers" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup2</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		  	
	 
	<!-- *************************************************************************** -->
	<!-- Section Setup2: Create another DurableSharedSubscription, using the Demo Policy which has all access.
	     ClientID is one different, so we can join this subscription as a 2nd consumer. --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_Setup2" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec02</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Create another subscription.. using a different clientID so we can test joining an existing SharedDurableSubscription  --> 
	<Action name="Subscribe_Setup2" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!-- Should have one consumer on this subscription.  --> 
	<!-- Action name="ShowSub2Created_Setup" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=MQTTDSS_SecSub02b ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->
	
	<Action name="ShowSub2Created_Setup" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_Setup2</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowSub2Created_Setup" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup2</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 	

	<Action name="CloseConnection_Setups" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	<!-- Should have no consumer on this subscription.  -->  
	<!-- Action name="ShowSubsCreated_Setups_NoConsumers" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=MQTTDSS_SecSub02b ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->
	
	<Action name="ShowSubsCreated_Setups_NoConsumers" type="RestAPI">
		<dependsOn action_id="CloseConnection_Setups" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup2</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubsCreated_Setups_NoConsumers" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup2</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 		 
	   

	<!-- *************************************************************************** -->
	<!-- Section 1: There are 2 existing DurableSharedSubscriptions. Now we create a consumer
	with clientID=MQTTDSS_clientIDSec01. It should attempt to reconnect to the Subname=MQTTDSS_SecSub02, 
	and we'll try to subscribe to  Subname=MQTTDSS_SecSub02 with various authority on Topic and Messaging Policy --> 
	<!-- **************************************************************************** -->
    
	<!-- Show the Endpoint --> 
	<!-- Action name="ShowEndpoint1_1" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver show Endpoint  Name=MQTTDSSEndpoint2  </ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
	<Action name="ShowEndpoint1_1" type="RestAPI">
    	    <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/configuration/Endpoint/MQTTDSSEndpoint2</ActionParameter>
	        <ActionParameter name="action">GET</ActionParameter>
    	    <ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
	        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    	    <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>            

   	<!-- Show the Policies --> 

	<Action name="ShowPolicy1_1" type="RestAPI">
    	    <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/configuration/SubscriptionPolicy/MQTTDSSSubPolicyBoth</ActionParameter>
	        <ActionParameter name="action">GET</ActionParameter>
    	    <ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
	        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    	    <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>     
	
  	<!-- Show the Policies --> 
	<Action name="ShowPolicy2_1" type="RestAPI">
    	    <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/configuration/TopicPolicy/MQTTDSSMessagingPolicySub</ActionParameter>
	        <ActionParameter name="action">GET</ActionParameter>
    	    <ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
	        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    	    <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>     
	
   	<!-- Show the Policies --> 
	<Action name="ShowPolicy3_1" type="RestAPI">
    	    <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/configuration/TopicPolicy/MQTTDSSMessagingPolicyPub</ActionParameter>
	        <ActionParameter name="action">GET</ActionParameter>
    	    <ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
	        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    	    <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>    
	
   	<!-- Show the Policies --> 
	<Action name="ShowPolicy4_1" type="RestAPI">
    	    <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/configuration/SubscriptionPolicy/MQTTDSSSubPolicyControl</ActionParameter>
	        <ActionParameter name="action">GET</ActionParameter>
    	    <ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
	        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    	    <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>    		
    
    <!-- C_PS means Subscription has actions Control, Topic has Publish,Subscribe --> 
       	
	<Action name="CreateConnection_C_PS" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29311</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_Both</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- We can tell it failed to reconnect the subscription, if the Stat Subscription shows 0 active consumers. Which is checked in comparelogs. --> 
	<Action name="ShowSubZeroConsumers_C_PS_before" type="RestAPI">
		<dependsOn action_id="CreateConnection_C_PS" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_C_PS_before</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubZeroConsumers_C_PS_before" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_C_PS_before</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 		 	

	<!-- On the CreateConnection, we should have automatically tried (and failed) 
	to access the this subscription subscription. Now try to resubscribe. This userid and port have Control access on the Subscription, and Pub/Sub on the Topic
		And the result is interesting. We unsubscribe from the subscription that we had just a moment before. This 
		wasn't part of the original design, but was determined to be an acceptable behavior.   --> 
	<Action name="Subscribe_C_PS" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- As mentioned above, this causes the subscription to be deleted (no subscribers are left)  --> 
	<Action name="ShowSubGoneafter_Resubscribe_C_PS" type="RestAPI">
		<dependsOn action_id="Subscribe_C_PS" interval="150"/>
        <ActionParameter name="structureID">Resubscribe_C_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubGoneafter_Resubscribe_C_PS" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">Resubscribe_C_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>	
	
	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to resubscribe this userid and port have Control access on the Subscription, and Pub/Sub on the Topic
		Expected result: Subscribe will silently fail since there is no "receive" on the SubscriptionMessagingPoicy.  --> 
	<Action name="Subscribe2_C_PS" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- We can tell it failed, if the Stat Subscription shows 0 active consumers. Which is checked in comparelogs. The difference
	between this case and the one above, is that there is another interested consumer for the 2b subscription. So
	it better not delete this one.  --> 
	<!-- Action name="ShowSubZeroConsumers2_C_PS" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=MQTTDSS_SecSub02b ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->
	
	<Action name="ShowSubZeroConsumers2_C_PS" type="RestAPI">
		<dependsOn action_id="Subscribe2_C_PS" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_C_PS_after</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubZeroConsumers2_C_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_C_PS_after</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 		 	

	<Action name="CloseConnection_C_PS" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	
	 <!-- C_P means Subscription has actions Control, Topic has Publish --> 
	 
	 <!-- ************ because it gets deleted above -->
	 
	<!-- *************************************************************************** -->
	<!-- Section Setup: Create the DurableSharedSubscription, using the Demo Policy which has all access.
		ClientID is one which will be used for 'reconnect client to same subscription' --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_SetupA" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	
	
	<!-- Should have no subscription.  -->  
	<Action name="Shownosub_Setup_NoConsumersA" type="RestAPI">
		<dependsOn action_id="CreateConnection_SetupA" interval="150"/>
        <ActionParameter name="structureID">Shownosub_Setup_NoConsumersA</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShownosub_Setup_NoConsumersA" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">Shownosub_Setup_NoConsumersA</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>						 	

	<!-- Create a Subscription that we be used for reconnect client testing.   --> 
	<Action name="Subscribe_SetupA" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Should have one consumer on this subscription.  --> 
	<Action name="ShowSubCreated_SetupA" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_SetupA</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_SetupA" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupA</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		

	<Action name="CloseConnection_SetupA" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubCreated_Setup_NoConsumersA" type="RestAPI">
		<dependsOn action_id="CloseConnection_SetupA" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersA</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_Setup_NoConsumersA" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersA</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>				 
       	
	<Action name="CreateConnection_C_P" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29311</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_Pub</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	
	
	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubZeroConsumers_C_P_before" type="RestAPI">
		<dependsOn action_id="CreateConnection_C_P" interval="150"/>
        <ActionParameter name="structureID">ShowSubZeroConsumers_C_P_before</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubZeroConsumers_C_P_before" type="CompareREST">
        <ActionParameter name="structureID">ShowSubZeroConsumers_C_P_before</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 
       		
	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to resubscribe.
		Expected result: Subscribe will silently fail since there is no "receive" on the SubscriptionMessagingPoicy.  --> 
	<Action name="Subscribe_C_P" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>

	<!-- Deleted the subscription. --> 
	<Action name="ShowDeleted_C_P_MightChange" type="RestAPI">
		<dependsOn action_id="Subscribe_C_P" interval="150"/>
        <ActionParameter name="structureID">ShowDeleted_C_P_MightChange</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowDeleted_C_P_MightChange" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowDeleted_C_P_MightChange</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>				
	
	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to resubscribe after
	the subscription was deleted two steps earlier.
		Expected result: Subscribe will silently fail since there is no "receive" on the SubscriptionMessagingPoicy.  --> 
	<Action name="Subscribe1A_C_P" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!--Failed to create a subscription. --> 
	<Action name="ShowSubNotCreated_C_P" type="RestAPI">
		<dependsOn action_id="Subscribe1A_C_P" interval="150"/>
        <ActionParameter name="structureID">ShowSubNotCreated_C_P</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubNotCreated_C_P" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowSubNotCreated_C_P</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>			
	
	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to unsubscribe.
		Expected result: unSubscribe will silently fail since there is no Subscription.  --> 
	<Action name="UnSubscribe_C_P" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>		
	
	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to resubscribe this userid and port have Control access on the Subscription, and Pub/Sub on the Topic
		Expected result: Subscribe will silently fail since there is no "receive" on the SubscriptionMessagingPoicy.  --> 
	<Action name="Subscribe2_C_P" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- We can tell it failed, if the Stat Subscription shows 0 active consumers.  --> 
	<Action name="ShowSubZeroConsumers2_C_P" type="RestAPI">
        <ActionParameter name="structureID">ShowSubZeroConsumers_C_P_after</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubZeroConsumers2_C_P" type="CompareREST">
        <ActionParameter name="structureID">ShowSubZeroConsumers_C_P_after</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		  
	
	<Action name="CloseConnection_C_P" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
   <!-- C_S means Subscription has actions Control, Topic has Subscribe --> 
   
	<!-- *************************************************************************** -->
	<!-- Section Setup: Create the DurableSharedSubscription, using the Demo Policy which has all access.
		ClientID is one which will be used for 'reconnect client to same subscription' --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_SetupB" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Create a Subscription that we be used for reconnect client testing.   --> 
	<Action name="Subscribe_SetupB" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Should have one consumer on this subscription.  --> 
	<Action name="ShowSubCreated_SetupB" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_SetupB</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_SetupB" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupB</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		  	

	<Action name="CloseConnection_SetupB" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubCreated_Setup_NoConsumersB" type="RestAPI">
		<dependsOn action_id="CloseConnection_SetupB" interval="150"/>
        <ActionParameter name="structureID">Setup_NoConsumersB</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_Setup_NoConsumersB" type="CompareREST">
        <ActionParameter name="structureID">Setup_NoConsumersB</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		    
       	
	<Action name="CreateConnection_C_S" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29311</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_Sub</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubZeroConsumers_C_S_before" type="RestAPI">
		<dependsOn action_id="CreateConnection_C_S" interval="150"/>
        <ActionParameter name="structureID">ShowSubZeroConsumers_C_S_before</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowSubZeroConsumers_C_S_before" type="CompareREST">
        <ActionParameter name="structureID">ShowSubZeroConsumers_C_S_before</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 		 

	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to resubscribe.
		Expected result: Subscribe will silently fail since there is no "receive" on the SubscriptionMessagingPoicy.  --> 
	<Action name="Subscribe_C_S" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!-- Deleted the subscription. --> 
	<Action name="ShowDeleted_C_S" type="RestAPI">
		<dependsOn action_id="Subscribe_C_S" interval="150"/>
        <ActionParameter name="structureID">ShowDeleted_C_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowDeleted_C_S" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowDeleted_C_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>		  		

	<Action name="Unsubscribe_C_S" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to resubscribe this userid and port have Control access on the Subscription, and Pub/Sub on the Topic
		Expected result: Subscribe will silently fail since there is no "receive" on the SubscriptionMessagingPoicy. But does 
		create the DurableSharedSubscription.  --> 
	<Action name="Subscribe2_C_S" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- We can tell it did that strange thing if the Stat Subscription shows 0 active consumers. Which is checked in comparelogs. --> 
	<Action name="ShowSubZeroConsumers2_C_S" type="RestAPI">
		<dependsOn action_id="Subscribe2_C_S" interval="150"/>
        <ActionParameter name="structureID">ShowSubZeroConsumers2_C_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubZeroConsumers2_C_S" type="CompareREST">
        <ActionParameter name="structureID">ShowSubZeroConsumers2_C_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		   	 
	
	<Action name="CloseConnection_C_S" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>		
   
  <!-- C_N means Subscription has actions Control, User has no authority on the Topic --> 
  
   
	<!-- *************************************************************************** -->
	<!-- Section Setup: Create the DurableSharedSubscription, using the Demo Policy which has all access.
		ClientID is one which will be used for 'reconnect client to same subscription' --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_SetupC" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Create a Subscription that we be used for reconnect client testing.   --> 
	<Action name="Subscribe_SetupC" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Should have one consumer on this subscription.  --> 
	<Action name="ShowSubCreated_SetupC" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_SetupC</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareSShowSubCreated_SetupC" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupC</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>

	<Action name="CloseConnection_SetupC" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubCreated_Setup_NoConsumersC" type="RestAPI">
		<dependsOn action_id="CloseConnection_SetupC" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersC</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    
    <!-- debug output. this was failing on MSA saying consumer still existed -->
	<Action name="ShowSubCreated_Setup_NoConsumersC_delay" type="RestAPI">
		<dependsOn action_id="CloseConnection_SetupC" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersC_delay</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action> 
    
	<Action name="ShowSubCreated_Setup_NoConsumersC_delay2" type="RestAPI">
		<dependsOn action_id="CloseConnection_SetupC" interval="300"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersC_delay2</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>           

    <Action name="CompareShowSubCreated_Setup_NoConsumersC" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersC</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		  
       	
	<Action name="CreateConnection_C_N" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29311</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_None</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubZeroConsumers_C_N_before" type="RestAPI">
		<dependsOn action_id="CreateConnection_C_N" interval="150"/>
        <ActionParameter name="structureID">ShowSubZeroConsumers_C_N_before</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubZeroConsumers_C_N_before" type="CompareREST">
        <ActionParameter name="structureID">ShowSubZeroConsumers_C_N_before</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		

	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to resubsribe.
		Expected result: Subscribe will silently fail since there is no "receive" on the SubscriptionMessagingPoicy.  --> 
	<Action name="Subscribe_C_N" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Deleted the subscription. --> 
	<Action name="ShowSubDeleted_C_N" type="RestAPI">
		<dependsOn action_id="Subscribe_C_N" interval="150"/>
        <ActionParameter name="structureID">ShowSubDeleted_C_N</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubDeleted_C_N" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowSubDeleted_C_N</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>			
	
	<!-- On the CreateConnection, we should automatically try (and fail) 
	to access the this subscription subscription. Now try to resubscribe this userid and port have Control access on the Subscription, and Pub/Sub on the Topic
		Expected result: Subscribe will silently fail since there is no "receive" on the SubscriptionMessagingPoicy.  --> 
	<Action name="Subscribe2_C_N" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- We can tell it failed, if the Stat Subscription shows 0 active consumers. Which is checked in comparelogs. --> 
	<Action name="ShowSubZeroConsumers2_C_N" type="RestAPI">
		<dependsOn action_id="Subscribe2_C_N" interval="150"/>
        <ActionParameter name="structureID">ShowSubZeroConsumers2_C_N</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubZeroConsumers2_C_N" type="CompareREST">
        <ActionParameter name="structureID">ShowSubZeroConsumers2_C_N</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 
	
	<Action name="CloseConnection_C_N" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	   
   

	<!-- **************************************************** -->
	<!-- Section 2: Subscribe with Connections with Receive only to the Subscription
		That are trying to join the Subscription --> 
	<!-- **************************************************** -->
    
    <!-- R_PS means Subscription has actions Receive, Topic has Publish,Subscribe --> 
    
	<!-- *************************************************************************** -->
	<!-- Section Setup: Create the DurableSharedSubscription, using the Demo Policy which has all access.
		ClientID is one which will be used for 'reconnect client to same subscription' --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_SetupD" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Create a Subscription that we be used for reconnect client testing.   --> 
	<Action name="Subscribe_SetupD" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Should have one consumer on this subscription.  --> 
	<Action name="ShowSubCreated_SetupD" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_SetupD</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_SetupD" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupD</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 	

	<Action name="CloseConnection_SetupD" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubCreated_Setup_NoConsumersD" type="RestAPI">
		<dependsOn action_id="CloseConnection_SetupD" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_SetupD</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_Setup_NoConsumersD" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupD</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		 			      
       	
	<Action name="CreateConnection_R_PS" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29312</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_Both</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	
	
	<!-- There should be one consumer on this stat as this clientID was already subscribed, and should reconnect. --> 
	 <Action name="ShowSub_1_Consumer_R_PS" type="RestAPI">
	 	<dependsOn action_id="CreateConnection_R_PS" interval="150"/>
        <ActionParameter name="structureID">ShowSub_1_Consumer_R_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub_1_Consumer_R_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSub_1_Consumer_R_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	
	
	<!-- Subscribe, even though we are already subscribed
		Expected result: Subscribe will pass --> 
	<Action name="Subscribe_notNeeded_R_PS" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- There should be one consumer on this stat. . --> 
	<Action name="ShowSub1_after_notNeeded_R_PS" type="RestAPI">
		<dependsOn action_id="Subscribe_notNeeded_R_PS" interval="150"/>
        <ActionParameter name="structureID">ShowSub1_after_notNeeded_R_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub1_after_notNeeded_R_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSub_1_Consumer_R_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			
	
	<!-- Join the 2nd subscription.
		Expected result: Subscribe will pass --> 
	<Action name="Subscribe_R_PS" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- There should be one consumer on this stat. . --> 
	<Action name="ShowSub2_1_Consumer_R_PS" type="RestAPI">
		<dependsOn action_id="Subscribe_R_PS" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_1_Consumer_R_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_1_Consumer_R_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_1_Consumer_R_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			
	
	<!-- Unsubscribe from the 2nd Subscription -->
	<Action name="UnSubscribeSub2_R_PS" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!-- There should be zero consumers on this stat, but the subscription should still exist. --> 
	<Action name="ShowSub2_Unsubscribe_Consumer_R_PS" type="RestAPI">
		<dependsOn action_id="UnSubscribeSub2_R_PS" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_R_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_Unsubscribe_Consumer_R_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_R_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>				
	
	<Action name="CloseConnection_R_PS" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
   <!-- R_S means Subscription has actions Receive, Topic has Subscribe
   		But the subscription does not exist, so silently fail.  --> 
       	
	<Action name="CreateConnection_R_S" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29312</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_Sub</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- There should be one consumer on this stat as this clientID was already subscribed, and should reconnect. --> 
	<Action name="ShowSub_1_Consumer_R_S" type="RestAPI">
		<dependsOn action_id="CreateConnection_R_S" interval="150"/>
        <ActionParameter name="structureID">ShowSub_1_Consumer_R_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub_1_Consumer_R_S" type="CompareREST">
        <ActionParameter name="structureID">ShowSub_1_Consumer_R_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		

	<!-- Expected result: UnSubscribe will silently work even though is no "control" on the SubscriptionMessagingPoicy.  --> 
	<Action name="Unsubscribe_R_S" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- We can tell it failed, if the subscription is not created. --> 
	<Action name="ShowSubisDeleted_R_S" type="RestAPI">
        <ActionParameter name="structureID">ShowSubisDeleted_R_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubisDeleted_R_S" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowSubisDeleted_R_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>			

	<!-- Join the 2nd subscription.
		Expected result: Subscribe will pass --> 
	<Action name="Subscribe_R_S" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- There should be one consumer on this stat. . --> 
	<Action name="ShowSub2_1_Consumer_R_S" type="RestAPI">
		<dependsOn action_id="Subscribe_R_S" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_1_Consumer_R_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_1_Consumer_R_S" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_1_Consumer_R_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		
	
	<!-- Unsubscribe from the 2nd Subscription -->
	<Action name="UnSubscribeSub2_R_S" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!-- There should be zero consumer on this stat, but the subscription should still exist. --> 
	<Action name="ShowSub2_Unsubscribe_Consumer_R_S" type="RestAPI">
		<dependsOn action_id="UnSubscribeSub2_R_S" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_R_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_Unsubscribe_Consumer_R_S" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_R_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		
    
	<Action name="CloseConnection_R_S" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>		 
   
  <!-- R_N means Subscription has actions Receive, User has no authority on the Topic --> 
  
  	<!-- *************************************************************************** -->
	<!-- Section Setup: Create the DurableSharedSubscription, using the Demo Policy which has all access.
		ClientID is one which will be used for 'reconnect client to same subscription' --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_SetupE" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Create a Subscription that we be used for reconnect client testing.   --> 
	<Action name="Subscribe_SetupE" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Should have one consumer on this subscription.  --> 
	<Action name="ShowSubCreated_SetupE" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_SetupE</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_SetupE" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupE</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			

	<Action name="CloseConnection_SetupE" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubCreated_Setup_NoConsumersE" type="RestAPI">
		<dependsOn action_id="CloseConnection_SetupE" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersE</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_Setup_NoConsumersE" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersE</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			
       	
	<Action name="CreateConnection_R_N" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29312</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_None</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- We can tell it failed, no consumers. --> 
	<Action name="ShowSub_R_N" type="RestAPI">
		<dependsOn action_id="CreateConnection_R_N" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersE</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub_R_N" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersE</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>				

	<!-- Expected result: Subscribe will silently fail but delete the subscription since there is no "control" or Topic access on the SubscriptionMessagingPoicy.  --> 
	<Action name="Subscribe_R_N" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- We can tell it did those strange things if the subscription does not exist. --> 
	<Action name="ShowSubDeleted_R_N" type="RestAPI">
		<dependsOn action_id="Subscribe_R_N" interval="150"/>
        <ActionParameter name="structureID">ShowSubisDeleted_R_N</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubDeleted_R_N" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowSubisDeleted_R_N</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>		

	<!-- Join the 2nd subscription.
		Expected result: Subscribe silently fail--> 
	<Action name="SubscribeSub1_R_N" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- There should be zero consumer on this stat. . --> 
	<Action name="ShowSub2_1_Consumer_R_N" type="RestAPI">
		<dependsOn action_id="SubscribeSub1_R_N" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_1_Consumer_R_N</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_1_Consumer_R_N" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_1_Consumer_R_N</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			
	
	<!-- Unsubscribe from the 2nd Subscription -->
	<Action name="UnSubscribeSub2_R_N" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!-- There should be zero consumer on this stat, but the subscription should still exist. --> 
	<Action name="ShowSub2_Unsubscribe_Consumer_R_N" type="RestAPI">
		<dependsOn action_id="UnSubscribeSub2_R_N" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_R_N</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_Unsubscribe_Consumer_R_N" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_R_N</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	
		
	
	<Action name="CloseConnection_R_N" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	   

	<!-- **************************************************** -->
	<!-- Section 3: Subscribe with Connections with Control,Receive only to the Subscription
		that are trying to create the Subscription --> 
	<!-- **************************************************** -->
   	<!-- *************************************************************************** -->
	<!-- Section Setup: Create the DurableSharedSubscription, using the Demo Policy which has all access.
		ClientID is one which will be used for 'reconnect client to same subscription' --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_SetupF" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Create a Subscription that we be used for reconnect client testing.   --> 
	<Action name="Subscribe_SetupF" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Should have one consumer on this subscription.  --> 
	<Action name="ShowSubCreated_SetupF" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_SetupF</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_SetupF" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupF</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		   	

	<Action name="CloseConnection_SetupF" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	<!-- Should have no consumer on this subscription.  -->  
	<Action name="ShowSubCreated_Setup_NoConsumersF" type="RestAPI">
		<dependsOn action_id="CloseConnection_SetupF" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersF</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_Setup_NoConsumersF" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_Setup_NoConsumersF</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>
    		   
    <!-- CR_PS means Subscription has actions Receive, Topic has Publish,Subscribe --> 
       	
	<Action name="CreateConnection_CR_PS" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29310</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_Both</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- We can tell it worked, if the subscription has one consumer created. --> 
	<Action name="ShowSubCreated_CR_PS" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_CR_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_CR_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_CR_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	
	
	<Action name="SubscribeSub2_CR_PS" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- There should be oneconsumer on this stat. . --> 
	<Action name="ShowSub2_1_Consumer_CR_PS" type="RestAPI">
        <ActionParameter name="structureID">ShowSub2_1_Consumer_CR_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_1_Consumer_CR_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_1_Consumer_CR_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	
	
	<!-- Unsubscribe from the 2nd Subscription -->
	<Action name="UnSubscribeSub2_CR_PS" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!-- There should be zero consumer on this stat, but the subscription should still exist. --> 
	<Action name="ShowSub2_Unsubscribe_Consumer_CR_PS" type="RestAPI">
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_CR_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_Unsubscribe_Consumer_CR_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_CR_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>						
	
	<Action name="CloseConnection_CR_PS" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
 
   <!-- CR_S means Subscription has actions Control,Receive, Topic has Subscribe --> 
       	
	<Action name="CreateConnection_CR_S" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29310</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_Sub</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- We can tell it worked, if the one consumer --> 
	<Action name="ShowSubCreated_CR_S" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_CR_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_CR_S" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_CR_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			
	
	<Action name="SubscribeSub2_CR_S" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- There should be one consumer on this stat. . --> 
	<Action name="ShowSub2_1_Consumer_CR_S" type="RestAPI">
		<dependsOn action_id="SubscribeSub2_CR_S" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_1_Consumer_CR_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_1_Consumer_CR_S" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_1_Consumer_CR_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		
	
	<!-- Unsubscribe from the 2nd Subscription -->
	<Action name="UnSubscribeSub2_CR_S" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!-- There should be zero consumer on this stat, but the subscription should still exist. --> 
	<Action name="ShowSub2_Unsubscribe_Consumer_CR_S" type="RestAPI">
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_CR_S</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_Unsubscribe_Consumer_CR_S" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_Unsubscribe_Consumer_CR_S</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>						
	
	<Action name="CloseConnection_CR_S" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>		 
   
  <!-- CR_N means Subscription has actions Control,Receive, User has no authority on the Topic --> 
       	
	<Action name="CreateConnection_CR_N" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29310</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_None</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Zero . --> 
	<Action name="ShowWithZero_CR_N" type="RestAPI">
        <ActionParameter name="structureID">ShowWithZero_CR_N</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowWithZero_CR_N" type="CompareREST">
        <ActionParameter name="structureID">ShowWithZero_CR_N</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	

	<Action name="SubscribeSub_CR_N" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>

	<!--doesn't exist. --> 
	<Action name="ShowSubDeleted_CR_N" type="RestAPI">
        <ActionParameter name="structureID">ShowSubisDeleted_CR_N</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubDeleted_CR_N" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowSubisDeleted_CR_N</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>			

	<Action name="SubscribeSub2_CR_N" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- There should be zero. --> 
	<Action name="ShowSub2_1_Consumer_CR_N" type="RestAPI">
		<dependsOn action_id="SubscribeSub2_CR_N" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_1_Consumer_CR_N</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_1_Consumer_CR_N" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_1_Consumer_CR_N</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>				
	
	<!-- Unsubscribe from the 2nd Subscription. Even though we aren't actually subscribed. -->
	<Action name="UnSubscribeSub2_CR_N" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>			
	
	<Action name="CloseConnection_CR_N" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	        
    

	<!-- **************************************************** -->
	<!-- Section 4: Subscribe with Connections with no subscription policy.
		that are trying to create the Subscription --> 
	<!-- **************************************************** -->
    
    <!-- N_PS means No Subscription Policy and has Publish,Subscribe --> 
    
  	<!-- *************************************************************************** -->
	<!-- Section Setup: Create the DurableSharedSubscription, using the Demo Policy which has all access.
		ClientID is one which will be used for 'reconnect client to same subscription' --> 
	<!-- **************************************************************************** -->
 
	<Action name="CreateConnection_SetupG" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- Create a Subscription that we be used for reconnect client testing.   --> 
	<Action name="Subscribe_SetupG" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<!-- Should have one consumer on this subscription.  --> 
	<Action name="ShowSubCreated_SetupG" type="RestAPI">
        <ActionParameter name="structureID">ShowSubCreated_SetupG</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_SetupG" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupG</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			

	<Action name="CloseConnection_SetupG" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	
	 
	 <Action name="ShowSubCreated_SetupG_afterClose" type="RestAPI">
	 	<dependsOn action_id="CloseConnection_SetupG" interval="150"/>
        <ActionParameter name="structureID">ShowSubCreated_SetupG_afterClose</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSubCreated_SetupG_afterClose" type="CompareREST">
        <ActionParameter name="structureID">ShowSubCreated_SetupG_afterClose</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			    
       	
	<Action name="CreateConnection_N_PS" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
 	    <ApiParameter name="port">29313</ApiParameter>
 	    <ApiParameter name="user">MQTT_DSSSec_Both</ApiParameter>
      	<ApiParameter name="password">password</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<!-- This userid and port have NO access on the Subscription, and Pub/Sub on the Topic
		Expected result: Subscribe silently fail --> 
	<Action name="Subscribe_N_PS" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<Action name="ShowNoSuB_N_PS" type="RestAPI">
        <ActionParameter name="structureID">ShowNoSuB_N_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowNoSuB_N_PS" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowNoSuB_N_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02</ActionParameter>
    </Action>				

	<Action name="SubscribeSub2_N_PS" type="Subscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>
	
	<Action name="UnsubscribeSub2_N_PS" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<!-- There should be zero consumer on this stat. . --> 
	<Action name="ShowSub2_1_Consumer_N_PS" type="RestAPI">
		<dependsOn action_id="UnsubscribeSub2_N_PS" interval="150"/>
        <ActionParameter name="structureID">ShowSub2_1_Consumer_N_PS</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2_1_Consumer_N_PS" type="CompareREST">
        <ActionParameter name="structureID">ShowSub2_1_Consumer_N_PS</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>		  	
	
	<!-- Unsubscribe from the 2nd Subscription. Even though we aren't actually subscribed. -->
	<Action name="UnSubscribeSub2_N_PS" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>				
	
	<Action name="CloseConnection_N_PS" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>
	 
	 <!-- finally.. unsubscribe the final consumer for Sub2 --> 	
		  
	<Action name="CreateConnection_Teardown2" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec02</ApiParameter>
 	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	

	<Action name="Unsubscribe_Teardown2" type="Unsubscribe" > 
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/MQTTDSS_SecSub02b//MQTTDSS_sec01/Topic1</ApiParameter>
		<ApiParameter name="QoS">2</ApiParameter>
	</Action>	
	
	<Action name="ShowSub2Gone_Teardown" type="RestAPI">
        <ActionParameter name="structureID">ShowSub2Gone_Teardown</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=MQTTDSS_SecSub02b&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="CompareShowSub2Gone_Teardown" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">ShowSub2Gone_Teardown</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">MQTTDSS_SecSub02b</ActionParameter>
    </Action>	

	<Action name="CloseConnection_Teardown" type="CloseConnection">
    	<ActionParameter name="connection_id">CF1</ActionParameter>
	 </Action>	

	<!-- **************************************************** -->
   
	<Action name="CreateConnectionreClear1" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
        <ApiParameter name="port">29310</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionreClear1" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>
    
	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionreClear2" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
    	<ApiParameter name="port">29311</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionreClear2" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>    
    
	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionreClear3" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
	    <ApiParameter name="port">29312</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionreClear3" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action> 

	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionreClear4" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
	    <ApiParameter name="port">29313</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionreClear4" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action> 
    
	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionreClearSetup" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec01</ApiParameter>
	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionreClearSetup" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>    
    
     <!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionreClearSetup_sameClient" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">MQTTDSS_clientIDSec02</ApiParameter>
	    <ApiParameter name="port">16102</ApiParameter>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionreClearSetup_sameClient" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>      	      	 
    
</IsmWSTest>
                