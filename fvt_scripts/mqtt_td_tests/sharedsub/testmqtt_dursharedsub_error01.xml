<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2013-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
-->
<!--
	This test will subscribing to various Durable-SharedSubscriptions with various error conditions. 
	
	For MQTT Shared Subscriptions, the topic filter on the subscribe has three parts:
	
	It must start with $SharedSubscription to cue ISM that this is a shared subscription.
	
	The next element is the Subscription Name. 
	
	Then follows the Topic filter to subscriber to.
	
	Example: 
	
	$SharedSubcription/MySubscriptionName/RiverLevels/RedRiver
	
	This test uses the DemoEndpoint, which gives Control authorization for Subscription Messaging
	policies to to all clients. 
	
-->
<IsmWSTest name="testmqtt_dursharedsub_error01" >
	<!-- make sure the client we are about to use has no prior state --> 
	<Action name="CreateConnectionClear" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CloseConnectionClear" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>
	
	<!-- Create a non-clean session Connection -->
	<Action name="CreateConnection" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	
	
	<!-- **************************************************** -->
	<!-- Section 1: This checks various illegal topic filters --> 
	<!-- **************************************************** -->
	
	<!-- invalid Topic filter. There must be a SubscriptionName and Topic --> 
	<Action name="Subscribe_NoSubName" type="Subscribe" rc="1" reason="ISMTEST2503">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action>
	
	<Action name="CheckConnectionBad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    	
	
	<Action name="ReCreateConnection1" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection1Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
	
	<!-- invalid Topic filter. The SubscriptionName is an empty string and Topic is missing-->
	<Action name="Subscribe_NoSubName2" type="Subscribe" rc="1" reason="ISMTEST2503">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription//</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action>
	
	<Action name="CheckConnection1Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    	
	
	<Action name="ReCreateConnection2" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection2Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
	
	<!-- invalid Topic filter. The SubscriptionName is an empty string-->
	<Action name="Subscribe_NoSubName3" type="Subscribe" rc="1" reason="ISMTEST2503">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription//SomeTopic</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action>	

	<Action name="CheckConnection2Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    
	
	<Action name="ReCreateConnection3" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>

	<Action name="CheckConnection3Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    
	
	<!-- There is a Subname.. but topic filter is missing --> 
	<Action name="Subscribe_NoTopicName2" type="Subscribe" rc="1" reason="ISMTEST2503">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/ErrorSub01</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action>
	
	<Action name="CheckConnection3Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>   
	
	<!-- **************************************************** -->
	<!-- Section 2: This checks various illegal topic filters
	         on unsubcribes --> 
	<!-- **************************************************** -->
	
	<Action name="ReCreateConnection4" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection4Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
		
	<Action name="UnSubscribe_NoSubName" type="Unsubscribe" rc="1" reason="ISMTEST2506">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/</ApiParameter>
	</Action>
	
	<Action name="CheckConnection4Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    	

	<Action name="ReCreateConnection5" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection5Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
	
	<Action name="UnSubscribe_NoSubName2" type="Unsubscribe" rc="1" reason="ISMTEST2506">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription//</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action>
	
	<Action name="CheckConnection5Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    	

	<Action name="ReCreateConnection6" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection6Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
	
	<Action name="UnSubscribe_NoSubName3" type="Unsubscribe" rc="1" reason="ISMTEST2506">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription//SomeTopic</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action>	

	<Action name="CheckConnection6Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    

	<Action name="ReCreateConnection7" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>

	<Action name="CheckConnection7Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    
	
	<Action name="UnSubscribe_NoTopicName2" type="Unsubscribe" rc="1" reason="ISMTEST2506">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/ErrorSub01/</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action>	
	
	<Action name="CheckConnection7Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    	
	
	<!-- **************************************************** -->
	<!-- Section 3: This checks various illegal topic filters
	 	on publish --> 
	<!-- **************************************************** -->

	<Action name="ReCreateConnection8" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>

	<Action name="CheckConnection8Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    
		
    <Action name="CreateRandomMessage" type="CreateRandomMessage">
        <ActionParameter name="structure_id">txmsg1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="length">190</ActionParameter>
        <ApiParameter name="QoS">1</ApiParameter>
    </Action>
	
	<!-- the publish should silently fail, and disconnect the publisher. --> 
    <Action name="SendMessage_InvalidSharedSub" type="SendMessage">
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="message_id">txmsg1</ActionParameter>
        <ActionParameter name="topic">$SharedSubscription/SubName/TopicName</ActionParameter>
    </Action>
    
	<Action name="CheckConnection8Bad" type="CheckConnection" >
		<dependsOn action_id="SendMessage_InvalidSharedSub" interval="1000"/>
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>  
	
	<!-- Recreating the session without a cleanSession=True results
	in immediately being disconnected when it retries the publish.
	So this cleans it for the next test. --> 
	<Action name="ReCreateConnection9Clear" type="CreateConnection">
		<ActionParameter name="structure_id">Con9</ActionParameter>
		<ActionParameter name="connection_id">CF9</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01_9</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CreateConnection9ClearClose" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF9</ActionParameter>
    </Action>    		  

	<Action name="ReCreateConnection9" type="CreateConnection">
		<ActionParameter name="structure_id">Con9</ActionParameter>
		<ActionParameter name="connection_id">CF9</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01_9</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
    
	<Action name="CheckConnection9Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF9</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    
		
    <Action name="CreateRandomMessage2" type="CreateRandomMessage">
        <ActionParameter name="structure_id">txmsg1</ActionParameter>
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ActionParameter name="length">190</ActionParameter>
        <ApiParameter name="QoS">1</ApiParameter>
    </Action>
	
    <Action name="SendMessage_InvalidSharedSub2" type="SendMessage">
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ActionParameter name="message_id">txmsg1</ActionParameter>
        <ActionParameter name="topic">$SharedSubscription/SubNameConn9</ActionParameter>
    </Action>    

	<Action name="CheckConnection9Bad" type="CheckConnection" >
		<dependsOn action_id="SendMessage_InvalidSharedSub2" interval="500"/>
		<ActionParameter name="connection_id">CF9</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    
	
	<!-- Recreating the session without a cleanSession=True results
	in immediately being disconnected when it retries the publish.
	So this cleans it for the next test. --> 
	<Action name="ReCreateConnection10Clear" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CreateConnection10ClearClose" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>    	
    		
	<Action name="ReCreateConnection10" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>	
    
	<Action name="CheckConnection10Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    
		
    <Action name="CreateRandomMessage3" type="CreateRandomMessage">
        <ActionParameter name="structure_id">txmsg1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="length">190</ActionParameter>
        <ApiParameter name="QoS">1</ApiParameter>
    </Action>

    <Action name="SendMessage_InvalidSharedSub3a" type="SendMessage">
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="message_id">txmsg1</ActionParameter>
        <ActionParameter name="topic">$SharedSubscription/</ActionParameter>
    </Action>    

	<Action name="CheckConnection10Bad" type="CheckConnection" >
		<dependsOn action_id="SendMessage_InvalidSharedSub3a" interval="500"/>
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>   
	     
    <Action name="CloseConnection" type="CloseConnection" rc="1" reason="ISMTEST2507">
        <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>
    
    <!-- **************************************************** -->
	<!-- Section 4: This checks a bit of GVT in topic filters --> 
	<!-- **************************************************** -->

	<!-- Recreating the session without a cleanSession=True results
	in immediately being disconnected when it retries the publish.
	So this cleans it for the next test. --> 
	<Action name="ReCreateConnectionGVTClear" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CreateConnectionGVTClearClose" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action> 	
    
    <!-- Now show that we can create a valid consumer. And add a little GVT as well. -->
   	<Action name="ReCreateConnectionGVT1" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnectionGVT1Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>   
		
	<!-- Valid subscription and topic names --> 
	<Action name="Subscribe_GVTopicName2" type="Subscribe">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/葛渚噓/GVTDurTopic02/葛渚噓</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action>
	
	<!-- Action name="ShowGVTSub" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=葛渚噓 ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
    <Action name="restStatCallGVT" type="RestAPI">
        <ActionParameter name="structureID">stat_output_GVT</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=葛渚噓&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareRESTGVT" type="CompareREST">
        <ActionParameter name="structureID">stat_output_GVT</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">葛渚噓</ActionParameter>
        <ObjectProperty name="BufferedMsgs" value="0"/>
        <ObjectProperty name="PublishedMsgs" value="0"/>
    </Action>		
	
	<!-- Valid unsubscribe --> 
	<Action name="UnSubscribe_GVTopicName2" type="Unsubscribe">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/葛渚噓/GVTDurTopic02/葛渚噓</ApiParameter>
		<ApiParameter name="QoS">1</ApiParameter>
	</Action> 	
	
	<Action name="CheckConnectionGVT" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>   
	
	<!-- Action name="ShowGVTSub_Gone" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=葛渚噓 ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
		<ActionParameter name="expected_rc">1</ActionParameter>
	</Action -->		
	
  <Action name="restStatCallGVT_Gone" type="RestAPI">
        <ActionParameter name="structureID">stat_output_GVTGone</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=葛渚噓&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareRESTGVT_Gone" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">stat_output_GVTGone</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">葛渚噓</ActionParameter>
    </Action>		
    
    <Action name="CloseConnectionGVT" type="CloseConnection">
        <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>  
    
    <!-- **************************************************** -->
	<!-- Section 5: This checks various illegal topic filters 
		when subscribing to multiple topics--> 
	<!-- **************************************************** -->
	
    
   	<Action name="ReCreateConnection11" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection11Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
	
	<!-- invalid Topic filter. The SubscriptionName is an empty string-->
	<Action name="Subscribe_NoSubName11_Middle" type="Subscribe" rc="1" reason="ISMTEST2505">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topics">/validTopic:$SharedSubscription//SomeSpecialTopic:/AnotherValidToipc</ApiParameter>
		<ApiParameter name="QoSlist">0:0:0</ApiParameter>
	</Action>	

	<Action name="CheckConnection11Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    

   	<Action name="ReCreateConnection12" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection12Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
	
	<!-- invalid Topic filter. The SubscriptionName and Topic name are missing on the end -->
	<Action name="Subscribe_NoSubName12_End" type="Subscribe" rc="1" reason="ISMTEST2505">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topics">/validTopic:/AnotherValidTopic/Subtopic:$SharedSubscription/</ApiParameter>
		<ApiParameter name="QoSlist">0:0:0</ApiParameter>
	</Action>	

	<Action name="CheckConnection12Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    	
 
  	<Action name="ReCreateConnection13" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection13Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
	
	<!-- invalid Topic filter. The SubscriptionName is an empty string in the first topic-->
	<Action name="Subscribe_NoSubName13_Start" type="Subscribe" rc="1" reason="ISMTEST2505">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topics">$SharedSubscription/dursharedsub_error01Subname:/validTopic:/AnotherValidTopic</ApiParameter>
		<ApiParameter name="QoSlist">0:0:0</ApiParameter>
	</Action>	

	<Action name="CheckConnection13Bad" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">false</ActionParameter>
	</Action>    
	
	<!-- **************************************************** -->
	<!-- Section 6:  validates unsubscribes.. reconnecting a 
		client, and that cleansession=true cleans up
		DurableSubscriptions These are not strictly error 
		cases.--> 
	<!-- **************************************************** -->
   
  	<Action name="ReCreateConnection14Good" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection14Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    	
	
	<!-- Valid and Multiple Durable Shared and Durable Non Shared Subs Topic filters. -->
	<Action name="Subscribe_MultValidShared" type="Subscribe">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topics">$SharedSubscription/dursharedsub_error01Subname/Valid:/validTopic:/AnotherValidTopic:$SharedSubscription/dursharedsub_error01Subname2/Valid2</ApiParameter>
		<ApiParameter name="QoSlist">0:1:2:2</ApiParameter>
	</Action>	

	<Action name="CheckConnection14Still_good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    
	
	<!-- Action name="Showdursharedsub_error01Subname" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=dursharedsub_error01Subname ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
   <Action name="restShowdursharedsub_error01Subname" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=dursharedsub_error01Subname&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowdursharedsub_error01Subname" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">dursharedsub_error01Subname</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="TopicString" value="Valid"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>											
	
	<!-- Action name="Showdursharedsub_error01Subname2" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=dursharedsub_error01Subname2 ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
  <Action name="restShowdursharedsub_error01Subname2" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=dursharedsub_error01Subname2&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowdursharedsub_error01Subname2" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">dursharedsub_error01Subname2</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="TopicString" value="Valid2"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>													
	
	<!-- Action name="ShowNonSharedSubs" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription ClientID=dursharedsub_error01</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
  <Action name="restShowNonSharedSubs" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?ClientID=dursharedsub_error01</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowNonSharedSubs1" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">/validTopic</ActionParameter>
        <ObjectProperty name="IsShared" value="false"/>
        <ObjectProperty name="TopicString" value="/validTopic"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	
    
  <Action name="compareShowNonSharedSubs2" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">/AnotherValidTopic</ActionParameter>
        <ObjectProperty name="IsShared" value="false"/>
        <ObjectProperty name="TopicString" value="/AnotherValidTopic"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	    
    
	<Action name="CloseConnectionWithDurableSubscriptions" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>   
    
    <!-- Now show the subscriptions again. They should exist, but have
    	no consumers. (this is checked in comparelogs looking for 
    	the  subscriptions with consumers=0 ) --> 
    	
	<!-- Action name="Showdursharedsub_error01Subname2_No_Consumers" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=dursharedsub_error01Subname ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->		
	
   <Action name="restShowdursharedsub_error01Subname_NoCons" type="RestAPI">
   		<dependsOn action_id="CloseConnectionWithDurableSubscriptions" interval="1000"/>
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=dursharedsub_error01Subname&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowdursharedsub_error01Subname_NoCons" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">dursharedsub_error01Subname</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="TopicString" value="Valid"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>											
		
	
	<!-- Action name="Showdursharedsub_error01Subname2a_No_Consumer" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=dursharedsub_error01Subname2 ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
  <Action name="restShowdursharedsub_error01Subname2_NoCons" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=dursharedsub_error01Subname2&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowdursharedsub_error01Subname2_NoCons" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">dursharedsub_error01Subname2</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="TopicString" value="Valid2"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>						
	
	<!-- Action name="ShowNonSharedSubs_No_Consumer" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription ClientID=dursharedsub_error01</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->		
	
 <Action name="restShowNonSharedSubs_NoCons" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?ClientID=dursharedsub_error01</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowNonSharedSubs1_NoCons" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">/validTopic</ActionParameter>
        <ObjectProperty name="IsShared" value="false"/>
        <ObjectProperty name="TopicString" value="/validTopic"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	
    
  <Action name="compareShowNonSharedSubs2_NoCons" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">/AnotherValidTopic</ActionParameter>
        <ObjectProperty name="IsShared" value="false"/>
        <ObjectProperty name="TopicString" value="/AnotherValidTopic"/>
        <ObjectProperty name="Consumers" value="0"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	    	 
	
	<!-- Clean session is false.. so our subscriptions should be there, and 
		I think show consumers. --> 
   	<Action name="ReCreateConnection15Good" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">false</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection15Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    
	
	<!-- we don't need to resubscribe. --> 
	<!-- Action name="Showdursharedsub_error01Subname_onReconnect" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=dursharedsub_error01Subname ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
   <Action name="restShowdursharedsub_error01Subname_again" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=dursharedsub_error01Subname&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowdursharedsub_error01Subname_again" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">dursharedsub_error01Subname</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="TopicString" value="Valid"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			
	
	<!-- Action name="Showdursharedsub_error01Subname2_onReconnect" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=dursharedsub_error01Subname2 ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->
	
   <Action name="restShowdursharedsub_error01Subname2_again" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=dursharedsub_error01Subname2&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowdursharedsub_error01Subname2_again" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">dursharedsub_error01Subname2</ActionParameter>
        <ObjectProperty name="IsShared" value="true"/>
        <ObjectProperty name="TopicString" value="Valid2"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>			
	
	<!-- Action name="ShowNonSharedSuba_onReconnect" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription ClientID=dursharedsub_error01</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
 <Action name="restShowNonSharedSubs_again" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?ClientID=dursharedsub_error01</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowNonSharedSubs1_again" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">/validTopic</ActionParameter>
        <ObjectProperty name="IsShared" value="false"/>
        <ObjectProperty name="TopicString" value="/validTopic"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	
    
  <Action name="compareShowNonSharedSubs2_again" type="CompareREST">
        <ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">/AnotherValidTopic</ActionParameter>
        <ObjectProperty name="IsShared" value="false"/>
        <ObjectProperty name="TopicString" value="/AnotherValidTopic"/>
        <ObjectProperty name="Consumers" value="1"/>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action>	    	
	
	<!-- NO LONGER NEEDED: Set trace high, in an attempt to get some logs for defect 73742 76006 --> 
	<!-- Action name="SetHighTrace" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver set TraceLevel=9 </ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	
	
	<!-- try both ways of getting rid of a Durable Shared Subscription in MQTT
		Method 1 is be the last one to unsubscribe (if you you have Control authority
		which we do). -->
	<Action name="UnSubscribe_Shared1" type="Unsubscribe">
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ApiParameter name="topic">$SharedSubscription/dursharedsub_error01Subname/Valid</ApiParameter>
	</Action>
	
   <Action name="restShowdursharedsub_error01Subname_gone" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1_gone</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=dursharedsub_error01Subname&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>		
	
    <Action name="compareShowdursharedsub_error01Subname_gone" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">stat_output_1_gone</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">dursharedsub_error01Subname</ActionParameter>
    </Action>		
			 	
	
	<!-- prove it was removed AND HERE was Defect 55886.. At the time this was 
	written this was not working correctly. When that is fixed.. just
	uncomment the expected_rc line below. Now fixed. --> 
	<!-- Action name="Showdursharedsub_error01Subname_gone" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=dursharedsub_error01Subname ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
		<ActionParameter name="expected_rc">1</ActionParameter>
	</Action -->	
    
    <!-- Method 2 is to close, and reconnect with clean session. (again, you need 
    	control authority -->     	
	<Action name="CloseConnectionWithDurableSubscription" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>    
    
    <!-- reopen, with cleansession=true, should delete all subscriptions --> 
   	<Action name="ReCreateConnection16Good" type="CreateConnection">
		<ActionParameter name="structure_id">Con1</ActionParameter>
		<ActionParameter name="connection_id">CF1</ActionParameter>
        <include>../common/ConnectionType.xml</include>
		<include>../common/MQTT_server.xml</include>
		<ApiParameter name="clientId">dursharedsub_error01</ApiParameter>
        <include>../common/MQTT_port.xml</include>
		<ApiParameter name="protocol">mqtt</ApiParameter>
		<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
		<ApiParameter name="cleanSession">true</ApiParameter>
		<!-- ApiParameter name="verbose">true</ApiParameter-->
	</Action>
	
	<Action name="CheckConnection16Good" type="CheckConnection" >
		<ActionParameter name="connection_id">CF1</ActionParameter>
		<ActionParameter name="isConnected">true</ActionParameter>
	</Action>    

	
	<!-- These should have been removed on cleansession. --> 
	<!-- Action name="Showdursharedsub_error01Subname2_gone" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=dursharedsub_error01Subname2 ClientID=__Shared</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
		<ActionParameter name="expected_rc">1</ActionParameter>
	</Action -->	
	
  <Action name="restShowdursharedsub_error01Subname2_gone" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1_gone</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=dursharedsub_error01Subname2&amp;ClientID=__Shared</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>		
	
    <Action name="compareShowdursharedsub_error01Subname2_gone" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">stat_output_1_gone</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">dursharedsub_error01Subname2</ActionParameter>
    </Action>			
	
	<!-- Defect for this not getting cleaned up was trsd. 73742 --> 
	<!-- Action name="ShowNonSharedSubs_gone" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription ClientID=dursharedsub_error01</ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
		<ActionParameter name="expected_rc">1</ActionParameter>
	</Action -->	
	
<Action name="restShowNonSharedSubs_gone" type="RestAPI">
        <ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/Subscription?ClientID=dursharedsub_error01</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">-1</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>

    <Action name="compareShowNonSharedSubs1_gone" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">stat_output_1_gone</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">/validTopic</ActionParameter>
    </Action>	
    
  <Action name="compareShowNonSharedSubs2_gone" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">stat_output_1_gone</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">SubName</ActionParameter>
        <ActionParameter name="subObjectName">/AnotherValidTopic</ActionParameter>
    </Action>	    		
	
	<Action name="Finalclose" type="CloseConnection">
   	    <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>   
    
	<!-- Set trace high, in an attempt to get some logs for defect 73742 76006 --> 
	<!-- Action name="SetHighTraceback" type="ShellAction">
		<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver set TraceLevel=5 </ActionParameter>
		<ActionParameter name="print_result">true</ActionParameter>
	</Action -->	 	
    	
</IsmWSTest>
                