<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2013-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
   TestCase Name: testmqtt_DS_111_111

   Test Category: SharedSubscription MQTT

   Test Description:
       Durable shared subscriptions, subscribers QoS=1,1,1, Messages QoS=1,1,1
   
   NOTE:  The ShellActions are on their own threads, so they give an approximate state of 
   the server statistics.  
   
   The Subscribes and Unsubscribes are timed to assure they happen as simultaneously as 
   possible, because we found defects when there were multiple Subscribes happening. 

  -->
<IsmWSTest name="testmqtt_DS_111_111_Connect">

	<SyncClient>
		<server>
			<include>../common/JMS_syncip.xml</include>
			<include>../common/JMS_syncport.xml</include>
		</server>
		<solution>mqttDS_111_111_Connect</solution>
	</SyncClient>
  
	<Action name="Subs" type="CompositeAction">
		<!--  These CreateConnections will clear out any old client info -->
		<Action name="CreateSubConnection1_Clear" type="CreateConnection" thread="11" >
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub1</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="CloseSubConnection1_Clear" type="CloseConnection" thread="11">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
		</Action>
		<Action name="CreateSubConnection2_Clear" type="CreateConnection" thread="22" >
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub2</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub2</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="CloseSubConnection2_Clear" type="CloseConnection" thread="22">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
		</Action>
		<Action name="CreateSubConnection3_Clear" type="CreateConnection" thread="33" >
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub3</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub3</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="CloseSubConnection3_Clear" type="CloseConnection" thread="33">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
		</Action>
  
  		<!-- These connections are the ones we'll use for testing --> 
		<Action name="CreateSubConnectionSub1" type="CreateConnection" thread="11">
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub1</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
  		</Action>   		
		<Action name="CreateSubConnectionSub2" type="CreateConnection" thread="22">
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub2</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub2</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
  		</Action>  
		<Action name="CreateSubConnectionSub3" type="CreateConnection" thread="33">
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub3</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub3</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
  		</Action>
		
		<!-- Subscribe -->
		<Action name="SubscribeSub1_a" type="Subscribe" thread="11">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
			<ApiParameter name="topic">$SharedSubscription/SubDS_111_111//DS/DS_111_111</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
		</Action>
		<Action name="SubscribeSub2_a" type="Subscribe" thread="22">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
			<ApiParameter name="topic">$SharedSubscription/SubDS_111_111//DS/DS_111_111</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
		</Action>	
		<Action name="SubscribeSub3_a" type="Subscribe" thread="33">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
			<ApiParameter name="topic">$SharedSubscription/SubDS_111_111//DS/DS_111_111</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
		</Action>				

		<!-- Action name="ShowSub_BeforeSynce" type="ShellAction" thread="4">
			<dependsOn action_id="SubscribeSub1_a"/>
			<dependsOn action_id="SubscribeSub2_a"/>
			<dependsOn action_id="SubscribeSub3_a"/>
			<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=SubDS_111_111</ActionParameter>
			<ActionParameter name="print_result">true</ActionParameter>
		</Action -->		

	    <!-- Upping TraceLevel to debug null receive --> 
      <Action name="RESTSetTraceLevel" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"TraceLevel":"9"}</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
      </Action>

		
		<Action name="ShowSub_BeforeSynce" type="RestAPI" thread="4">
			<dependsOn action_id="SubscribeSub1_a"/>
			<dependsOn action_id="SubscribeSub2_a"/>
			<dependsOn action_id="SubscribeSub3_a"/>
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=SubDS_111_111</ActionParameter>
        	<ActionParameter name="action">GET</ActionParameter>
        	<ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
        	<ActionParameter name="expectedStatusCode">-1</ActionParameter>
        	<ActionParameter name="expectedMessageCode"></ActionParameter>
    	</Action>														

		<!-- Signal to Publishers that the subscriptions are ready for messages to be sent. -->
		<Action name="sync_components_1" type="SyncComponentAction">
			<dependsOn action_id="SubscribeSub1_a"/>
			<dependsOn action_id="SubscribeSub2_a"/>
			<dependsOn action_id="SubscribeSub3_a"/>
			<ActionParameter name="component_name">Subs1</ActionParameter>
			<ActionParameter name="component_list">Subs1;Pubs1;Collector1</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>
		
		<!-- Action name="ShowSub_AfterSync" type="ShellAction" thread="4">
			<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=SubDS_111_111</ActionParameter>
			<ActionParameter name="print_result">true</ActionParameter>
		</Action -->	
		
		<Action name="ShowSub_AfterSync" type="RestAPI" thread="4">
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=SubDS_111_111</ActionParameter>
        	<ActionParameter name="action">GET</ActionParameter>
        	<ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
        	<ActionParameter name="expectedStatusCode">-1</ActionParameter>
        	<ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>				

		<Action name="CompositeReceiveSub1_a" type="CompositeAction" repeat="300"  atleast="5" thread="11" repeat_interval="0">
			<dependsOn action_id="sync_components_1"/>
			<Action name="ReceiveMessageSub1_a" type="ReceiveMessage" thread="11">
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
				<ActionParameter name="structure_id">rxmsgSub1</ActionParameter>
				<ActionParameter name="waitTime">10000</ActionParameter>
			</Action>
			<!-- Send QoS 1 message to the collector to verify all messages are processed -->
			<Action name="SendMessage_1a" type="SendMessage" thread="11">
	 	  		<dependsOn action_id="ReceiveMessageSub1_a" interval="0" />
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
				<ActionParameter name="message_id">rxmsgSub1</ActionParameter>
				<ActionParameter name="topic">/DS/DS_111_111/Sub1a</ActionParameter>
				<ActionParameter name="QoS">1</ActionParameter>
			</Action>
		</Action>
		
		<Action name="CompositeReceiveSub2_a" type="CompositeAction" repeat="300" atleast="5" thread="22" repeat_interval="0">
			<dependsOn action_id="sync_components_1"/>
			<Action name="ReceiveMessageSub2_a" type="ReceiveMessage" thread="22">
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
				<ActionParameter name="structure_id">rxmsgSub2</ActionParameter>
				<ActionParameter name="waitTime">10000</ActionParameter>
			</Action>
			<!-- Send QoS 1 message to the collector to verify all messages are processed -->
			<Action name="SendMessage_2a" type="SendMessage" thread="22">
	 	  		<dependsOn action_id="ReceiveMessageSub2_a" interval="0" />
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
				<ActionParameter name="message_id">rxmsgSub2</ActionParameter>
				<ActionParameter name="topic">/DS/DS_111_111/Sub2a</ActionParameter>
				<ActionParameter name="QoS">1</ActionParameter>
			</Action>					
		</Action>		

		<Action name="CompositeReceiveSub3_a" type="CompositeAction" repeat="300" atleast="5" thread="33" repeat_interval="0">
			<dependsOn action_id="sync_components_1"/>
			<Action name="ReceiveMessageSub3_a" type="ReceiveMessage" thread="33">
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
				<ActionParameter name="structure_id">rxmsgSub3</ActionParameter>
				<ActionParameter name="waitTime">10000</ActionParameter>
			</Action>
			<!-- Send QoS 1 message to the collector to verify all messages are processed -->
			<Action name="SendMessage_3a" type="SendMessage"  thread="33">
	 	  		<dependsOn action_id="ReceiveMessageSub3_a" interval="0" />
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
				<ActionParameter name="message_id">rxmsgSub3</ActionParameter>
				<ActionParameter name="topic">/DS/DS_111_111/Sub3a</ActionParameter>
				<ActionParameter name="QoS">1</ActionParameter>
			</Action>
		</Action>	
					
		<!-- Disconnect -->
		<Action name="CloseSubConnectionSub1_a" type="CloseConnection" thread="11">
			<dependsOn action_id="CompositeReceiveSub1_a"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
		</Action>
		
		<Action name="CloseSubConnectionSub2_a" type="CloseConnection" thread="22">
			<dependsOn action_id="CompositeReceiveSub2_a"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
		</Action>		
  
		<Action name="CloseSubConnectionSub3_a" type="CloseConnection" thread="33">
			<dependsOn action_id="CompositeReceiveSub3_a"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
		</Action>

		<Action name="sync_components_2" type="SyncComponentAction">
			<dependsOn action_id="CloseSubConnectionSub1_a"/>
			<dependsOn action_id="CloseSubConnectionSub2_a"/>
			<dependsOn action_id="CloseSubConnectionSub3_a"/>
			<ActionParameter name="component_name">Subs2</ActionParameter>
			<ActionParameter name="component_list">Subs2;Pubs2;Collector2</ActionParameter>
			<ActionParameter name="timeout">150000</ActionParameter>
		</Action>
		<Action name="sync_components_3" type="SyncComponentAction">
			<dependsOn action_id="sync_components_2"/>
			<ActionParameter name="component_name">Subs3</ActionParameter>
			<ActionParameter name="component_list">Subs3;Pubs3;Collector3</ActionParameter>
			<ActionParameter name="timeout">300000</ActionParameter>
		</Action>
		
		<!-- Reconnect -->
		<Action name="CreateSubConnectionSub1_recon" type="CreateConnection" thread="11">
			<dependsOn action_id="sync_components_3"/>
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub1</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
  		</Action>   		
		<Action name="CreateSubConnectionSub2_recon" type="CreateConnection" thread="22">
			<dependsOn action_id="sync_components_3"/>
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub2</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub2</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
  		</Action>  
		<Action name="CreateSubConnectionSub3_recon" type="CreateConnection" thread="33">
			<dependsOn action_id="sync_components_3"/>
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub3</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub3</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
  		</Action>

		<Action name="CompositeReceiveSub1_b" type="CompositeAction" repeat="15000"  atleast="15" thread="11" repeat_interval="0">
			<dependsOn action_id="CreateSubConnectionSub1_recon"/>
			<Action name="ReceiveMessageSub1_b" type="ReceiveMessage" thread="11">
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
				<ActionParameter name="structure_id">rxmsgSub1</ActionParameter>
				<ActionParameter name="waitTime">10000</ActionParameter>
			</Action>
			<!-- Send QoS 1 message to the collector to verify all messages are processed -->
			<Action name="SendMessage_1b" type="SendMessage" thread="11">
	 	  		<dependsOn action_id="ReceiveMessageSub1_b" interval="0" />
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
				<ActionParameter name="message_id">rxmsgSub1</ActionParameter>
				<ActionParameter name="topic">/DS/DS_111_111/Sub1b</ActionParameter>
				<ActionParameter name="QoS">1</ActionParameter>
			</Action>
			
		</Action>
		
		<Action name="CompositeReceiveSub2_b" type="CompositeAction" repeat="15000" atleast="15" thread="22" repeat_interval="0">
			<dependsOn action_id="CreateSubConnectionSub2_recon"/>
			<Action name="ReceiveMessageSub2_b" type="ReceiveMessage" thread="22">
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
				<ActionParameter name="structure_id">rxmsgSub2</ActionParameter>
				<ActionParameter name="waitTime">10000</ActionParameter>
			</Action>
			<!-- Send QoS 1 message to the collector to verify all messages are processed -->
			<Action name="SendMessage_2a" type="SendMessage" thread="22">
	 	  		<dependsOn action_id="ReceiveMessageSub2_b" interval="0" />
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
				<ActionParameter name="message_id">rxmsgSub2</ActionParameter>
				<ActionParameter name="topic">/DS/DS_111_111/Sub2b</ActionParameter>
				<ActionParameter name="QoS">1</ActionParameter>
			</Action>					
		</Action>		

		<Action name="CompositeReceiveSub3_b" type="CompositeAction" repeat="15000" atleast="15" thread="33" repeat_interval="0">
			<dependsOn action_id="CreateSubConnectionSub3_recon"/>
			<Action name="ReceiveMessageSub3_b" type="ReceiveMessage" thread="33">
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
				<ActionParameter name="structure_id">rxmsgSub3</ActionParameter>
				<ActionParameter name="waitTime">10000</ActionParameter>
			</Action>
			<!-- Send QoS 1 message to the collector to verify all messages are processed -->
			<Action name="SendMessage_3a" type="SendMessage"  thread="33">
	 	  		<dependsOn action_id="ReceiveMessageSub3_b" interval="0" />
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
				<ActionParameter name="message_id">rxmsgSub3</ActionParameter>
				<ActionParameter name="topic">/DS/DS_111_111/Sub3b</ActionParameter>
				<ActionParameter name="QoS">1</ActionParameter>
			</Action>
		</Action>

		<Action name="UnSubscribe_Sub1" type="Unsubscribe" thread="11">
			<dependsOn action_id="CompositeReceiveSub1_b" interval="0"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
			<ApiParameter name="topic">$SharedSubscription/SubDS_111_111//DS/DS_111_111</ApiParameter>
		</Action>
		
		<Action name="UnSubscribe_Sub2" type="Unsubscribe" thread="22">
			<dependsOn action_id="CompositeReceiveSub2_b" interval="0"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
			<ApiParameter name="topic">$SharedSubscription/SubDS_111_111//DS/DS_111_111</ApiParameter>
		</Action>	
		
		<Action name="UnSubscribe_Sub3" type="Unsubscribe" thread="33">
			<dependsOn action_id="CompositeReceiveSub3_b" interval="0"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
			<ApiParameter name="topic">$SharedSubscription/SubDS_111_111//DS/DS_111_111</ApiParameter>
		</Action>
		
		<!-- Action name="ShowSubisGone" type="ShellAction" thread="4">
			<dependsOn action_id="UnSubscribe_Sub1"/>
			<dependsOn action_id="UnSubscribe_Sub2"/>
			<dependsOn action_id="UnSubscribe_Sub3"/>
			<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=SubDS_111_111</ActionParameter>
			<ActionParameter name="print_result">true</ActionParameter>
			<ActionParameter name="expected_rc">1</ActionParameter>
		</Action -->
		
		<Action name="ShowSubisGone" type="RestAPI" thread="4">
			<dependsOn action_id="UnSubscribe_Sub1"/>
			<dependsOn action_id="UnSubscribe_Sub2"/>
			<dependsOn action_id="UnSubscribe_Sub3"/>
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=SubDS_111_111</ActionParameter>
        	<ActionParameter name="action">GET</ActionParameter>
        	<ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
        	<ActionParameter name="expectedStatusCode">-1</ActionParameter>
        	<ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>	
        
		<Action name="compareShowSubisGone" type="CompareREST" rc="1" reason="ISMTEST3416" thread="4" >
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="topLevelKey">Subscription</ActionParameter>
        	<ActionParameter name="subObjectKey">SubName</ActionParameter>
        	<ActionParameter name="subObjectName">SubDS_111_111</ActionParameter>
    	</Action>				    				    				
	    					
		<Action name="CloseSubConnectionSub1_b" type="CloseConnection" thread="11">
			<dependsOn action_id="ShowSubisGone"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
		</Action>
		
		<Action name="CloseSubConnectionSub2_b" type="CloseConnection" thread="22">
			<dependsOn action_id="ShowSubisGone"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
		</Action>		
  
		<Action name="CloseSubConnectionSub3_b" type="CloseConnection" thread="33">
			<dependsOn action_id="ShowSubisGone"/>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
		</Action>

		<!--  Reconnect (clean_session = true) then disconnect to clean up the shared subscription -->
		<Action name="CreateSubConnection1_Clean" type="CreateConnection" thread="11" >
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub1</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="CloseSubConnection1_Clean" type="CloseConnection" thread="11">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub1</ActionParameter>
		</Action>
		<Action name="CreateSubConnection2_Clean" type="CreateConnection" thread="11" >
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub2</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub2</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="CloseSubConnection2_Clean" type="CloseConnection" thread="11">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub2</ActionParameter>
		</Action>
		<Action name="CreateSubConnection3_Clean" type="CreateConnection" thread="11" >
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Sub3</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Sub3</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="CloseSubConnection3_Clean" type="CloseConnection" thread="11">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Sub3</ActionParameter>
		</Action>
	    
	</Action>
  
	<Action name="Pubs" type="CompositeAction">
 
		<Action name="CreatePubConnection1" type="CreateConnection" thread="11">
			<ActionParameter name="structure_id">ConPub1</ActionParameter>
			<ActionParameter name="connection_id">CFPub1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Pub1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
		</Action>		
		<Action name="CreatePubConnection2" type="CreateConnection" thread="22">
			<ActionParameter name="structure_id">ConPub2</ActionParameter>
			<ActionParameter name="connection_id">CFPub2</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Pub2</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
		</Action>
		<Action name="CreatePubConnection3" type="CreateConnection" thread="33">
			<ActionParameter name="structure_id">ConPub3</ActionParameter>
			<ActionParameter name="connection_id">CFPub3</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Pub3</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
		</Action>
		
		<Action name="CreateMessage1a" type="CreateMessage" thread="11">
			<ActionParameter name="structure_id">txmsg1a</ActionParameter>
			<ActionParameter name="connection_id">CFPub1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
			<ApiParameter name="payload">TEXT: Publisher 1a QoS 1 Message number: </ApiParameter>
			<ActionParameter name="incrementing">true</ActionParameter>
		</Action>
		<Action name="CreateMessage1b" type="CreateMessage" thread="11">
			<ActionParameter name="structure_id">txmsg1b</ActionParameter>
			<ActionParameter name="connection_id">CFPub1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
			<ApiParameter name="payload">TEXT: Publisher 1b QoS 1 Message number: </ApiParameter>
			<ActionParameter name="incrementing">true</ActionParameter>
		</Action>
		
		<Action name="CreateMessage2a" type="CreateMessage" thread="22">
			<ActionParameter name="structure_id">txmsg2a</ActionParameter>
			<ActionParameter name="connection_id">CFPub2</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
			<ApiParameter name="payload">TEXT: Publisher 2a QoS 1 Message number: </ApiParameter>
			<ActionParameter name="incrementing">true</ActionParameter>
		</Action>
		<Action name="CreateMessage2b" type="CreateMessage" thread="22">
			<ActionParameter name="structure_id">txmsg2b</ActionParameter>
			<ActionParameter name="connection_id">CFPub2</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
			<ApiParameter name="payload">TEXT: Publisher 2b QoS 1 Message number: </ApiParameter>
			<ActionParameter name="incrementing">true</ActionParameter>
		</Action>
		
		<Action name="CreateMessage3a" type="CreateMessage" thread="33">
			<ActionParameter name="structure_id">txmsg3a</ActionParameter>
			<ActionParameter name="connection_id">CFPub3</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
			<ApiParameter name="payload">TEXT: Publisher 3a QoS 1 Message number: </ApiParameter>
			<ActionParameter name="incrementing">true</ActionParameter>
		</Action>	
		<Action name="CreateMessage3b" type="CreateMessage" thread="33">
			<ActionParameter name="structure_id">txmsg3b</ActionParameter>
			<ActionParameter name="connection_id">CFPub3</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
			<ApiParameter name="payload">TEXT: Publisher 3b QoS 1 Message number: </ApiParameter>
			<ActionParameter name="incrementing">true</ActionParameter>
		</Action>	
		

		<!-- Signal from the subscribers subscriptions are ready for messages to be sent. -->
		<Action name="sync_components_1" type="SyncComponentAction">
			<dependsOn action_id="CreateMessage1a"/>
			<dependsOn action_id="CreateMessage1b"/>
			<dependsOn action_id="CreateMessage2a"/>
			<dependsOn action_id="CreateMessage2b"/>
			<dependsOn action_id="CreateMessage3a"/>
			<dependsOn action_id="CreateMessage3b"/>
			<ActionParameter name="component_name">Pubs1</ActionParameter>
			<ActionParameter name="component_list">Subs1;Pubs1;Collector1</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>					
  
		<Action name="SendMessage_1a" type="SendMessage" interval="0" repeat="100" thread="11" repeat_interval="0">
	 	  	<dependsOn action_id="sync_components_1" interval="0" />
			<ActionParameter name="connection_id">CFPub1</ActionParameter>
			<ActionParameter name="message_id">txmsg1a</ActionParameter>
			<ActionParameter name="topic">/DS/DS_111_111</ActionParameter>
			<ActionParameter name="QoS">1</ActionParameter>
		</Action>		
		<Action name="SendMessage_2a" type="SendMessage" interval="0" repeat="100" thread="22" repeat_interval="0">
	 	  	<dependsOn action_id="sync_components_1" interval="0" />
			<ActionParameter name="connection_id">CFPub2</ActionParameter>
			<ActionParameter name="message_id">txmsg2a</ActionParameter>
			<ActionParameter name="topic">/DS/DS_111_111</ActionParameter>
			<ActionParameter name="QoS">1</ActionParameter>
		</Action>	
		<Action name="SendMessage_3a" type="SendMessage" interval="0" repeat="100" thread="33" repeat_interval="0">
	 	  	<dependsOn action_id="sync_components_1" interval="0" />
			<ActionParameter name="connection_id">CFPub3</ActionParameter>
			<ActionParameter name="message_id">txmsg3a</ActionParameter>
			<ActionParameter name="topic">/DS/DS_111_111</ActionParameter>
			<ActionParameter name="QoS">1</ActionParameter>
		</Action>
		
		<!-- Wait for signal that the subscribers disconnected.. -->
		<Action name="sync_components_2" type="SyncComponentAction">
			<dependsOn action_id="SendMessage_1a"/>
			<dependsOn action_id="SendMessage_2a"/>
			<dependsOn action_id="SendMessage_3a"/>
			<ActionParameter name="component_name">Pubs2</ActionParameter>
			<ActionParameter name="component_list">Subs2;Pubs2;Collector2</ActionParameter>
			<ActionParameter name="timeout">180000</ActionParameter>
		</Action>
		
		<!-- Send more messages -->
		<Action name="SendMessage_1b" type="SendMessage" interval="0" repeat="5000" thread="11" repeat_interval="0">
	 	  	<dependsOn action_id="sync_components_2" interval="0" />
			<ActionParameter name="connection_id">CFPub1</ActionParameter>
			<ActionParameter name="message_id">txmsg1b</ActionParameter>
			<ActionParameter name="topic">/DS/DS_111_111</ActionParameter>
			<ActionParameter name="QoS">1</ActionParameter>
		</Action>		
		<Action name="SendMessage_2b" type="SendMessage" interval="0" repeat="5000" thread="22" repeat_interval="0">
	 	  	<dependsOn action_id="sync_components_2" interval="0" />
			<ActionParameter name="connection_id">CFPub2</ActionParameter>
			<ActionParameter name="message_id">txmsg2b</ActionParameter>
			<ActionParameter name="topic">/DS/DS_111_111</ActionParameter>
			<ActionParameter name="QoS">1</ActionParameter>
		</Action>	
		<Action name="SendMessage_3b" type="SendMessage" interval="0" repeat="5000" thread="33" repeat_interval="0">
	 	  	<dependsOn action_id="sync_components_2" interval="0" />
			<ActionParameter name="connection_id">CFPub3</ActionParameter>
			<ActionParameter name="message_id">txmsg3b</ActionParameter>
			<ActionParameter name="topic">/DS/DS_111_111</ActionParameter>
			<ActionParameter name="QoS">1</ActionParameter>
		</Action>
		
		<!-- Wait for signal that the subscribers disconnected.. -->
		<Action name="sync_components_3" type="SyncComponentAction">
			<dependsOn action_id="SendMessage_1b"/>
			<dependsOn action_id="SendMessage_2b"/>
			<dependsOn action_id="SendMessage_3b"/>
			<ActionParameter name="component_name">Pubs3</ActionParameter>
			<ActionParameter name="component_list">Subs3;Pubs3;Collector3</ActionParameter>
			<ActionParameter name="timeout">300000</ActionParameter>
		</Action>

		<Action name="ClosePubConnection1" type="CloseConnection" thread="11" >
			<ActionParameter name="connection_id">CFPub1</ActionParameter>
  		</Action>
  		
  		<Action name="ClosePubConnection2" type="CloseConnection" thread="22" >
			<ActionParameter name="connection_id">CFPub2</ActionParameter>
  		</Action>
 
   		<Action name="ClosePubConnection3" type="CloseConnection" thread="33" >
			<ActionParameter name="connection_id">CFPub3</ActionParameter>
  		</Action>

		<Action name="CreatePubConnection1_Clear" type="CreateConnection" thread="11">
			<ActionParameter name="structure_id">ConPub1</ActionParameter>
			<ActionParameter name="connection_id">CFPub1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Pub1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>		
		<Action name="ClosePubConnection1_Clear" type="CloseConnection" thread="11">
			<ActionParameter name="connection_id">CFPub1</ActionParameter>
		</Action>
		<Action name="CreatePubConnection2_Clear" type="CreateConnection" thread="22">
			<ActionParameter name="structure_id">ConPub2</ActionParameter>
			<ActionParameter name="connection_id">CFPub2</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Pub2</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="ClosePubConnection2_Clear" type="CloseConnection" thread="22">
			<ActionParameter name="connection_id">CFPub2</ActionParameter>
		</Action>
		<Action name="CreatePubConnection3_Clear" type="CreateConnection" thread="33">
			<ActionParameter name="structure_id">ConPub3</ActionParameter>
			<ActionParameter name="connection_id">CFPub3</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Pub3</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="ClosePubConnection3_Clear" type="CloseConnection" thread="33">
			<ActionParameter name="connection_id">CFPub3</ActionParameter>
		</Action>
	</Action>
    
	<Action name="Collector" type="CompositeAction">
		<!--  These CreateConnections will clear out any old client info -->
		<Action name="CreateCollectorConnection_Clear" type="CreateConnection">
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Col1</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Col1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="CloseCollectorConnection_Clear" type="CloseConnection">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
		</Action>
  
  		<!-- These connections are the ones we'll use for testing --> 
		<Action name="CreateSubConnectionCollector1" type="CreateConnection">
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Col1</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Col1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="protocol">mqtt</ApiParameter>
			<ApiParameter name="path">config.ism.ibm.com</ApiParameter>
			<ApiParameter name="cleanSession">false</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
  		</Action>   		 

		<!-- There will only be one subscriber, but the collector will be a DS as well. --> 
		<Action name="SubscribeCollector1_a" type="Subscribe" >
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
			<ApiParameter name="topic">$SharedSubscription/SubDS_111_111_Collector//DS/DS_111_111/+</ApiParameter>
			<ApiParameter name="QoS">1</ApiParameter>
		</Action>			

		<!-- Signal to Publishers that the subscriptions are ready for messages to be sent. -->
		<Action name="sync_components_1" type="SyncComponentAction">
			<dependsOn action_id="SubscribeCollector1_a"/>
			<ActionParameter name="component_name">Collector1</ActionParameter>
			<ActionParameter name="component_list">Subs1;Pubs1;Collector1</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>

		<Action name="CompositeReceiveAll_a" type="CompositeAction" repeat="300" repeat_interval="0">
			<dependsOn action_id="sync_components_1"/>
			<Action name="ReceiveMessageCollector1_a" type="ReceiveMessage">
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
				<ActionParameter name="structure_id">rxmsgCollector1</ActionParameter>
				<ActionParameter name="waitTime">10000</ActionParameter>
			</Action>
		</Action>
			
		<!-- Action name="ShowSubAfterCollectting_a" type="ShellAction">
			<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=SubDS_111_111_Collector</ActionParameter>
			<ActionParameter name="print_result">true</ActionParameter>
		</Action -->	
		
		<Action name="ShowSubAfterCollectting_a" type="RestAPI">
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=SubDS_111_111_Collector</ActionParameter>
        	<ActionParameter name="action">GET</ActionParameter>
        	<ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
        	<ActionParameter name="expectedStatusCode">-1</ActionParameter>
        	<ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>									
	
		<Action name="sync_components_2" type="SyncComponentAction">
			<ActionParameter name="component_name">Collector2</ActionParameter>
			<ActionParameter name="component_list">Subs2;Pubs2;Collector2</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>
		<Action name="sync_components_3" type="SyncComponentAction">
			<dependsOn action_id="sync_components_2"/>
			<ActionParameter name="component_name">Collector3</ActionParameter>
			<ActionParameter name="component_list">Subs3;Pubs3;Collector3</ActionParameter>
			<ActionParameter name="timeout">300000</ActionParameter>
		</Action>

		<Action name="CompositeReceiveAll_b" type="CompositeAction" repeat="15000" repeat_interval="0">
			<dependsOn action_id="sync_components_3"/>
			<Action name="ReceiveMessageCollector1_a" type="ReceiveMessage">
				<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
				<ActionParameter name="structure_id">rxmsgCollector1</ActionParameter>
				<ActionParameter name="waitTime">10000</ActionParameter>
			</Action>
		</Action>
		
		<!-- Action name="ShowSubAfterCollecting_b" type="ShellAction">
			<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=SubDS_111_111_Collector</ActionParameter>
			<ActionParameter name="print_result">true</ActionParameter>
		</Action -->
		
		<Action name="ShowSubAfterCollecting_b" type="RestAPI">
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=SubDS_111_111_Collector</ActionParameter>
        	<ActionParameter name="action">GET</ActionParameter>
        	<ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
        	<ActionParameter name="expectedStatusCode">-1</ActionParameter>
        	<ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>										
			
		<!-- Action name="ShowSubAfterCollector" type="ShellAction">
			<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=SubDS_111_111_Collector</ActionParameter>
			<ActionParameter name="print_result">true</ActionParameter>
		</Action -->
		
		<Action name="ShowSubAfterCollector" type="RestAPI">
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=SubDS_111_111_Collector</ActionParameter>
        	<ActionParameter name="action">GET</ActionParameter>
        	<ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
        	<ActionParameter name="expectedStatusCode">-1</ActionParameter>
        	<ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>												

		<Action name="UnSubscribe_Collector" type="Unsubscribe">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
			<ApiParameter name="topic">$SharedSubscription/SubDS_111_111_Collector//DS/DS_111_111/+</ApiParameter>
		</Action>
		
		<!-- Action name="ShowCollectorSubisGone" type="ShellAction">
			<ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver stat Subscription SubName=SubDS_111_111_Collector</ActionParameter>
			<ActionParameter name="print_result">true</ActionParameter>
			<ActionParameter name="expected_rc">1</ActionParameter>
		</Action -->	
		
		<Action name="ShowCollectorSubisGone" type="RestAPI">
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        	<ActionParameter name="path">/ima/v1/monitor/Subscription?SubName=SubDS_111_111_Collector</ActionParameter>
        	<ActionParameter name="action">GET</ActionParameter>
        	<ActionParameter name="payload"></ActionParameter>
        	<ActionParameter name="printResult">true</ActionParameter>
        	<ActionParameter name="expectedStatusCode">-1</ActionParameter>
        	<ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>	
        
		<Action name="compareShowCollectorSubisGone" type="CompareREST" rc="1" reason="ISMTEST3416">
        	<ActionParameter name="structureID">stat_output_1_again</ActionParameter>
        	<ActionParameter name="topLevelKey">Subscription</ActionParameter>
        	<ActionParameter name="subObjectKey">SubName</ActionParameter>
        	<ActionParameter name="subObjectName">SubDS_111_111_Collector</ActionParameter>
    	</Action>							
		
		<Action name="CloseSubConnectionCollector1_a" type="CloseConnection" >
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
		</Action>			
		
		<Action name="CreateConnectionMQTT_DS_000_Collector1reclear" type="CreateConnection">
			<ActionParameter name="structure_id">ConMQTT_DS_111_111_Col1</ActionParameter>
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
			<include>../common/ConnectionType.xml</include>
			<include>../common/MQTT_server.xml</include>
			<ApiParameter name="clientId">MQTT_DS_111_111_Col1</ApiParameter>
			<ApiParameter name="port">29400</ApiParameter>
			<ApiParameter name="cleanSession">true</ApiParameter>
		</Action>
		<Action name="CloseConnectionCollector1reclear" type="CloseConnection">
			<ActionParameter name="connection_id">CFMQTT_DS_111_111_Col1</ActionParameter>
		</Action>
	 </Action>
      <Action name="ResetTraceLevel" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"TraceLevel":"5"}</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
      </Action>


</IsmWSTest>
