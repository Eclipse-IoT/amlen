<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2016-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
-->
<IsmWSTest name="testmqttv5_cleanstate_01" >

<SyncClient>
    <server>
        <include>../common/JMS_syncip.xml</include>
        <include>../common/JMS_syncport.xml</include>
    </server>
    <solution>testmqttv5_cleanstate_01</solution>
</SyncClient>


<Action name="setupSessions" type="CompositeAction">
    <!-- Clean all Sessions, later Establish ODD# Client Sessions before test starts -->
    <Action name="CleanSessionConnection-1" type="CreateConnection">
        <ActionParameter name="structure_id">Con1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-1</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-2" type="CreateConnection">
        <ActionParameter name="structure_id">Con2</ActionParameter>
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-2</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-3" type="CreateConnection">
        <ActionParameter name="structure_id">Con3</ActionParameter>
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-3</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-4" type="CreateConnection">
        <ActionParameter name="structure_id">Con4</ActionParameter>
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-4</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-5" type="CreateConnection">
        <ActionParameter name="structure_id">Con5</ActionParameter>
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-5</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-6" type="CreateConnection">
        <ActionParameter name="structure_id">Con6</ActionParameter>
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-6</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-7</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-8" type="CreateConnection">
        <ActionParameter name="structure_id">Con8</ActionParameter>
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-8</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-9" type="CreateConnection">
        <ActionParameter name="structure_id">Con9</ActionParameter>
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-9</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-10" type="CreateConnection">
        <ActionParameter name="structure_id">Con10</ActionParameter>
        <ActionParameter name="connection_id">CF10</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-10</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-11" type="CreateConnection">
        <ActionParameter name="structure_id">Con11</ActionParameter>
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-11</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-12" type="CreateConnection">
        <ActionParameter name="structure_id">Con12</ActionParameter>
        <ActionParameter name="connection_id">CF12</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-12</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-13" type="CreateConnection">
        <ActionParameter name="structure_id">Con13</ActionParameter>
        <ActionParameter name="connection_id">CF13</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-13</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="CleanSessionConnection-14" type="CreateConnection">
        <ActionParameter name="structure_id">Con14</ActionParameter>
        <ActionParameter name="connection_id">CF14</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-14</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    
    <!-- Close the ODD# Client to Expire any previous Session -->
    <Action name="CloseCleanSessionConnection1" type="CloseConnection">
        <dependsOn action_id="CleanSessionConnection-1" interval="2000"/>
        <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>

    <Action name="CloseCleanSessionConnection3" type="CloseConnection">
        <dependsOn action_id="CleanSessionConnection-3" interval="2000"/>
        <ActionParameter name="connection_id">CF3</ActionParameter>
    </Action>

    <Action name="CloseCleanSessionConnection5" type="CloseConnection">
        <dependsOn action_id="CleanSessionConnection-5" interval="2000"/>
        <ActionParameter name="connection_id">CF5</ActionParameter>
    </Action>

    <Action name="CloseCleanSessionConnection7" type="CloseConnection">
        <dependsOn action_id="CleanSessionConnection-7" interval="2000"/>
        <ActionParameter name="connection_id">CF7</ActionParameter>
    </Action>

    <Action name="CloseCleanSessionConnection9" type="CloseConnection">
        <dependsOn action_id="CleanSessionConnection-9" interval="2000"/>
        <ActionParameter name="connection_id">CF9</ActionParameter>
    </Action>

    <Action name="CloseCleanSessionConnection11" type="CloseConnection">
        <dependsOn action_id="CleanSessionConnection-11" interval="2000"/>
        <ActionParameter name="connection_id">CF11</ActionParameter>
    </Action>

    <Action name="CloseCleanSessionConnection13" type="CloseConnection">
        <dependsOn action_id="CleanSessionConnection-13" interval="2000"/>
        <ActionParameter name="connection_id">CF13</ActionParameter>
    </Action>

    
    <!-- Reopen the ODD# Client to have a Durable Session for 300 seconds  
         Do I need in each connect?
        <ActionParameter name="persistenceDirectory">v5client01-#</ActionParameter>
    -->
    
    <Action name="DurableSessionConnection-1" type="CreateConnection">
        <ActionParameter name="structure_id">Con1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-1</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">300</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="DurableSessionConnection-3" type="CreateConnection">
        <ActionParameter name="structure_id">Con3</ActionParameter>
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-3</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">300</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="DurableSessionConnection-5" type="CreateConnection">
        <ActionParameter name="structure_id">Con5</ActionParameter>
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-5</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">300</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="DurableSessionConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-7</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">300</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="DurableSessionConnection-9" type="CreateConnection">
        <ActionParameter name="structure_id">Con9</ActionParameter>
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-9</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">300</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="DurableSessionConnection-11" type="CreateConnection">
        <ActionParameter name="structure_id">Con11</ActionParameter>
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-11</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">300</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <Action name="DurableSessionConnection-13" type="CreateConnection">
        <ActionParameter name="structure_id">Con13</ActionParameter>
        <ActionParameter name="connection_id">CF13</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-13</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">300</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>


    <Action name="SubscriptionMonitorSetupSessions" type="RestAPI">
        <dependsOn action_id="DurableSessionConnection-13" interval="5000"/>
        <ActionParameter name="structureID">status_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client01*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="ClientMonitorSetupSessions" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="CloseConnection1" type="CloseConnection">
        <dependsOn action_id="ClientMonitorSetupSessions" interval="2000"/>
        <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>
    <Action name="CloseConnection2" type="CloseConnection">
        <ActionParameter name="connection_id">CF2</ActionParameter>
    </Action>
    <Action name="CloseConnection3" type="CloseConnection">
        <ActionParameter name="connection_id">CF3</ActionParameter>
    </Action>
    <Action name="CloseConnection4" type="CloseConnection">
        <ActionParameter name="connection_id">CF4</ActionParameter>
    </Action>
    <Action name="CloseConnection5" type="CloseConnection">
        <ActionParameter name="connection_id">CF5</ActionParameter>
    </Action>
    <Action name="CloseConnection6" type="CloseConnection">
        <ActionParameter name="connection_id">CF6</ActionParameter>
    </Action>
    <Action name="CloseConnection7" type="CloseConnection">
        <ActionParameter name="connection_id">CF7</ActionParameter>
    </Action>
    <Action name="CloseConnection8" type="CloseConnection">
        <ActionParameter name="connection_id">CF8</ActionParameter>
    </Action>
    <Action name="CloseConnection9" type="CloseConnection">
        <ActionParameter name="connection_id">CF9</ActionParameter>
    </Action>
    <Action name="CloseConnection10" type="CloseConnection">
        <ActionParameter name="connection_id">CF10</ActionParameter>
    </Action>
    <Action name="CloseConnection11" type="CloseConnection">
        <ActionParameter name="connection_id">CF11</ActionParameter>
    </Action>
    <Action name="CloseConnection12" type="CloseConnection">
        <ActionParameter name="connection_id">CF12</ActionParameter>
    </Action>
    <Action name="CloseConnection13" type="CloseConnection">
        <ActionParameter name="connection_id">CF13</ActionParameter>
    </Action>
    <Action name="CloseConnection14" type="CloseConnection">
        <ActionParameter name="connection_id">CF14</ActionParameter>
    </Action>

    <Action name="SubscriptionMonitorTestCleanState" type="RestAPI">
        <dependsOn action_id="CloseConnection14" interval="5000"/>
        <ActionParameter name="structureID">status_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client01*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="ClientMonitorTestCleanState" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=all</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <!-- Verify EVEN# Clients have NON-Durable Sessions -->
    <Action name="VerifyNonDurableStart-2" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-2</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyNonDurableStart-4" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-4</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyNonDurableStart-6" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-6</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyNonDurableStart-8" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-8</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyNonDurableStart-10" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-10</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyNonDurableStart-12" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-12</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyNonDurableStart-14" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-14</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   

    <!-- Verify ODD# Clients have Durable Sessions -->
    <Action name="VerifyDurableCreated-1" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-1</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="LastConnectedTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>   
    <Action name="VerifyDurableCreated-3" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-3</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="LastConnectedTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>   
    <Action name="VerifyDurableCreated-5" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-5</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="LastConnectedTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>   
    <Action name="VerifyDurableCreated-7" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-7</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="LastConnectedTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>   
    <Action name="VerifyDurableCreated-9" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-9</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="LastConnectedTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>   
    <Action name="VerifyDurableCreated-11" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-11</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="LastConnectedTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>   
    <Action name="VerifyDurableCreated-13" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-13</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="LastConnectedTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>   



</Action>



<!-- =============  testCleanStart  ========================== -->



<Action name="testCleanStart" type="CompositeAction">
    <!-- Durable is thrown away, nondurable
    -->
    <Action name="CreateConnection-1" type="CreateConnection">
        <ActionParameter name="structure_id">Con1</ActionParameter>
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-1</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- nondurable -->
    <Action name="CreateConnection-2" type="CreateConnection">
        <ActionParameter name="structure_id">Con2</ActionParameter>
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-2</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- Start durable but expire on exit -->
    <Action name="CreateConnection-3" type="CreateConnection">
        <ActionParameter name="structure_id">Con3</ActionParameter>
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-3</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">true</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- nondurable -->
    <Action name="CreateConnection-4" type="CreateConnection">
        <ActionParameter name="structure_id">Con4</ActionParameter>
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-4</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- was durable but trashed it, expire on exit -->
    <Action name="CreateConnection-5" type="CreateConnection">
        <ActionParameter name="structure_id">Con5</ActionParameter>
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-5</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">true</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- nondurable -->
    <Action name="CreateConnection-6" type="CreateConnection">
        <ActionParameter name="structure_id">Con6</ActionParameter>
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-6</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- Start durable but expire on exit-->
    <Action name="CreateConnection-7" type="CreateConnection">
        <ActionParameter name="structure_id">Con7</ActionParameter>
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-7</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">true</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- nondurable -->
    <Action name="CreateConnection-8" type="CreateConnection">
        <ActionParameter name="structure_id">Con8</ActionParameter>
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-8</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-9" type="CreateConnection">
        <ActionParameter name="structure_id">Con9</ActionParameter>
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-9</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">true</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-10" type="CreateConnection">
        <ActionParameter name="structure_id">Con10</ActionParameter>
        <ActionParameter name="connection_id">CF10</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-10</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-11" type="CreateConnection">
        <ActionParameter name="structure_id">Con11</ActionParameter>
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-11</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">true</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-12" type="CreateConnection">
        <ActionParameter name="structure_id">Con12</ActionParameter>
        <ActionParameter name="connection_id">CF12</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-12</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-13" type="CreateConnection">
        <ActionParameter name="structure_id">Con13</ActionParameter>
        <ActionParameter name="connection_id">CF13</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-13</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">true</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>

    <!-- durable -->
    <Action name="CreateConnection-14" type="CreateConnection">
        <ActionParameter name="structure_id">Con14</ActionParameter>
        <ActionParameter name="connection_id">CF14</ActionParameter>
        <ActionParameter name="connectionType">PAHO-MQTTv5</ActionParameter>
        <include>../common/MQTT_server.xml</include>
        <ApiParameter name="clientId">v5client01-14</ApiParameter>
        <ApiParameter name="port">33000</ApiParameter>
        <ApiParameter name="compareSessionPresent">false</ApiParameter>
        <ApiParameter name="cleanSession">false</ApiParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
        <ApiParameter name="protocol">mqtt</ApiParameter>
        <ApiParameter name="path">config.ism.ibm.com</ApiParameter>
    </Action>


    <Action name="Subscribe1" type="Subscribe">
        <ActionParameter name="connection_id">CF1</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic1</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe2" type="Subscribe">
        <ActionParameter name="connection_id">CF2</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic2</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe3" type="Subscribe">
        <ActionParameter name="connection_id">CF3</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic3</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe4" type="Subscribe">
        <ActionParameter name="connection_id">CF4</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic4</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe5" type="Subscribe">
        <ActionParameter name="connection_id">CF5</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic5</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe6" type="Subscribe">
        <ActionParameter name="connection_id">CF6</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic6</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe7" type="Subscribe">
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic7</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe8" type="Subscribe">
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic8</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe9" type="Subscribe">
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic9</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe10" type="Subscribe">
        <ActionParameter name="connection_id">CF10</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic10</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe11" type="Subscribe">
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic11</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe12" type="Subscribe">
        <ActionParameter name="connection_id">CF12</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic12</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe13" type="Subscribe">
        <ActionParameter name="connection_id">CF13</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic13</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>

    <Action name="Subscribe14" type="Subscribe">
        <ActionParameter name="connection_id">CF14</ActionParameter>
        <ApiParameter name="topic">mqttv5-01/topic14</ApiParameter>
        <ApiParameter name="QoS">2</ApiParameter>
    </Action>





    <Action name="SubscriptionMonitorVerifyDurable" type="RestAPI">
        <dependsOn action_id="Subscribe14" interval="5000"/>
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/monitor/Subscription?ClientID=v5client01*</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <Action name="VerifyNonDurable-1" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-1</ActionParameter>
        <!-- <ObjectProperty name="IsShared" value="true"/> -->
        <!-- <ObjectProperty name="TopicString" value="ErrorTopic/+"/> -->
        <!-- <ObjectProperty name="Consumers" value="1"/> -->
        <ObjectProperty name="IsDurable" value="false"/>
    </Action>   

    <Action name="VerifyNonDurable-2" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-2</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 
    <Action name="VerifyNonDurable-3" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-3</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyNonDurable-4" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-4</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 
    
    <Action name="VerifyNonDurable-5" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-5</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 
    <Action name="VerifyNonDurable-6" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-6</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 

    <Action name="VerifyDurable-7" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-7</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyNonDurable-8" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-8</ActionParameter>
        <ObjectProperty name="IsDurable" value="false"/>
    </Action> 

    <Action name="VerifyDurable-9" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-9</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-10" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-10</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-11" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-11</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-12" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-12</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-13" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-13</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 
    <Action name="VerifyDurable-14" type="CompareREST">
        <ActionParameter name="structureID">submonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">Subscription</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-14</ActionParameter>
        <ObjectProperty name="IsDurable" value="true"/>
    </Action> 

    
    <Action name="ClientMonitorVerifyDurable" type="RestAPI">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=connected</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>




    <!-- CleanStart, No Expiry, session deleted immediately -->
    <Action name="CloseConnection1" type="CloseConnection">
        <dependsOn action_id="ClientMonitorVerifyDurable" interval="5000"/>
        <ActionParameter name="connection_id">CF1</ActionParameter>
    </Action>
    <!-- CleanStart, No Expiry, session deleted immediately -->
    <Action name="CloseConnection2" type="CloseConnection">
        <ActionParameter name="connection_id">CF2</ActionParameter>
    </Action>

    <!-- Durable Session, No Expiry session deleted immediately -->
    <Action name="CloseConnection3" type="CloseConnection">
        <ActionParameter name="connection_id">CF3</ActionParameter>
    </Action>
    <!-- New Session, No Expiry, session deleted immediately -->
    <Action name="CloseConnection4" type="CloseConnection">
        <ActionParameter name="connection_id">CF4</ActionParameter>
    </Action>

    <!-- Durable Session, Expiry=0, session deleted immediately -->
    <Action name="CloseConnection5" type="CloseConnection">
        <ActionParameter name="connection_id">CF5</ActionParameter>
    </Action>
    <!-- New Session, Expiry=0, session deleted immediately -->
    <Action name="CloseConnection6" type="CloseConnection">
        <ActionParameter name="connection_id">CF6</ActionParameter>
    </Action>

    <!-- Durable Session, Expiry=0 overridden, THIS IS AN ERROR when Enter with Expiry:0 -->
    <Action name="CloseConnection7" type="CloseConnection">
        <ActionParameter name="connection_id">CF7</ActionParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
    </Action>
    <!-- New Session, Expiry=0 overridden, THIS IS AN ERROR when Enter with Expiry:0  -->
    <Action name="CloseConnection8" type="CloseConnection">
        <ActionParameter name="connection_id">CF8</ActionParameter>
        <ApiParameter name="sessionExpire">4294967295</ApiParameter>
    </Action>

    <!-- Durable Session, NeverExpire overridden, session deleted immediately -->
    <Action name="CloseConnection9" type="CloseConnection">
        <ActionParameter name="connection_id">CF9</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>
    <!-- New Session, NeverExpire overridden, session deleted immediately -->
    <Action name="CloseConnection10" type="CloseConnection">
        <ActionParameter name="connection_id">CF10</ActionParameter>
        <ApiParameter name="sessionExpire">0</ApiParameter>
    </Action>

    <!-- Durable Session, NeverExpire overridden, Durable Session for 30 sec after disconnect -->
    <Action name="CloseConnection11" type="CloseConnection">
        <ActionParameter name="connection_id">CF11</ActionParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
    </Action>
    <!-- New Session, NeverExpire overridden, Durable Session for 30 sec after disconnect -->
    <Action name="CloseConnection12" type="CloseConnection">
        <ActionParameter name="connection_id">CF12</ActionParameter>
        <ApiParameter name="sessionExpire">30</ApiParameter>
    </Action>

    <!-- Durable Session, Expire=30sec, Durable Session for 30 sec after disconnect -->
    <Action name="CloseConnection13" type="CloseConnection">
        <ActionParameter name="connection_id">CF13</ActionParameter>
    </Action>
    <!-- New Session, Expire=30sec, Durable Session for 30 sec after disconnect -->
    <Action name="CloseConnection14" type="CloseConnection">
        <ActionParameter name="connection_id">CF14</ActionParameter>
    </Action>





    <Action name="ClientMonitor-after10s" type="RestAPI">
        <dependsOn action_id="CloseConnection14" interval="10000"/>
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=All</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>
    
    <!-- Expiry=0 or unset, all expire on disconnect and are not listed -->
    <Action name="VerifyClient-1-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-1</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClient-2-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-2</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClient-3-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-3</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClient-4-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-4</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClient-5-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-5</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClient-6-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-6</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClient-9-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-9</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    <Action name="VerifyClient-10-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-10</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/>
    </Action>   
    
    <!-- Close Expiry UINT_MAX (Protocol Error, if Connect Expiry=0, so must Disconnect Expiry=0) -->
<!-- Verified: Defect 200526 -  BOTH Client 7 and 8 should be ISMTEST3410 -->
    <Action name="VerifyClient-7-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-7</ActionParameter>
        <ObjectProperty name="IsConnected" value="null"/>
    </Action>  
    <Action name="VerifyClient-8-NotPersistAfter10s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-8</ActionParameter>
        <ObjectProperty name="ExpiryTime" value="null"/> 
    </Action>  

    <!-- Session Expiry 30 secs   -->
    <Action name="VerifyClient-11-PersistAfter10s" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-11</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>  
    <Action name="VerifyClient-12-PersistAfter10s" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-12</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>  
    <Action name="VerifyClient-13-PersistAfter10s" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-13</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>  
    <Action name="VerifyClient-14-PersistAfter10s" type="CompareREST">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-14</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
        <ObjectProperty name="ExpiryTime" value="REGEXP: \d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)"/>
    </Action>  
    
    <!-- expect no MQTT Clients, all closed -->
    <Action name="ClientMonitor-after40s" type="RestAPI">
        <dependsOn action_id="VerifyClient-14-PersistAfter10s" interval="40000"/>
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/monitor/MQTTClient?ClientID=v5client01*%26ResultCount=50%26ConnectionState=All</ActionParameter>
        <ActionParameter name="action">GET</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
    </Action>

    <!-- Sessions Expired at 30 secs. Since all gone, not get 3410 this time.
        Receive 3416 Top Object is Empty.  Therefore only really need to check once for ISMTEST3416
    <Action name="VerifyClient-11-PersistAfter40s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-11</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  
    <Action name="VerifyClient-12-PersistAfter40s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-12</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  
    <Action name="VerifyClient-13-PersistAfter40s" type="CompareREST" rc="1" reason="ISMTEST3410">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-13</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  
    -->
    <Action name="VerifyClient-NONE-PersistAfter40s" type="CompareREST" rc="1" reason="ISMTEST3416">
        <ActionParameter name="structureID">clientmonitor_output</ActionParameter>
        <ActionParameter name="topLevelKey">MQTTClient</ActionParameter>
        <ActionParameter name="subObjectKey">ClientID</ActionParameter>
        <ActionParameter name="subObjectName">v5client01-14</ActionParameter>
        <ObjectProperty name="IsConnected" value="false"/>
    </Action>  
    
    
</Action>

</IsmWSTest>
                
