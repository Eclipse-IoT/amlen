<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2016-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
-->
<IsmClientSetTest name="RESTAPI_OrgStay_ClientSetStream" >
<!--
    A more complex common topic space. 
-->

    <SyncClient>
        <server>
            <include>../common/JMS_syncip.xml</include>
            <include>../common/JMS_syncport.xml</include>
        </server>
        <solution>testmqtt_multiClientSet</solution>
    </SyncClient>

<!-- ***** Client 0 starts here.  Continuously active Subscriber and Publisher to the topic  -->
<!-- *** Publish0    *** -->
    <Action name="publish0" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConP0</ActionParameter>
            <ActionParameter name="connection_id">CFP0</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid0</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
            <ActionParameter name="connection_id">CFP0</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConP0</ActionParameter>
            <ActionParameter name="connection_id">CFP0</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid0</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>

        
        <Action name="CreateMessage" type="CreateMessage">
            <ActionParameter name="structure_id">msg0</ActionParameter>
            <ActionParameter name="connection_id">CFP0</ActionParameter>
            <ApiParameter name="msgType">TEXT</ApiParameter>
            <ApiParameter name="payload">Sent by Publisher 0 in ORG ${OrgStay} </ApiParameter>
        </Action>
        

        <!-- there may need to be a delay here, while the control channel does its thing 
        and the Bloomfilter is created to show that the subscriber on a different cluster
        member exists -->
        
        <Action name="sync_components_P00" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub00</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub00;OrgStaypub00</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
<!-- Publish Before the Export -->                
        <Action name="PublishToMany_P00" type="PublishTopicTree"  repeat="200">
            <dependsOn action_id="sync_components_P00" interval="500" />
            <ActionParameter name="connection_id">CFP0</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/000/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>
  
<!-- Publish After the Export -->        
        <Action name="sync_components_P01" type="SyncComponentAction"> 
            <dependsOn action_id="PublishToMany_P00" interval="500" />
            <ActionParameter name="component_name">OrgStaypub01</ActionParameter>
            <ActionParameter name="component_list">EXPORT;OrgStaysub01;OrgStaypub01</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P01" type="PublishTopicTree"  repeat="200">
            <dependsOn action_id="sync_components_P01" interval="500" />
            <ActionParameter name="connection_id">CFP0</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/000/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>

  
<!-- Publish After the Import -->        
        <Action name="sync_components_P02" type="SyncComponentAction"> 
            <dependsOn action_id="PublishToMany_P01" interval="500" />
            <ActionParameter name="component_name">OrgStaypub02</ActionParameter>
            <ActionParameter name="component_list">IMPORT;OrgStaysub02;OrgStaypub02</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P02" type="PublishTopicTree"  repeat="200">
            <dependsOn action_id="sync_components_P02" interval="500" />
            <ActionParameter name="connection_id">CFP0</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/000/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>

        <Action name="sync_components_P03" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub03</ActionParameter>
            <ActionParameter name="component_list">OrgStaypub03</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>


        <Action name="sync_components_P04" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub04</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaypub04</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>

        <!-- it was cleansession=false, so this will leave a publisher client to delete -->
        <Action name="CloseConnection" type="CloseConnection">
            <ActionParameter name="connection_id">CFP0</ActionParameter>
        </Action>
                      
    </Action>

    
<!-- *** Subscribe 0 *** -->
    <Action name="subscribe0" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConS0</ActionParameter>
            <ActionParameter name="connection_id">CFS0</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid0</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
               <ActionParameter name="connection_id">CFS0</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConS0</ActionParameter>
            <ActionParameter name="connection_id">CFS0</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid0</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>
        
        <Action name="SubscribeToMany_S00" type="SubscribeTopicTree">
            <ActionParameter name="connection_id">CFS0</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/000/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
        </Action>        
		 
        <Action name="sync_components_S00" type="SyncComponentAction"> 
          <dependsOn action_id="SubscribeToMany_S00" interval="500" />
            <ActionParameter name="component_name">OrgStaysub00</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub00;OrgStaypub00</ActionParameter>
            <ActionParameter name="timeout">40000</ActionParameter>
        </Action>        

<!-- *** Receive Before Export *** -->
        
		<Action name="ReceiveMessages_S00" type="CompositeAction" repeat="2000" repeat_interval="0">
            <Action name="ReceiveMessage_S00" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS0</ActionParameter>
                <ActionParameter name="structure_id">submsg0</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        

		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S00" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS0</ActionParameter>
	    	<ActionParameter name="structure_id">submsg0</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   
        
        <Action name="sync_components_S01" type="SyncComponentAction"> 
            <dependsOn action_id="ReceiveNoMore_S00" interval="500" />
            <ActionParameter name="component_name">OrgStaysub01</ActionParameter>
            <ActionParameter name="component_list">EXPORT;OrgStaysub01</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>


<!-- *** Receive After Export *** -->
        
		<Action name="ReceiveMessages_S01" type="CompositeAction" repeat="2000" repeat_interval="0">
            <Action name="ReceiveMessage_S01" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS0</ActionParameter>
                <ActionParameter name="structure_id">submsg0</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        

		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S01" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS0</ActionParameter>
	    	<ActionParameter name="structure_id">submsg0</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   
        
        <Action name="sync_components_S02" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub02</ActionParameter>
            <ActionParameter name="component_list">IMPORT;OrgStaysub02</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>


<!-- *** Receive After Import *** -->
		<Action name="ReceiveMessages_S02" type="CompositeAction" repeat="2000" repeat_interval="0">
            <Action name="ReceiveMessage_S02" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS0</ActionParameter>
                <ActionParameter name="structure_id">submsg0</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        

		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S02" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS0</ActionParameter>
	    	<ActionParameter name="structure_id">submsg0</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   
		
        <Action name="sync_components_S03" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub03</ActionParameter>
            <ActionParameter name="component_list">OrgStaypub03;OrgStaysub03</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
        

        <Action name="sync_components_S04" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub04</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaysub04</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
		
        <Action name="CloseConnection" type="CloseConnection">
            <ActionParameter name="connection_id">CFS0</ActionParameter>
        </Action>          



    </Action>
	

<!-- ***** Client 1 starts here.  Only a Subscriber, no Publish history to the topic  -->
<!-- *** Publish1    *** -->
    <Action name="publish1" type="CompositeAction">

        <Action name="CreateCleanConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConP1</ActionParameter>
            <ActionParameter name="connection_id">CFP1</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid1</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>
		
        <Action name="CloseConnectionClean" type="CloseConnection">
            <ActionParameter name="connection_id">CFP1</ActionParameter>
        </Action>          
        

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConP1</ActionParameter>
            <ActionParameter name="connection_id">CFP1</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid1</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>

        <Action name="CreateMessage" type="CreateMessage">
            <ActionParameter name="structure_id">msg1</ActionParameter>
            <ActionParameter name="connection_id">CFP1</ActionParameter>
            <ApiParameter name="msgType">TEXT</ApiParameter>
            <ApiParameter name="payload">Sent by Publisher 1 in ORG ${OrgStay} </ApiParameter>
        </Action>
        

<!-- (No Publish before Export, Publish after Export -->
        <Action name="sync_components_P11" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub11</ActionParameter>
            <ActionParameter name="component_list">EXPORT;OrgStaysub11;OrgStaypub11</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P11" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P11" interval="500" />
            <ActionParameter name="connection_id">CFP1</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/001/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>
        

<!-- Publish after Import -->
        <Action name="sync_components_P12" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub12</ActionParameter>
            <ActionParameter name="component_list">IMPORT;OrgStaysub12;OrgStaypub12</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P12" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P12" interval="500" />
            <ActionParameter name="connection_id">CFP1</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/001/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>

		
        <Action name="sync_components_P14" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub14</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaypub14</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
		
        <!-- it was cleansession=false, so this will leave a publisher client to delete --> 
        <Action name="CloseConnection" type="CloseConnection">
            <ActionParameter name="connection_id">CFP1</ActionParameter>
        </Action>
        
    </Action>


<!-- *** Subscribe 1 *** -->
    <Action name="subscribe1" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConS1</ActionParameter>
            <ActionParameter name="connection_id">CFS1</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid1</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
               <ActionParameter name="connection_id">CFS1</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConS1</ActionParameter>
            <ActionParameter name="connection_id">CFS1</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid1</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>
        
        <Action name="SubscribeToMany_S10" type="SubscribeTopicTree">
            <ActionParameter name="connection_id">CFS1</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/001/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
        </Action>        


		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S10" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS1</ActionParameter>
	    	<ActionParameter name="structure_id">submsg1</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   
        
        <Action name="sync_components_S11" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub11</ActionParameter>
            <ActionParameter name="component_list">EXPORT;OrgStaysub11</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>


<!-- *** Receive After Export *** -->
        
		<Action name="ReceiveMessages_S11" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S11" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS1</ActionParameter>
                <ActionParameter name="structure_id">submsg1</ActionParameter>
                <ActionParameter name="waitTime">15000</ActionParameter>
            </Action>
        </Action>
        

		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S11" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS1</ActionParameter>
	    	<ActionParameter name="structure_id">submsg1</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   
        
        <Action name="sync_components_S12" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub12</ActionParameter>
            <ActionParameter name="component_list">IMPORT;OrgStaysub12</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>


<!-- *** Receive After Import *** -->
        
		<Action name="ReceiveMessages_S12" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S12" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS1</ActionParameter>
                <ActionParameter name="structure_id">submsg1</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        

		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S12" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS1</ActionParameter>
	    	<ActionParameter name="structure_id">submsg1</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   

		

        <Action name="sync_components_S14" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub14</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaysub14</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>

        <Action name="CloseConnection" type="CloseConnection">
                   <ActionParameter name="connection_id">CFS1</ActionParameter>
        </Action>

            
    </Action>
	
<!-- ***** Client 2 starts here.  Only Create the DS for Subscriber, All msgs are retained until after the Export, Publish messages to the topic  -->
<!-- *** Publish2    *** -->
    <Action name="publish2" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConP2</ActionParameter>
            <ActionParameter name="connection_id">CFP2</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid2</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
            <ActionParameter name="connection_id">CFP2</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConP2</ActionParameter>
            <ActionParameter name="connection_id">CFP2</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid2</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>

        
        <Action name="CreateMessage" type="CreateMessage">
            <ActionParameter name="structure_id">msg2</ActionParameter>
            <ActionParameter name="connection_id">CFP2</ActionParameter>
            <ApiParameter name="msgType">TEXT</ApiParameter>
            <ApiParameter name="payload">Sent by Publisher 2 in ORG ${OrgStay} </ApiParameter>
        </Action>
        

        <!-- there may need to be a delay here, while the control channel does its thing 
        and the Bloomfilter is created to show that the subscriber on a different cluster
        member exists -->
        
        <Action name="sync_components_P20" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub20</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub20;OrgStaypub20</ActionParameter>
            <ActionParameter name="timeout">40000</ActionParameter>
        </Action>
            
<!-- Publish Before the Export -->                
        <Action name="PublishToMany_P20" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P20" interval="500" />
            <ActionParameter name="connection_id">CFP2</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/002/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>

  
<!-- Publish After the Export -->        
        <Action name="sync_components_P21" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub21</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub21c;OrgStaypub21</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P21" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P21" interval="500" />
            <ActionParameter name="connection_id">CFP2</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/002/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>

  
<!-- Publish After the Import -->        
        <Action name="sync_components_P22" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub22</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub22c;OrgStaypub22</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P22" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P22" interval="500" />
            <ActionParameter name="connection_id">CFP2</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/002/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>



        <Action name="sync_components_P24" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub24</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaypub24</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>

        <!-- it was cleansession=false, so this will leave a publisher client to delete --> 
        <Action name="CloseConnection" type="CloseConnection">
            <ActionParameter name="connection_id">CFP2</ActionParameter>
        </Action>
        
    </Action>

    
<!-- *** Subscribe 2 *** -->
    <Action name="subscribe2" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConS2</ActionParameter>
            <ActionParameter name="connection_id">CFS2</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid2</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
               <ActionParameter name="connection_id">CFS2</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConS2</ActionParameter>
            <ActionParameter name="connection_id">CFS2</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid2</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>
        
        <Action name="SubscribeToMany_20" type="SubscribeTopicTree">
            <ActionParameter name="connection_id">CFS2</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/002/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
        </Action>        

<!-- Publisher pubs before Export, Sub does not receive until after Export -->
        <Action name="sync_components_S20" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub20</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub20;OrgStaypub20</ActionParameter>
            <ActionParameter name="timeout">40000</ActionParameter>
        </Action>
			 
<!-- After EXPORT - NOW Receive the messages from Published before EXPORT --> 
        <Action name="sync_components_S21" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub21</ActionParameter>
            <ActionParameter name="component_list">EXPORT;OrgStaysub21</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
			 
		<Action name="ReceiveMessages_S21" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S21" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS2</ActionParameter>
                <ActionParameter name="structure_id">submsg2</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        
		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S21" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS2</ActionParameter>
	    	<ActionParameter name="structure_id">submsg2</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   
			 
        <Action name="sync_components_S21c" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub21c</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub21c</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
			 
<!-- After IMPORT, Receive messages published after the Export -->
        <Action name="sync_components_S22" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub22</ActionParameter>
            <ActionParameter name="component_list">IMPORT;OrgStaysub22</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
			 
		<Action name="ReceiveMessages_S22" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S22" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS2</ActionParameter>
                <ActionParameter name="structure_id">submsg2</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        

		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S22" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS2</ActionParameter>
	    	<ActionParameter name="structure_id">submsg2</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   
			 
        <Action name="sync_components_S22c" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub22c</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub22c</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>


        <Action name="sync_components_S24" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub24</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaysub24</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>

        <Action name="CloseConnection" type="CloseConnection">
                   <ActionParameter name="connection_id">CFS2</ActionParameter>
        </Action>

		
    </Action>
	
<!-- ***** Client 3 starts here.  A Subscriber who had recv some msgs but not all, A Publisher to the topic  -->
<!-- *** Publish3    *** -->
    <Action name="publish3" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConP3</ActionParameter>
            <ActionParameter name="connection_id">CFP3</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid3</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
            <ActionParameter name="connection_id">CFP3</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConP3</ActionParameter>
            <ActionParameter name="connection_id">CFP3</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid3</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>

        
        <Action name="CreateMessage" type="CreateMessage">
            <ActionParameter name="structure_id">msg3</ActionParameter>
            <ActionParameter name="connection_id">CFP3</ActionParameter>
            <ApiParameter name="msgType">TEXT</ApiParameter>
            <ApiParameter name="payload">Sent by Publisher 3 in ORG ${OrgStay} </ApiParameter>
        </Action>
        

<!-- Publish Before EXPORT -->
        <Action name="sync_components_P30" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub30</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub30;OrgStaypub30</ActionParameter>
            <ActionParameter name="timeout">40000</ActionParameter>
        </Action>
            
        <Action name="PublishToMany_P30" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P30" interval="500" />
            <ActionParameter name="connection_id">CFP3</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/003/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>
        
        <Action name="sync_components_P30c" type="SyncComponentAction"> 
            <dependsOn action_id="PublishToMany_P30" interval="500" />
            <ActionParameter name="component_name">OrgStaypub30c</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub30c;OrgStaypub30c</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P30c" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P30c" interval="500" />
            <ActionParameter name="connection_id">CFP3</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/003/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>
		
<!-- Publish After EXPORT -->
        <Action name="sync_components_P31" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub31</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub31c;OrgStaypub31</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P31" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P31" interval="500" />
            <ActionParameter name="connection_id">CFP3</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/003/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>
        
<!-- Publish After IMPORT -->
        <Action name="sync_components_P32" type="SyncComponentAction"> 
            <dependsOn action_id="PublishToMany_P31" interval="500" />
            <ActionParameter name="component_name">OrgStaypub32c</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub32c;OrgStaypub32c</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P32" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P32" interval="500" />
            <ActionParameter name="connection_id">CFP3</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/003/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>
		
		
  
        <Action name="sync_components_P34" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub34</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaypub34</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
  
        <!-- it was cleansession=false, so this will leave a publisher client to delete --> 
        <Action name="CloseConnection" type="CloseConnection">
            <ActionParameter name="connection_id">CFP3</ActionParameter>
        </Action>
        
    </Action>

    
<!-- *** Subscribe 3 *** -->
    <Action name="subscribe3" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConS3</ActionParameter>
            <ActionParameter name="connection_id">CFS3</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid3</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
               <ActionParameter name="connection_id">CFS3</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConS3</ActionParameter>
            <ActionParameter name="connection_id">CFS3</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid3</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>
        
        <Action name="SubscribeToMany_S30" type="SubscribeTopicTree">
            <ActionParameter name="connection_id">CFS3</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/003/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
        </Action>        

<!-- First Publish and Receive before EXPORT --> 
        <Action name="sync_components_S30" type="SyncComponentAction"> 
          <dependsOn action_id="SubscribeToMany_S30" interval="500" />
            <ActionParameter name="component_name">OrgStaysub30</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub30;OrgStaypub30</ActionParameter>
            <ActionParameter name="timeout">40000</ActionParameter>
        </Action>        

		<Action name="ReceiveMessages_S30" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S30" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS3</ActionParameter>
                <ActionParameter name="structure_id">submsg3</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        
		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S30" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS3</ActionParameter>
	    	<ActionParameter name="structure_id">submsg3</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   

<!-- Signal for Publish before EXPORT -->        
        <Action name="sync_components_receive_S30c" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub30c</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub30c</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
      

<!-- EXPORT then Receive msgs from before EXPORT --> 
        <Action name="sync_components_S31" type="SyncComponentAction"> 
          <dependsOn action_id="sync_components_receive_S30c" interval="500" />
            <ActionParameter name="component_name">OrgStaysub31</ActionParameter>
            <ActionParameter name="component_list">EXPORT;OrgStaysub31</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>        

		<Action name="ReceiveMessages_S31" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S31" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS3</ActionParameter>
                <ActionParameter name="structure_id">submsg3</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        
		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S31" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS3</ActionParameter>
	    	<ActionParameter name="structure_id">submsg3</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   

<!-- Signal for Publish before IMPORT -->        
        <Action name="sync_components_receive_S31c" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub31c</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub31c</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>

<!-- IMPORT then Receive msgs from before IMPORT --> 
        <Action name="sync_components_S32" type="SyncComponentAction"> 
          <dependsOn action_id="sync_components_receive_S31c" interval="500" />
            <ActionParameter name="component_name">OrgStaysub32</ActionParameter>
            <ActionParameter name="component_list">IMPORT;OrgStaysub32</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>        

		<Action name="ReceiveMessages_S32" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S32" type="ReceiveMessage"  >
                <ActionParameter name="connection_id">CFS3</ActionParameter>
                <ActionParameter name="structure_id">submsg3</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        
		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S32" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS3</ActionParameter>
	    	<ActionParameter name="structure_id">submsg3</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   

<!-- Signal for Publish before IMPORT -->        
        <Action name="sync_components_receive_S32c" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub32c</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub32c</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>


        <Action name="sync_components_S34" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub34</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaysub34</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>

        <Action name="CloseConnection" type="CloseConnection">
            <ActionParameter name="connection_id">CFS3</ActionParameter>
        </Action>


    </Action>
	

<!-- ***** Client 4 starts here.  Subscriber consumed all messages of Publisher on the topic  -->
<!-- *** Publish4    *** -->
    <Action name="publish4" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConP4</ActionParameter>
            <ActionParameter name="connection_id">CFP4</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid4</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
            <ActionParameter name="connection_id">CFP4</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConP4</ActionParameter>
            <ActionParameter name="connection_id">CFP4</ActionParameter>
            <include>../common/ConnectionType.xml</include>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="clientId">d:OrgStay:pub:cid4</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>

        
        <Action name="CreateMessage" type="CreateMessage">
            <ActionParameter name="structure_id">msg4</ActionParameter>
            <ActionParameter name="connection_id">CFP4</ActionParameter>
            <ApiParameter name="msgType">TEXT</ApiParameter>
            <ApiParameter name="payload">Sent by Publisher 4 in ORG ${OrgStay} </ApiParameter>
        </Action>
        

<!-- Publish before EXPORT -->
        <Action name="sync_components_P40" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub40</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub40;OrgStaypub40</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P40" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P40" interval="500" />
            <ActionParameter name="connection_id">CFP4</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/004/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>

<!-- Publish after EXPORT -->
        <Action name="sync_components_P41" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub41</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub41;OrgStaypub41</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P41" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P41" interval="500" />
            <ActionParameter name="connection_id">CFP4</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/004/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>

<!-- Publish after IMPORT -->
        <Action name="sync_components_P42" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub42</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub42;OrgStaypub42</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
            
                
        <Action name="PublishToMany_P42" type="PublishTopicTree"  repeat="2">
            <dependsOn action_id="sync_components_P42" interval="500" />
            <ActionParameter name="connection_id">CFP4</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/004/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
            <ActionParameter name="retained">false</ActionParameter>
        </Action>
  
  
        <Action name="sync_components_P44" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaypub44</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaypub44</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
  
        <!-- it was cleansession=false, so this will leave a publisher client to delete --> 
        <Action name="CloseConnection" type="CloseConnection">
            <ActionParameter name="connection_id">CFP4</ActionParameter>
        </Action>
        
    </Action>

    
<!-- *** Subscribe 4 *** -->
    <Action name="subscribe4" type="CompositeAction">

        <Action name="CreateConnectionClean" type="CreateConnection">
            <ActionParameter name="structure_id">ConS4</ActionParameter>
            <ActionParameter name="connection_id">CFS4</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid4</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">true</ApiParameter>
        </Action>

        <Action name="CloseConnectionClean" type="CloseConnection">
               <ActionParameter name="connection_id">CFS4</ActionParameter>
        </Action>

        <Action name="CreateConnection" type="CreateConnection">
            <ActionParameter name="structure_id">ConS4</ActionParameter>
            <ActionParameter name="connection_id">CFS4</ActionParameter>
            <include>../common/ConnectionType.xml</include>  
            <include>../common/MQTT_server.xml</include>  <!--  Joel: in cluster world, you'd subscribe on different server here. -->
            <ApiParameter name="clientId">a-OrgStay-uid4</ApiParameter>
            <include>../common/MQTT_port.xml</include>
            <ApiParameter name="cleanSession">false</ApiParameter>
        </Action>
        
        <Action name="SubscribeToMany_S40" type="SubscribeTopicTree">
            <ActionParameter name="connection_id">CFS4</ActionParameter>
            <ActionParameter name="prefix">/OrgStay/004/</ActionParameter>
            <ActionParameter name="startIndex">1</ActionParameter>
            <ActionParameter name="endIndex">10</ActionParameter>
            <ActionParameter name="qos">2</ActionParameter>
        </Action>        

<!-- Receive before EXPORT -->
        <Action name="sync_components_S40" type="SyncComponentAction"> 
          <dependsOn action_id="SubscribeToMany_S40" interval="500" />
            <ActionParameter name="component_name">OrgStaysub40</ActionParameter>
            <ActionParameter name="component_list">OrgStaysub40;OrgStaypub40</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>        

		<Action name="ReceiveMessages_S40" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S40" type="ReceiveMessage" >
                <ActionParameter name="connection_id">CFS4</ActionParameter>
                <ActionParameter name="structure_id">submsg4</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        
		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S40" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS4</ActionParameter>
	    	<ActionParameter name="structure_id">submsg4</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action> 
		
<!-- Receive after EXPORT -->
        <Action name="sync_components_S41" type="SyncComponentAction"> 
          <dependsOn action_id="ReceiveNoMore_S40" interval="500" />
            <ActionParameter name="component_name">OrgStaysub41</ActionParameter>
            <ActionParameter name="component_list">EXPORT;OrgStaysub41</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>        

		<Action name="ReceiveMessages_S41" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S41" type="ReceiveMessage" >
                <ActionParameter name="connection_id">CFS4</ActionParameter>
                <ActionParameter name="structure_id">submsg4</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        
		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S41" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS4</ActionParameter>
	    	<ActionParameter name="structure_id">submsg4</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   
		
<!-- Receive after IMPORT -->
        <Action name="sync_components_S42" type="SyncComponentAction"> 
          <dependsOn action_id="ReceiveNoMore_S41" interval="500" />
            <ActionParameter name="component_name">OrgStaysub42</ActionParameter>
            <ActionParameter name="component_list">IMPORT;OrgStaysub42</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>        

		<Action name="ReceiveMessages_S42" type="CompositeAction" repeat="20" repeat_interval="0">
            <Action name="ReceiveMessage_S42" type="ReceiveMessage" >
                <ActionParameter name="connection_id">CFS4</ActionParameter>
                <ActionParameter name="structure_id">submsg4</ActionParameter>
                <ActionParameter name="waitTime">10000</ActionParameter>
            </Action>
        </Action>
        
		<!-- Check that we don't receive any more messages -->
		<Action name="ReceiveNoMore_S42" type="ReceiveMessage" rc="1" reason="ISMTEST1143">
	        <ActionParameter name="connection_id">CFS4</ActionParameter>
	    	<ActionParameter name="structure_id">submsg4</ActionParameter>
		    <ActionParameter name="waitTime">2000</ActionParameter>
		</Action>   


        <Action name="sync_components_S44" type="SyncComponentAction"> 
            <ActionParameter name="component_name">OrgStaysub44</ActionParameter>
            <ActionParameter name="component_list">COMPLETE;OrgStaysub44</ActionParameter>
            <ActionParameter name="timeout">840000</ActionParameter>
        </Action>
        
        <Action name="CloseConnection" type="CloseConnection">
            <ActionParameter name="connection_id">CFS4</ActionParameter>
        </Action>          


		

    </Action>
	

	
	
</IsmClientSetTest>
                
