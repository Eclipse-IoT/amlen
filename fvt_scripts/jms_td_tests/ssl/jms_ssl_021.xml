<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2013-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
   TestCase Name: jms_ssl_021

   Test Category:  JMS SSL
   
   Test Description:
   Testing Client Address RANGES in ConnectionPolicy.

   This test does not actually use SSL.
   *****************************************************************************/
  -->

<ImaJmsTest name="jms_ssl_021" >
  <SyncClient>
	<server>
	  <include>../common/JMS_syncip.xml</include>
      <include>../common/JMS_syncport.xml</include>
	</server>
	<solution>jms_ssl_021</solution>
  </SyncClient>


  <Action name="su" type="CompositeAction">

    <Action name="syncReset" type="SyncAction">
      <ActionParameter name="request">reset</ActionParameter>
    </Action>

	<Action name="create_MP" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"TopicPolicy":{"C_MP":{"Topic":"*","ActionList":"Publish,Subscribe","Protocol":"JMS"}}}</ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    
    <Action name="create_CP" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"ClientID":"CART","Protocol":"JMS"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","ClientID":"CART","Protocol":"JMS"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    
    <Action name="create_EP" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"Endpoint":{"C_EP":{"Enabled":false,"Port":20000,"ConnectionPolicies":"C_CP","TopicPolicies":"C_MP","MaxMessageSize":"1KB","MessageHub":"DemoHub"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"Endpoint":[{"Name":"C_EP","Enabled":false,"Port":20000,"ConnectionPolicies":"C_CP","TopicPolicies":"C_MP","MaxMessageSize":"1KB","MessageHub":"DemoHub"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    
    <!-- ready for use -->
    <Action name="SyncForUse" type="SyncComponentAction">
      <ActionParameter name="component_name">su</ActionParameter>
      <ActionParameter name="component_list">su;td;x</ActionParameter>
      <ActionParameter name="timeout">30000</ActionParameter>
    </Action>

    <!-- ready for teardown -->
    <Action name="SyncForTearDown" type="SyncComponentAction">
      <ActionParameter name="component_name">su2</ActionParameter>
      <ActionParameter name="component_list">su2;td2;x2</ActionParameter>
      <ActionParameter name="timeout">30000</ActionParameter>
    </Action>

  </Action>

  <Action name="x" type="CompositeAction">


    <Action name="SyncForUse" type="SyncComponentAction">
      <ActionParameter name="component_name">x</ActionParameter>
      <ActionParameter name="component_list">su;td;x</ActionParameter>
      <ActionParameter name="timeout">30000</ActionParameter>
    </Action>


    <Action name="CreateFactory_x" type="CreateConnectionFactory">
      <ActionParameter name="structure_id">CF_x</ActionParameter>
      <!-- <ActionParameter name="keyStore">../common/ibm.jks</ActionParameter> -->
      <!-- <ActionParameter name="keyStorePassword">password</ActionParameter> -->
      <ActionParameter name="loglevel">9</ActionParameter>
      <ActionParameter name="logfile">stdout</ActionParameter>
    </Action>

    <Action name="CreateExcListener_x" type="CreateExceptionListener">
      <ActionParameter name="structure_id">exc_x</ActionParameter>
    </Action>

    <Action name="SetFactoryProps_x" type="FillIsmProps">
      <ActionParameter name="structure_id">CF_x</ActionParameter>
      <ActionParameter name="validateAll">true</ActionParameter>
      <ActionParameter name="validateNoWarn">false</ActionParameter>
      <ImaProperty name="ClientID" value="CART" type="STRING"/>
      <include>../common/JMS_server.xml</include>
      <ImaProperty name="Port" value="20000" type="STRING"/>
    </Action>

    <Action name="CreateConnection_NotEnabled_x" type="CreateConnection" rc="1" reason="CWLNC0022">
      <ActionParameter name="structure_id">conn_x</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <!-- enable the endpoint -->
    <Action name="Enable_EP" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"Endpoint":{"C_EP":{"Enabled":true,"Protocol":"JMS"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"Endpoint":[{"Name":"C_EP","Enabled":true,"Protocol":"JMS"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="Enable_EP" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update Endpoint Name=C_EP Enabled=True Protocol=JMS</ActionParameter>
    </Action-->


    <Action name="CreateConnection_x" type="CreateConnection">
      <ActionParameter name="structure_id">conn_x</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_x" type="CreateSession">
      <ActionParameter name="conn_id">conn_x</ActionParameter>
      <ActionParameter name="structure_id">sess_x</ActionParameter>
    </Action>


    <Action name="StartConnection_x" type="StartConnection">
      <ActionParameter name="conn_id">conn_x</ActionParameter>
    </Action>


    <Action name="CoseConnection_x" type="CloseConnection">
      <ActionParameter name="conn_id">conn_x</ActionParameter>
    </Action>


    <!-- CP allow only MQTT -->
    <Action name="AllowOnlyMQTT" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"MQTT"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"MQTT"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="AllowOnlyMQTT" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=MQTT</ActionParameter>
    </Action-->

    <Action name="CreateConnection_wrong_protocol" type="CreateConnection">
      <ActionParameter name="structure_id">conn_x_wp</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_wrong_protocol" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_x_wp</ActionParameter>
      <ActionParameter name="structure_id">sess_x_wp</ActionParameter>
    </Action>

    <!-- CP allow MQTT,JMS -->
    <Action name="Allow_MQTT,JMS" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"MQTT,JMS"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"MQTT,JMS"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="Allow_MQTT,JMS" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=MQTT,JMS</ActionParameter>
    </Action-->    

    <Action name="CreateConnection_x_2" type="CreateConnection">
      <ActionParameter name="structure_id">conn_x_2</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_x_2" type="CreateSession">
      <ActionParameter name="conn_id">conn_x_2</ActionParameter>
      <ActionParameter name="structure_id">sess_x_2</ActionParameter>
    </Action>


    <Action name="StartConnection_x_2" type="StartConnection">
      <ActionParameter name="conn_id">conn_x_2</ActionParameter>
    </Action>


    <Action name="CoseConnection_x_2" type="CloseConnection">
      <ActionParameter name="conn_id">conn_x_2</ActionParameter>
    </Action>


    <!--
       The interesting tests (updates to ClientAddress)
      -->


	<Action name="EnableOkAddr" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"``M1_IPv4_1``"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"``M1_IPv4_1``"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableOkAddr" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=``M1_IPv4_1``</ActionParameter>
    </Action-->

    <Action name="CreateConnection_ok" type="CreateConnection">
      <ActionParameter name="structure_id">conn_ok</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_ok" type="CreateSession">
      <ActionParameter name="conn_id">conn_ok</ActionParameter>
      <ActionParameter name="structure_id">sess_ok</ActionParameter>
    </Action>


    <Action name="StartConnection_ok" type="StartConnection">
      <ActionParameter name="conn_id">conn_ok</ActionParameter>
    </Action>


    <Action name="CoseConnection_ok" type="CloseConnection">
      <ActionParameter name="conn_id">conn_ok</ActionParameter>
    </Action>

	<Action name="EnableBadAddr_low" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"9.9.9.9"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"9.9.9.9"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableBadAddr_low" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=9.9.9.9</ActionParameter>
    </Action-->

    <Action name="CreateConnection_bad_low" type="CreateConnection">
      <ActionParameter name="structure_id">conn_bad_low</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_bad_low" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_bad_low</ActionParameter>
      <ActionParameter name="structure_id">sess_bad_low</ActionParameter>
    </Action>

	<Action name="EnableBadAddr_high" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"244.244.244.244"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"244.244.244.244"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableBadAddr_high" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=244.244.244.244</ActionParameter>
    </Action-->

    <Action name="CreateConnection_bad_high" type="CreateConnection">
      <ActionParameter name="structure_id">conn_bad_high</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_bad_high" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_bad_high</ActionParameter>
      <ActionParameter name="structure_id">sess_bad_high</ActionParameter>
    </Action>

	<Action name="EnableBadAndGood" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"9.9.9.9,``M1_IPv4_1``"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"9.9.9.9,``M1_IPv4_1``"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableBadAndGood" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=9.9.9.9,``M1_IPv4_1``</ActionParameter>
    </Action-->

    <Action name="CreateConnection_bad_good" type="CreateConnection">
      <ActionParameter name="structure_id">conn_bad_good</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_bad_good" type="CreateSession">
      <ActionParameter name="conn_id">conn_bad_good</ActionParameter>
      <ActionParameter name="structure_id">sess_bad_good</ActionParameter>
    </Action>


    <Action name="StartConnection_bad_good" type="StartConnection">
      <ActionParameter name="conn_id">conn_bad_good</ActionParameter>
    </Action>


    <Action name="CoseConnection_bad_good" type="CloseConnection">
      <ActionParameter name="conn_id">conn_bad_good</ActionParameter>
    </Action>


	<Action name="EnableBadRangeHigh" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"255.1.1.1-255.255.255.255"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"255.1.1.1-255.255.255.255"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableBadRangeHigh" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=255.1.1.1-255.255.255.255</ActionParameter>
    </Action-->

    <Action name="CreateConnection_bad_high_range" type="CreateConnection">
      <ActionParameter name="structure_id">conn_bad_high_range</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_bad_high_range" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_bad_high_range</ActionParameter>
      <ActionParameter name="structure_id">sess_bad_high_range</ActionParameter>
    </Action>

	<Action name="EnableBadRangeLow" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"2.1.1.1-3.255.255.255"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"2.1.1.1-3.255.255.255"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableBadRangeLow" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=2.1.1.1-3.255.255.255</ActionParameter>
    </Action-->

    <Action name="CreateConnection_bad_low_range" type="CreateConnection">
      <ActionParameter name="structure_id">conn_bad_low_range</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_bad_low_range" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_bad_low_range</ActionParameter>
      <ActionParameter name="structure_id">sess_bad_low_range</ActionParameter>
    </Action>

	<Action name="EnableInclusive" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"2.9.9.9-245.1.1.1"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"2.9.9.9-245.1.1.1"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableInclusive" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=2.9.9.9-245.1.1.1</ActionParameter>
    </Action-->

    <Action name="CreateConnection_inc" type="CreateConnection">
      <ActionParameter name="structure_id">conn_inc</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <Action name="CreateSession_inc" type="CreateSession">
      <ActionParameter name="conn_id">conn_inc</ActionParameter>
      <ActionParameter name="structure_id">sess_inc</ActionParameter>
    </Action>


    <Action name="StartConnection_inc" type="StartConnection">
      <ActionParameter name="conn_id">conn_inc</ActionParameter>
    </Action>


    <Action name="CoseConnection_inc" type="CloseConnection">
      <ActionParameter name="conn_id">conn_inc</ActionParameter>
    </Action>

	<Action name="EnableInclusiveZero" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"10.10.0.0"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"10.10.0.0"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableInclusiveZero" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=10.10.0.0</ActionParameter>
    </Action-->

    <Action name="CreateConnection_inc_zero" type="CreateConnection">
      <ActionParameter name="structure_id">conn_inc_zero</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>

    <!-- TODO: this should be able to connect (DEFECT 28741)-->
    <Action name="CreateSession_inc_zero" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_inc_zero</ActionParameter>
      <ActionParameter name="structure_id">sess_inc_zero</ActionParameter>
    </Action>


	<Action name="EnableExclusiveZero" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"233.10.0.0"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"233.10.0.0"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableExclusiveZero" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=233.10.0.0</ActionParameter>
    </Action-->

    <Action name="CreateConnection_exc_zero" type="CreateConnection">
      <ActionParameter name="structure_id">conn_exc_zero</ActionParameter>
      <ActionParameter name="factory_id">CF_x</ActionParameter>
      <ApiParameter name="exceptionListener">exc_x</ApiParameter>
    </Action>


    <Action name="CreateSession_exc_zero" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_exc_zero</ActionParameter>
      <ActionParameter name="structure_id">sess_exc_zero</ActionParameter>
    </Action>    


















    <!-- IPv6 Testing -->

    <Action name="CreateFactory_y" type="CreateConnectionFactory">
      <ActionParameter name="structure_id">CF_y</ActionParameter>
      <ActionParameter name="loglevel">9</ActionParameter>
      <ActionParameter name="logfile">stdout</ActionParameter>
    </Action>

    <Action name="CreateExcListener_y" type="CreateExceptionListener">
      <ActionParameter name="structure_id">exc_y</ActionParameter>
    </Action>

    <Action name="SetFactoryProps_y" type="FillIsmProps">
      <ActionParameter name="structure_id">CF_y</ActionParameter>
      <ActionParameter name="validateAll">true</ActionParameter>
      <ActionParameter name="validateNoWarn">false</ActionParameter>
      <ImaProperty name="ClientID" value="CART" type="STRING"/>
      <include>../common/JMS_serverIPv6.xml</include>
      <ImaProperty name="Port" value="20000" type="STRING"/>
    </Action>


	<Action name="EnableIPV6" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"[``M1_IPv6_1``]"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"[``M1_IPv6_1``]"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableIPV6" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=[``M1_IPv6_1``]</ActionParameter>
    </Action-->

    <Action name="CreateConnection_yok" type="CreateConnection">
      <ActionParameter name="structure_id">conn_yok</ActionParameter>
      <ActionParameter name="factory_id">CF_y</ActionParameter>
      <ApiParameter name="exceptionListener">exc_y</ApiParameter>
    </Action>


    <Action name="CreateSession_yok" type="CreateSession">
      <ActionParameter name="conn_id">conn_yok</ActionParameter>
      <ActionParameter name="structure_id">sess_yok</ActionParameter>
    </Action>


    <Action name="StartConnection_yok" type="StartConnection">
      <ActionParameter name="conn_id">conn_yok</ActionParameter>
    </Action>

    <Action name="CoseConnection_yok" type="CloseConnection">
      <ActionParameter name="conn_id">conn_yok</ActionParameter>
    </Action>

	<Action name="EnableIPv6_badaddr" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"[1:1::1:1"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"[1:1::1:1"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableIPV6_badaddr" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=[1:1::1:1</ActionParameter>
    </Action-->

    <Action name="CreateConnection_y_badaddr" type="CreateConnection">
      <ActionParameter name="structure_id">conn_y_badaddr</ActionParameter>
      <ActionParameter name="factory_id">CF_y</ActionParameter>
      <ApiParameter name="exceptionListener">exc_y</ApiParameter>
    </Action>

    <Action name="CreateSession_y_badaddr" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_y_badaddr</ActionParameter>
      <ActionParameter name="structure_id">sess_y_badaddr</ActionParameter>
    </Action>
    
    <Action name="EnableIPV6_badaddr_low" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"[fc00::2:2:2:2]"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"[fc00::2:2:2:2]"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableIPV6_badaddr_low" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=[fc00::2:2:2:2]</ActionParameter>
    </Action-->

    <Action name="CreateConnection_y_badaddr_low" type="CreateConnection">
      <ActionParameter name="structure_id">conn_y_badaddr_low</ActionParameter>
      <ActionParameter name="factory_id">CF_y</ActionParameter>
      <ApiParameter name="exceptionListener">exc_y</ApiParameter>
    </Action>

    <Action name="CreateSession_y_badaddr_low" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_y_badaddr_low</ActionParameter>
      <ActionParameter name="structure_id">sess_y_badaddr_low</ActionParameter>
    </Action>
    
    <Action name="EnableIPv6_badaddr_high" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"[fc01::2:2:2:2]"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"[fc01::2:2:2:2]"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableIPV6_badaddr_high" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=[fc01::2:2:2:2]</ActionParameter>
    </Action-->

    <Action name="CreateConnection_y_badaddr_high" type="CreateConnection">
      <ActionParameter name="structure_id">conn_y_badaddr_high</ActionParameter>
      <ActionParameter name="factory_id">CF_y</ActionParameter>
      <ApiParameter name="exceptionListener">exc_y</ApiParameter>
    </Action>

    <Action name="CreateSession_y_badaddr_high" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_y_badaddr_high</ActionParameter>
      <ActionParameter name="structure_id">sess_y_badaddr_high</ActionParameter>
    </Action>

	<Action name="EnableIPV6_range" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"[2607::]-[2608::]"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"[fb00::10:10:1:1]-[fd00::ff00:ff00:ff00:ff00]"}}}</ActionParameter-->
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"[fb00::10:10:1:1]-[fd00::ff00:ff00:ff00:ff00]"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableIPV6_range" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=[fb00::10:10:1:1]-[fd00::ff00:ff00:ff00:ff00]</ActionParameter>
    </Action-->

    <Action name="CreateConnection_y_range" type="CreateConnection">
      <ActionParameter name="structure_id">conn_y_range</ActionParameter>
      <ActionParameter name="factory_id">CF_y</ActionParameter>
      <ApiParameter name="exceptionListener">exc_y</ApiParameter>
    </Action>


    <Action name="CreateSession_y_range" type="CreateSession">
      <ActionParameter name="conn_id">conn_y_range</ActionParameter>
      <ActionParameter name="structure_id">sess_y_range</ActionParameter>
    </Action>


    <Action name="StartConnection_y_range" type="StartConnection">
      <ActionParameter name="conn_id">conn_y_range</ActionParameter>
    </Action>

    <Action name="CoseConnection_y_range" type="CloseConnection">
      <ActionParameter name="conn_id">conn_y_range</ActionParameter>
    </Action>

	<Action name="EnableIPV6_range_low" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"[2::10:10:1:1]-[3::ff00:ff00:ff00:ff00]"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"[2::10:10:1:1]-[3::ff00:ff00:ff00:ff00]"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableIPV6_range_low" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=[2::10:10:1:1]-[3::ff00:ff00:ff00:ff00]</ActionParameter>
    </Action-->

    <Action name="CreateConnection_y_range_low" type="CreateConnection">
      <ActionParameter name="structure_id">conn_y_range_low</ActionParameter>
      <ActionParameter name="factory_id">CF_y</ActionParameter>
      <ApiParameter name="exceptionListener">exc_y</ApiParameter>
    </Action>


    <Action name="CreateSession_y_range_low" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_y_range_low</ActionParameter>
      <ActionParameter name="structure_id">sess_y_range_low</ActionParameter>
    </Action>

	<Action name="EnableIPV6_range_high" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration</ActionParameter>
        <ActionParameter name="action">POST</ActionParameter>
        <ActionParameter name="payload">{"ConnectionPolicy":{"C_CP":{"Protocol":"JMS","ClientAddress":"[fffe::10:10:1:1]-[ffff::ff00:ff00:ff00:ff00]"}}}</ActionParameter>
        <!--ActionParameter name="payload">{"ConnectionPolicy":[{"Name":"C_CP","Protocol":"JMS","ClientAddress":"[fffe::10:10:1:1]-[ffff::ff00:ff00:ff00:ff00]"}]}</ActionParameter-->
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    <!--Action name="EnableIPV6_range_high" type="ShellAction">
      <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=[fffe::10:10:1:1]-[ffff::ff00:ff00:ff00:ff00]</ActionParameter>
    </Action-->

    <Action name="CreateConnection_y_range_high" type="CreateConnection">
      <ActionParameter name="structure_id">conn_y_range_high</ActionParameter>
      <ActionParameter name="factory_id">CF_y</ActionParameter>
      <ApiParameter name="exceptionListener">exc_y</ApiParameter>
    </Action>


    <Action name="CreateSession_y_range_high" type="CreateSession" rc="1" reason="CWLNC0207">
      <ActionParameter name="conn_id">conn_y_range_high</ActionParameter>
      <ActionParameter name="structure_id">sess_y_range_high</ActionParameter>
    </Action>



    <!-- TODO: DEFECT 28799 -->
    <!-- <Action name="EnableIPV6_range_b_all" type="ShellAction"> -->
    <!--   <ActionParameter name="command">ssh ``A1_USER``@``A1_HOST`` imaserver update ConnectionPolicy Name=C_CP Protocol=JMS ClientAddress=[::]</ActionParameter> -->
    <!-- </Action> -->

    <!-- <Action name="CreateConnection_y_range_b_all" type="CreateConnection"> -->
    <!--   <ActionParameter name="structure_id">conn_y_range_b_all</ActionParameter> -->
    <!--   <ActionParameter name="factory_id">CF_y</ActionParameter> -->
    <!--   <ApiParameter name="exceptionListener">exc_y</ApiParameter> -->
    <!-- </Action> -->


    <!-- <Action name="CreateSession_y_range_b_all" type="CreateSession"> -->
    <!--   <ActionParameter name="conn_id">conn_y_range_b_all</ActionParameter> -->
    <!--   <ActionParameter name="structure_id">sess_y_range_b_all</ActionParameter> -->
    <!-- </Action> -->


    <!-- <Action name="StartConnection_y_range_b_all" type="StartConnection"> -->
    <!--   <ActionParameter name="conn_id">conn_y_range_b_all</ActionParameter> -->
    <!-- </Action> -->

    <!-- <Action name="CoseConnection_y_range_b_all" type="CloseConnection"> -->
    <!--   <ActionParameter name="conn_id">conn_y_range_b_all</ActionParameter> -->
    <!-- </Action> -->





    <Action name="SyncForTearDown" type="SyncComponentAction">
      <ActionParameter name="component_name">x2</ActionParameter>
      <ActionParameter name="component_list">su2;td2;x2</ActionParameter>
      <ActionParameter name="timeout">30000</ActionParameter>
    </Action>
  </Action>

  <Action name="td" type="CompositeAction">

    <Action name="SyncForUse" type="SyncComponentAction">
      <ActionParameter name="component_name">td</ActionParameter>
      <ActionParameter name="component_list">su;td;x</ActionParameter>
      <ActionParameter name="timeout">30000</ActionParameter>
    </Action>


    <!-- all other top level CompositeActions ready for teardown -->
    <Action name="SyncForTearDown" type="SyncComponentAction">
      <ActionParameter name="component_name">td2</ActionParameter>
      <ActionParameter name="component_list">su2;td2;x2</ActionParameter>
      <ActionParameter name="timeout">30000</ActionParameter>
    </Action>

	<Action name="delete_EP" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration/Endpoint/C_EP</ActionParameter>
        <ActionParameter name="action">DELETE</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    
    <Action name="delete_CP" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration/ConnectionPolicy/C_CP</ActionParameter>
        <ActionParameter name="action">DELETE</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    
    <Action name="delete_MP" type="RestAPI">
        <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
        <ActionParameter name="path">/ima/v1/configuration/TopicPolicy/C_MP</ActionParameter>
        <ActionParameter name="action">DELETE</ActionParameter>
        <ActionParameter name="payload"></ActionParameter>
        <ActionParameter name="printResult">true</ActionParameter>
        <ActionParameter name="expectedStatusCode">200</ActionParameter>
        <ActionParameter name="expectedMessageCode"></ActionParameter>
    </Action>
    
 </Action>    

</ImaJmsTest>
