<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2013-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
  TestCase Name: jms_msgdelivery_002

  Test Category:  JMS Message Delivery
  
  Test Description:
  	Send messages from a JMS producer to a JMS consumer using a different 
  	ConnectionFactory and Destination for the producer and consumer. Use both 
  	synchronous and asynchronous message delivery in this test. Use two 
  	machines for this test, machine1 and machine2. Also test that message
  	priority can be set and retrieved by both the producer and consumer.
  	
  	************** LEAVE LOGGING ON IN THIS TESTCASE  *********************
  	************** This is also used to verify that   *********************
  	************** normal trace logging does not fail *********************

-->
<LlmJmsTest name="jms_msgdelivery_002">
	<SyncClient>
		<server>
			<include>../common/JMS_syncip.xml</include>
			<include>../common/JMS_syncport.xml</include>
		</server>
		<solution>jms_msgdelivery_002</solution>
	</SyncClient>

    <!--  Leave logging on forever. -->
	<Action name="rmdt" type="CompositeAction">
		<Action name="CreateTx_cf1" type="CreateConnectionFactory">
			<ActionParameter name="structure_id">tx_cf1</ActionParameter>
			<ActionParameter name="loglevel">9</ActionParameter>
			<ActionParameter name="logfile">stdout</ActionParameter>
		</Action>
		
		<Action name="SetPropsTx_cf1" type="FillIsmProps">
			<ActionParameter name="structure_id">tx_cf1</ActionParameter>
			<ActionParameter name="validateAll">true</ActionParameter>
			<ActionParameter name="validateNoWarn">false</ActionParameter>
			<ImaProperty name="ClientID" value="tx_cf1_clientid" type="STRING"/>
			<include>../common/JMS_server.xml</include>
			<ImaProperty name="Port" value="16102" type="STRING"/>
			<ImaProperty name="DisableMessageID" value="true"/>
			<ImaProperty name="RecvSockBuffer" value="87280"/>
		</Action>
		
		<Action name="CreateConnectionTx_cf1" type="CreateConnection">
			<ActionParameter name="structure_id">connection_tx_cf1</ActionParameter>
		 	<ActionParameter name="factory_id">tx_cf1</ActionParameter>
		</Action>
		
		<Action name="CreateSession1Tx_conn_cf1" type="CreateSession">
			<ActionParameter name="conn_id">connection_tx_cf1</ActionParameter>
		 	<ActionParameter name="structure_id">session1_tx_cf1</ActionParameter>
		</Action>

		<Action name="CreateTx_dest1" type="CreateDestination">
			<ActionParameter name="structure_id">tx_dest1</ActionParameter>
			<ActionParameter name="type">topic</ActionParameter>
			<ApiParameter name="name">dest1</ApiParameter>
		</Action>

		<Action name="CreateProducer1Tx_dest1" type="CreateProducer">
			<ActionParameter name="structure_id">producer1_dest1</ActionParameter>
			<ActionParameter name="dest_id">tx_dest1</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
		</Action>
		
		<Action name="StartConnectionTx_cf1" type="StartConnection">
			<ActionParameter name="conn_id">connection_tx_cf1</ActionParameter>
		</Action>
		
		<!-- PRODUCER: Create a retained message -->
		<Action name="CreateRetainedMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_retained_msg1</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
		</Action>

		<Action name="SetMessageRetainedProperty" type="SetMessageProperty">
			<ActionParameter name="message_id">tx_retained_msg1</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>			
			<ApiParameter name="value">1</ApiParameter>
		</Action>		

		<!-- PRODUCER: Create a retained message -->
		<Action name="CreateRetainedMessage2prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_retained_msg2</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
		</Action>

		<Action name="SetMessageRetained2Property" type="SetMessageProperty">
			<ActionParameter name="message_id">tx_retained_msg2</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Boolean</ApiParameter>			
			<ApiParameter name="value">true</ApiParameter>
		</Action>		
	
		<!-- PRODUCER: Create a retained message -->
		<Action name="CreateRetainedMessage3_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_retained_msg3</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">BYTES</ApiParameter>
		</Action>

		<Action name="SetMessageRetained3Property" type="SetMessageProperty">
			<ActionParameter name="message_id">tx_retained_msg3</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Short</ApiParameter>			
			<ApiParameter name="value">1</ApiParameter>
		</Action>
		
		<!-- PRODUCER: Create a retained message -->
		<Action name="CreateRetainedMessage4_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_retained_msg4</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
		</Action>

		<Action name="SetMessageRetained4Property" type="SetMessageProperty">
			<ActionParameter name="message_id">tx_retained_msg4</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Byte</ApiParameter>			
			<ApiParameter name="value">1</ApiParameter>
		</Action>	
		
		<!-- PRODUCER: Create a null retained message (Which works differently than MQTT  -->
		<Action name="CreateRetainedMessage5prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_retained_msg5</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
		</Action>

		<Action name="SetMessageRetained5Property" type="SetMessageProperty">
			<ActionParameter name="message_id">tx_retained_msg5</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>			
			<ApiParameter name="value">1</ApiParameter>
		</Action>	
		
		<!-- PRODUCER: Create a null retained message (Which works differently than MQTT  -->
		<Action name="CreateRetainedMessage6prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_retained_msg6</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
		</Action>

		<Action name="SetMessageRetained6Property" type="SetMessageProperty">
			<ActionParameter name="message_id">tx_retained_msg6</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Short</ApiParameter>			
			<ApiParameter name="value">1</ApiParameter>
		</Action>											
				
		
		<!-- PRODUCER: Create messages -->
		<Action name="CreateBytesMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_bytes_msg1</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">BYTES</ApiParameter>
		</Action>

		<Action name="CreateMapMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_map_msg1</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">MAP</ApiParameter>
		</Action>		

		<Action name="CreateObjMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_obj_msg1</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">OBJECT</ApiParameter>
		</Action>		

		<Action name="CreateStreamMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_strm_msg1</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">STREAM</ApiParameter>
		</Action>
		
		<Action name="CreateTxtMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_txt_msg1</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
		</Action>

		<Action name="CreateEmptyBytesMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_bytes_msgEmpty</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">BYTES</ApiParameter>
		</Action>
		
		<Action name="CreateEmptyMapMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_map_msgEmpty</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">MAP</ApiParameter>
		</Action>

		<Action name="CreateEmptyObjectMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_obj_msgEmpty</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">OBJECT</ApiParameter>
		</Action>
		
		<!--  Set Retained, but this will be a null message received via the live stream. -->
		<Action name="SetMessageRetainedPropertyOnObj" type="SetMessageProperty">
			<ActionParameter name="message_id">tx_obj_msgEmpty</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>			
			<ApiParameter name="value">1</ApiParameter>
		</Action>				
								
		<Action name="CreateEmptyTxtMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_txt_msgEmpty</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
			<ApiParameter name="msgType">TEXT</ApiParameter>
		</Action>

		<Action name="CreateEmptyMessage_prod_dest1" type="CreateMessage">
			<ActionParameter name="structure_id">tx_msgEmpty</ActionParameter>
			<ActionParameter name="session_id">session1_tx_cf1</ActionParameter>
		</Action>
		
		<!-- PRODUCER: Set message content -->	
		

		<Action name="WriteRetainedMessage2_1_prod_dest1" type="SetMessageText">
			<ActionParameter name="message_id">tx_retained_msg1</ActionParameter>
			<ApiParameter name="value">TEXT: Retained Message1</ApiParameter>	
		</Action>
		
		<Action name="WriteRetainedMessage2_2_prod_dest1" type="SetMessageText">
			<ActionParameter name="message_id">tx_retained_msg2</ActionParameter>
			<ApiParameter name="value">TEXT: Retained Message2</ApiParameter>	
		</Action>
		
		<Action name="WriteRetainedMessage2_3_prod_dest1" type="WriteBytesMessage">
			<ActionParameter name="message_id">tx_retained_msg3</ActionParameter>
			<ApiParameter name="valueType">UTF8</ApiParameter>
			<ApiParameter name="value">I am a retained message</ApiParameter>
		</Action>	
		
		<Action name="WriteRetainedMessage2_4_prod_dest1" type="SetMessageText">
			<ActionParameter name="message_id">tx_retained_msg4</ActionParameter>
			<ApiParameter name="value">TEXT: Retained Message4</ApiParameter>	
		</Action>
							
					
		<Action name="WriteBytesMessage_prod_dest1" type="WriteBytesMessage">
			<ActionParameter name="message_id">tx_bytes_msg1</ActionParameter>
			<ApiParameter name="valueType">UTF8</ApiParameter>
			<ApiParameter name="value">BYTES: test content 1</ApiParameter>
		</Action>
	
		<Action name="SetMapItem1_prod_dest1" type="SetMessageMapItem">
			<ActionParameter name="message_id">tx_map_msg1</ActionParameter>
			<ApiParameter name="propertyName">MessageContent1</ApiParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ApiParameter name="value">MAP: test content 1</ApiParameter>
		</Action>
		
		<Action name="SetMapItem2_prod_dest1" type="SetMessageMapItem">
			<ActionParameter name="message_id">tx_map_msg1</ActionParameter>
			<ApiParameter name="propertyName">MessageContent2</ApiParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ApiParameter name="value">MAP: test content 2</ApiParameter>
		</Action>

		<Action name="SetObjMsg_prod_dest1" type="SetMessageObject">
			<ActionParameter name="message_id">tx_obj_msg1</ActionParameter>
			<ActionParameter name="objValueType">String</ActionParameter>
			<ApiParameter name="value">OBJECT: test content 1</ApiParameter>
		</Action>

		<Action name="WriteStreamMessage_prod_dest1" type="WriteStreamMessage">
			<ActionParameter name="message_id">tx_strm_msg1</ActionParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ApiParameter name="value">STREAM: test content 1</ApiParameter>
		</Action>

		<Action name="SetTxtMsg_prod_dest1" type="SetMessageText">
			<ActionParameter name="message_id">tx_txt_msg1</ActionParameter>
			<ApiParameter name="value">TEXT: test content 1</ApiParameter>
		</Action>
		
		<!-- Send a series of retained messages to this topic, before the consumer is started -->
	
		<Action name="SendRetainedMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_retained_msg1</ActionParameter>
			<ApiParameter name="priority">4</ApiParameter>
		</Action>
		
		<Action name="SendRetainedMessage2_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_retained_msg2</ActionParameter>
			<ApiParameter name="priority">3</ApiParameter>
		</Action>
		
		<Action name="SendRetainedMessage3_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_retained_msg3</ActionParameter>
			<ApiParameter name="priority">7</ApiParameter>
		</Action>				
		
		<!--  This sync point is to allow the producer  to send the retained messages before the consumer is started -->
		<Action name="sync_components_ret1" type="SyncComponentAction"> 
			<ActionParameter name="component_name">tx_ret1</ActionParameter>
			<ActionParameter name="component_list">tx_ret1;rx_ret1</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>				

		<!-- NOTE: No content set for "empty" messages -->
		
		<!-- PRODUCER: Send messages  after consumers created in rmdr -->
		<Action name="sync_components_tx1" type="SyncComponentAction"> 
			<ActionParameter name="component_name">tx1</ActionParameter>
			<ActionParameter name="component_list">tx1;rx1</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>
		
		<Action name="SendBytesMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_bytes_msg1</ActionParameter>
			<ApiParameter name="priority">1</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg1" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_bytes_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">1</ActionParameter>
		</Action>

		<Action name="SendMapMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_map_msg1</ActionParameter>
			<ApiParameter name="priority">2</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg2" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_map_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">2</ActionParameter>
		</Action>

		<Action name="SendObjMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_obj_msg1</ActionParameter>
			<ApiParameter name="priority">3</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg3" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_obj_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">3</ActionParameter>
		</Action>

		<Action name="SendStreamMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_strm_msg1</ActionParameter>
			<ApiParameter name="priority">4</ApiParameter>
		</Action>
		
		<Action name="GetPriority_Msg4" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_strm_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">4</ActionParameter>
		</Action>

		<Action name="SendTxtMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_txt_msg1</ActionParameter>
			<ApiParameter name="priority">5</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg5" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_txt_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">5</ActionParameter>
		</Action>

		<Action name="SendEmptyBytesMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_bytes_msgEmpty</ActionParameter>
			<ApiParameter name="priority">6</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg6" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_bytes_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">6</ActionParameter>
		</Action>

		<Action name="SendEmptyMapMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_map_msgEmpty</ActionParameter>
			<ApiParameter name="priority">7</ApiParameter>
		</Action>
		
		<Action name="GetPriority_Msg7" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_map_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">7</ActionParameter>
		</Action>

		<Action name="SendEmptyObjectMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_obj_msgEmpty</ActionParameter>
			<ApiParameter name="priority">8</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg8" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_obj_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">8</ActionParameter>
		</Action>

		<Action name="SendEmptyTextMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_txt_msgEmpty</ActionParameter>
			<ApiParameter name="priority">9</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg9" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_txt_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">9</ActionParameter>
		</Action>

		<Action name="SendEmptyMessage_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_msgEmpty</ActionParameter>
			<ApiParameter name="priority">5</ApiParameter>
		</Action>	
	
		<Action name="GetPriority_Msg10" type="GetMessageProperty">
			<ActionParameter name="message_id">tx_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">5</ActionParameter>
		</Action>
		
		<!--  This message is flagged as retained, but will be received via live stream.  -->
		<Action name="SendRetainedMessage4_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_retained_msg4</ActionParameter>
			<ApiParameter name="priority">4</ApiParameter>
		</Action>
		
		<!--  The producer has now sent retained message 4, and we need to start the 
					the first consumer in rmdr2.   --> 
		<Action name="Sync_rmdr2" type="SyncAction">
            <ActionParameter name="request">set</ActionParameter>
            <ActionParameter name="condition">cue_rmdr2</ActionParameter>
            <ActionParameter name="value">1</ActionParameter>
		</Action>		
		
		<!-- the first consumer process needs to end, and then we need to send one null retained message for the second
			consumer process to receive. A JMS null retained message will not cause the retained messages to 
			be cleared, which is different than  MQTT.  -->
		<Action name="sync_components_ret5" type="SyncComponentAction"> 
			<ActionParameter name="component_name">tx_ret5</ActionParameter>
			<ActionParameter name="component_list">tx_ret5;rx_ret5;rx2_ret5</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>	
				
		<Action name="SendRetainedMessage5_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_retained_msg5</ActionParameter>
		</Action>	
		
		<!-- Tell rmdr2 to create the second consumer -->
		<Action name="sync_components_ret6" type="SyncComponentAction"> 
			<ActionParameter name="component_name">tx_ret6</ActionParameter>
			<ActionParameter name="component_list">tx_ret6;rx2_ret6</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>
		
		<!-- Wait for second consumer in rmdr2 to be created  and send another message -->
		<Action name="sync_components_ret7" type="SyncComponentAction"> 
			<ActionParameter name="component_name">tx_ret7</ActionParameter>
			<ActionParameter name="component_list">tx_ret7;rx2_ret7</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>					
		
		
		<Action name="SendRetainedMessage6_prod_dest1" type="SendMessage">
			<ActionParameter name="producer_id">producer1_dest1</ActionParameter>
			<ActionParameter name="message_id">tx_retained_msg6</ActionParameter>
		</Action>	
									
		<Action name="CloseConnectionTx_cf1" type="CloseConnection">
			<ActionParameter name="conn_id">connection_tx_cf1</ActionParameter>
		</Action>
	</Action>
		
	<Action name="rmdr" type="CompositeAction">
		<!-- Reset this SyncDriver solution to clean up any existing values that might conflict  -->
		<Action name="syncReset" type="SyncAction">
			<ActionParameter name="request">reset</ActionParameter>
		</Action>

		<!-- Initialize the SyncDriver values -->
		<Action name="syncInit1" type="SyncAction">
			<ActionParameter name="request">init</ActionParameter>
			<ActionParameter name="condition">syncPoint</ActionParameter>
		</Action>
		
		<Action name="SyncInit_rmdr2" type="SyncAction">
            <ActionParameter name="request">init</ActionParameter>
            <ActionParameter name="condition">cue_rmdr2</ActionParameter>
            <ActionParameter name="value">0</ActionParameter>
        </Action>

        <!--  Leave logging on forever. -->
		<Action name="CreateRx_cf1" type="CreateConnectionFactory">
			<ActionParameter name="structure_id">rx_cf1</ActionParameter>
                        <ActionParameter name="loglevel">9</ActionParameter>
                        <ActionParameter name="logfile">stdout</ActionParameter>
		</Action>
		
		<Action name="SetPropsRx_cf1" type="FillIsmProps">
			<ActionParameter name="structure_id">rx_cf1</ActionParameter>
			<ActionParameter name="validateAll">true</ActionParameter>
			<ActionParameter name="validateNoWarn">false</ActionParameter>
			<ImaProperty name="ClientID" value="rx_cf1_clientid" type="STRING"/>
			<include>../common/JMS_server.xml</include>
			<ImaProperty name="Port" value="16102" type="STRING"/>
			<ImaProperty name="DisableMessageID" value="true"/>
			<ImaProperty name="RecvSockBuffer" value="87280"/>
		</Action>

		<Action name="CreateConnectionRx_cf1" type="CreateConnection">
			<ActionParameter name="structure_id">connection_rx_cf1</ActionParameter>
		 	<ActionParameter name="factory_id">rx_cf1</ActionParameter>
		 	<ActionParameter name="prop_log_file">msgdelivery002rx_l.log</ActionParameter>
		 	<ActionParameter name="prop_event_file">msgdelivery002rx_e.log</ActionParameter>
		</Action>
				
		<Action name="CreateSession1Rx_conn_cf1" type="CreateSession">
			<ActionParameter name="conn_id">connection_rx_cf1</ActionParameter>
		 	<ActionParameter name="structure_id">session1_rx_cf1</ActionParameter>
		</Action>
		
		<Action name="CreateSession2Rx_conn_cf1" type="CreateSession">
			<ActionParameter name="conn_id">connection_rx_cf1</ActionParameter>
		 	<ActionParameter name="structure_id">session2_rx_cf1</ActionParameter>
		</Action>

		<Action name="CreateRx_dest1" type="CreateDestination">
			<ActionParameter name="structure_id">rx_dest1</ActionParameter>
			<ActionParameter name="type">topic</ActionParameter>
			<ApiParameter name="name">dest1</ApiParameter>
		</Action>
		
				<!--  This sync point is to allow the producer  to send a retained message before the consumer is started -->
		<Action name="sync_components_ret1" type="SyncComponentAction"> 
			<ActionParameter name="component_name">rx_ret1</ActionParameter>
			<ActionParameter name="component_list">tx_ret1;rx_ret1</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>	
		
		<Action name="CreateConsumer1Rx_dest1" type="CreateConsumer">
			<ActionParameter name="structure_id">consumer1_dest1</ActionParameter>
			<ActionParameter name="dest_id">rx_dest1</ActionParameter>
			<ActionParameter name="session_id">session1_rx_cf1</ActionParameter>
		</Action>
		
			
		
		<Action name="CreateConsumer2Rx_dest1" type="CreateConsumer">
			<ActionParameter name="structure_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="dest_id">rx_dest1</ActionParameter>
			<ActionParameter name="session_id">session2_rx_cf1</ActionParameter>
		</Action>

		<Action name="CreateMsgListener_consumer1" type="CreateMessageListener">
			<ActionParameter name="structure_id">msg_listener_consumer1</ActionParameter>
		</Action>
		
		<Action name="SetMsgListener_consumer1" type="SetMessageListener">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="consumer_id">consumer1_dest1</ActionParameter>
		</Action>
		
		<Action name="StartConnectionRx_rx1" type="StartConnection">
		    <dependsOn name="sync_components_ret1" interval="2000"/>
			<ActionParameter name="conn_id">connection_rx_cf1</ActionParameter>
		</Action>

		<Action name="sync_components_rx1" type="SyncComponentAction"> 
			<ActionParameter name="component_name">rx1</ActionParameter>
			<ActionParameter name="component_list">tx1;rx1</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>
		
		<!-- CONSUMER 1: Receive retained message sent before consumer was started -->
		<Action name="RcvRetainedMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg3</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
			
		<Action name="GetRetainedMsgText_consumer1" type="ReadBytesMessage">
			<ActionParameter name="message_id">rx_retained_msg3</ActionParameter>
			<ApiParameter name="valueType">UTF8</ApiParameter>
			<ActionParameter name="verifyValue">I am a retained message</ActionParameter>
		</Action>		
		
		<!--  It was a retained message not sent live, so  retained psuedo property should be set  -->
		<Action name="GetRetainedFlag_consumer1" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_retained_msg3</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">1</ActionParameter>
		</Action>	

				<!-- CONSUMER 1: Receive messages -->
		<Action name="RcvBytesMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_bytes_msg1</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<!--  It was not a retained message not sent live, so retained pseudo property should be set  -->
		<Action name="GetRetainedFlag_consumer1_notPresent" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_bytes_msg1</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">0</ActionParameter>
		</Action>			

		<Action name="GetPriority_Msg1" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_bytes_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">1</ActionParameter>
		</Action>

		<Action name="SetPriority_Msg1" type="SetMessageProperty">
			<ActionParameter name="message_id">rx_bytes_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ApiParameter name="value">9</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg1r" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_bytes_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">9</ActionParameter>
		</Action>

		<Action name="RcvMapMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_map_msg1</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="GetAMapItem1_consumer1" type="GetMessageMapItem">
			<ActionParameter name="message_id">rx_map_msg1</ActionParameter>
			<ApiParameter name="propertyName">MessageContent1</ApiParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">MAP: test content 1</ActionParameter>
		</Action>		

		<Action name="GetPriority_Msg2" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_map_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">2</ActionParameter>
		</Action>

		<Action name="RcvObjMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_obj_msg1</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="GetPriority_Msg3" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_obj_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">3</ActionParameter>
		</Action>

		<Action name="RcvStreamMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_strm_msg1</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="GetPriority_Msg4" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_strm_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">4</ActionParameter>
		</Action>

		<Action name="RcvTxtMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_txt_msg1</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="GetPriority_Msg5" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_txt_msg1</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">5</ActionParameter>
		</Action>

		<Action name="RcvEmptyBytesMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_bytes_msgEmpty</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg6" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_bytes_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">6</ActionParameter>
		</Action>

		<Action name="RcvEmptyMapMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_map_msgEmpty</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="GetPriority_Msg7" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_map_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">7</ActionParameter>
		</Action>

		<Action name="RcvEmptyObjectMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_obj_msgEmpty</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<!--  It was not a retained message but was  sent live, so retained pseudo property should not be set  -->
		<Action name="GetRetainedFlag_consumer1_notPresentObj" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_obj_msgEmpty</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">0</ActionParameter>
		</Action>			
		
		<Action name="GetPriority_Msg8" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_obj_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">8</ActionParameter>
		</Action>

		<Action name="RcvEmptyTextMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_txt_msgEmpty</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg9" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_txt_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">9</ActionParameter>
		</Action>

		<Action name="RcvEmptyMessage_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_msgEmpty</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<Action name="GetPriority_Msg10" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_msgEmpty</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">5</ActionParameter>
		</Action>
		
		<Action name="RcvRetainedMessage4_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg4</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<!-- CONSUMER 1: Extract message content and verify it -->
		<Action name="ReadBytesMsg_consumer1" type="ReadBytesMessage">
			<ActionParameter name="message_id">rx_bytes_msg1</ActionParameter>
			<ApiParameter name="valueType">UTF8</ApiParameter>
			<ActionParameter name="verifyValue">BYTES: test content 1</ActionParameter>
		</Action>

		<Action name="GetMapItem1_consumer1" type="GetMessageMapItem">
			<ActionParameter name="message_id">rx_map_msg1</ActionParameter>
			<ApiParameter name="propertyName">MessageContent1</ApiParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">MAP: test content 1</ActionParameter>
		</Action>
		
		<Action name="GetMapItem2_consumer1" type="GetMessageMapItem">
			<ActionParameter name="message_id">rx_map_msg1</ActionParameter>
			<ApiParameter name="propertyName">MessageContent2</ApiParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">MAP: test content 2</ActionParameter>
		</Action>

		<Action name="GetObjMsg_consumer1" type="GetMessageObject">
			<ActionParameter name="message_id">rx_obj_msg1</ActionParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">OBJECT: test content 1</ActionParameter>
		</Action>
		
		<Action name="ReadStreamMsg_consumer1" type="ReadStreamMessage">
			<ActionParameter name="message_id">rx_strm_msg1</ActionParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">STREAM: test content 1</ActionParameter>
		</Action>
		
		<Action name="GetMsgText_consumer1" type="GetMessageText">
			<ActionParameter name="message_id">rx_txt_msg1</ActionParameter>
			<ActionParameter name="verifyValue">TEXT: test content 1</ActionParameter>
		</Action>
		
		<Action name="ReadEmptyBytesMsg_consumer1" type="ReadBytesMessage">
			<ActionParameter name="message_id">rx_bytes_msgEmpty</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>

		<Action name="GetMapItemEmpty_consumer1" type="GetMessageMapItem">
			<ActionParameter name="message_id">rx_map_msgEmpty</ActionParameter>
			<ApiParameter name="propertyName">MessageContentEmpty</ApiParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>
		
		<Action name="GetEmptyObjectMsg_consumer1" type="GetMessageObject">
			<ActionParameter name="message_id">rx_obj_msgEmpty</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>

		<Action name="GetEmptyTextMsg_consumer1" type="GetMessageText">
			<ActionParameter name="message_id">rx_txt_msgEmpty</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>
		
			<Action name="GetRetMsgText_consumer1" type="GetMessageText">
			<ActionParameter name="message_id">rx_retained_msg4</ActionParameter>
			<ActionParameter name="verifyValue">TEXT: Retained Message4</ActionParameter>
		</Action>
				
		<!-- CONSUMER 2: Receive messages -->
		
		<!-- CONSUMER 2: Receive retained message sent before consumer was started -->
		<Action name="RcvRetainedMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg2_3</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
			
		<Action name="GetRetainedMsgText_consumer2" type="ReadBytesMessage">
			<ActionParameter name="message_id">rx_retained_msg2_3</ActionParameter>
			<ApiParameter name="valueType">UTF8</ApiParameter>
			<ActionParameter name="verifyValue">I am a retained message</ActionParameter>
		</Action>		
		
		<!--  It was a retained message not sent live, so  retained psuedo property should be set  -->
		<Action name="GetRetainedFlag_consumer2" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_retained_msg2_3</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">1</ActionParameter>
		</Action>			
			
		<Action name="RcvBytesMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_bytes_msg2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<Action name="GetPriority2_Msg1" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_bytes_msg2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">1</ActionParameter>
		</Action>

		<Action name="RcvMapMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_map_msg2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<Action name="GetPriority2_Msg2" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_map_msg2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">2</ActionParameter>
		</Action>

		<Action name="RcvObjMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_obj_msg2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="GetPriority2_Msg3" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_obj_msg2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">3</ActionParameter>
		</Action>

		<Action name="RcvStreamMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_strm_msg2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="GetPriority2_Msg4" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_strm_msg2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">4</ActionParameter>
		</Action>

		<Action name="RcvTxtMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_txt_msg2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<Action name="GetPriority2_Msg5" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_txt_msg2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">5</ActionParameter>
		</Action>

		<Action name="RcvEmptyBytesMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_bytes_msgEmpty2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="GetPriority2_Msg6" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_bytes_msgEmpty2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">6</ActionParameter>
		</Action>

		<Action name="RcvEmptyMapMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_map_msgEmpty2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<Action name="GetPriority2_Msg7" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_map_msgEmpty2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">7</ActionParameter>
		</Action>

		<Action name="RcvEmptyObjectMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_obj_msgEmpty2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<!--  It was a retained message  sent live, so retained pseudo property should not be set  -->
		<Action name="GetRetainedFlag_consumer2_notPresentObj" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_obj_msgEmpty2</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">0</ActionParameter>
		</Action>			

		<Action name="GetPriority2_Msg8" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_obj_msgEmpty2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">8</ActionParameter>
		</Action>

		<Action name="RcvEmptyTextMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_txt_msgEmpty2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<Action name="GetPriority2_Msg9" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_txt_msgEmpty2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">9</ActionParameter>
		</Action>

		<Action name="RcvEmptyMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_msgEmpty2</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<Action name="RcvRetainedMessage4_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg2_4</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<!--  It was a retained message  sent live, so retained pseudo property should not be set  -->
		<Action name="GetRetainedFlag_consumer2_notPresent" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_retained_msg2_4</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">0</ActionParameter>
		</Action>			
		
		
		<Action name="GetPriority2_Msg10" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_msgEmpty2</ActionParameter>
			<ApiParameter name="propertyType">Priority</ApiParameter>
			<ApiParameter name="valueType">Integer</ApiParameter>
			<ActionParameter name="verifyValue">5</ActionParameter>
		</Action>

		<!-- CONSUMER 2: Extract message content and verify it -->
		<Action name="ReadBytesMsg_consumer2" type="ReadBytesMessage">
			<ActionParameter name="message_id">rx_bytes_msg2</ActionParameter>
			<ApiParameter name="valueType">UTF8</ApiParameter>
			<ActionParameter name="verifyValue">BYTES: test content 1</ActionParameter>
		</Action>

		<Action name="GetMapItem1_consumer2" type="GetMessageMapItem">
			<ActionParameter name="message_id">rx_map_msg2</ActionParameter>
			<ApiParameter name="propertyName">MessageContent1</ApiParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">MAP: test content 1</ActionParameter>
		</Action>
		
		<Action name="GetMapItem2_consumer2" type="GetMessageMapItem">
			<ActionParameter name="message_id">rx_map_msg2</ActionParameter>
			<ApiParameter name="propertyName">MessageContent2</ApiParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">MAP: test content 2</ActionParameter>
		</Action>

		<Action name="GetObjMsg_consumer2" type="GetMessageObject">
			<ActionParameter name="message_id">rx_obj_msg2</ActionParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">OBJECT: test content 1</ActionParameter>
		</Action>

		<Action name="ReadStreamMsg_consumer2" type="ReadStreamMessage">
			<ActionParameter name="message_id">rx_strm_msg2</ActionParameter>
			<ApiParameter name="valueType">String</ApiParameter>
			<ActionParameter name="verifyValue">STREAM: test content 1</ActionParameter>
		</Action>

		<Action name="GetMsgText_consumer2" type="GetMessageText">
			<ActionParameter name="message_id">rx_txt_msg2</ActionParameter>
			<ActionParameter name="verifyValue">TEXT: test content 1</ActionParameter>
		</Action>
		
		<Action name="ReadEmptyBytesMsg_consumer2" type="ReadBytesMessage">
			<ActionParameter name="message_id">rx_bytes_msgEmpty2</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>
		
		<Action name="GetMapItemEmpty_consumer2" type="GetMessageMapItem">
			<ActionParameter name="message_id">rx_map_msgEmpty2</ActionParameter>
			<ApiParameter name="propertyName">MessageContentEmpty</ApiParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>

		<Action name="GetEmptyObjectMsg_consumer2" type="GetMessageObject">
			<ActionParameter name="message_id">rx_obj_msgEmpty2</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>

		<Action name="GetEmptyTextMsg_consumer2" type="GetMessageText">
			<ActionParameter name="message_id">rx_txt_msgEmpty2</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>
		
		<Action name="GetMsgRetText_consumer2" type="GetMessageText">
			<ActionParameter name="message_id">rx_retained_msg2_4</ActionParameter>
			<ActionParameter name="verifyValue">TEXT: Retained Message4</ActionParameter>
		</Action>		

		<Action name="CloseConnectionRx_cf1" type="CloseConnection">
			<ActionParameter name="conn_id">connection_rx_cf1</ActionParameter>
		</Action>
		
		<Action name="sync_components_ret5" type="SyncComponentAction"> 
			<ActionParameter name="component_name">rx_ret5</ActionParameter>
			<ActionParameter name="component_list">tx_ret5;rx_ret5;rx2_ret5</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>	
		
	</Action>
	
	<!--  The second consumer process verifies that a null retained message is received on a new subscription
	      This is different behavior than you would see with MQTT -->
	
	<Action name="rmdr2" type="CompositeAction">

        <!--  Leave logging on forever. -->
		<Action name="CreateRx_cf1" type="CreateConnectionFactory">
			<ActionParameter name="structure_id">rx_cf1</ActionParameter>
                        <ActionParameter name="loglevel">9</ActionParameter>
                        <ActionParameter name="logfile">stdout</ActionParameter>
		</Action>

		<!--  This sync point is to allow the producer  to send a retained message before the consumer is started -->

		<Action name="SetPropsRx_cf1" type="FillIsmProps">
			<ActionParameter name="structure_id">rx_cf1</ActionParameter>
			<ActionParameter name="validateAll">true</ActionParameter>
			<ActionParameter name="validateNoWarn">false</ActionParameter>
			<ImaProperty name="ClientID" value="rx2_cf1_clientid" type="STRING"/>
			<include>../common/JMS_server.xml</include>
			<ImaProperty name="Port" value="16102" type="STRING"/>
			<ImaProperty name="DisableMessageID" value="true"/>
			<ImaProperty name="RecvSockBuffer" value="87280"/>
		</Action>

		<Action name="CreateConnectionRx_cf1" type="CreateConnection">
			<ActionParameter name="structure_id">connection_rx_cf1</ActionParameter>
		 	<ActionParameter name="factory_id">rx_cf1</ActionParameter>
		 	<ActionParameter name="prop_log_file">msgdelivery002rx_l.log</ActionParameter>
		 	<ActionParameter name="prop_event_file">msgdelivery002rx_e.log</ActionParameter>
		</Action>
				
		<Action name="CreateSession1Rx_conn_cf1" type="CreateSession">
			<ActionParameter name="conn_id">connection_rx_cf1</ActionParameter>
		 	<ActionParameter name="structure_id">session1_rx_cf1</ActionParameter>
		</Action>
		
		<Action name="CreateSession2Rx_conn_cf1" type="CreateSession">
			<ActionParameter name="conn_id">connection_rx_cf1</ActionParameter>
		 	<ActionParameter name="structure_id">session2_rx_cf1</ActionParameter>
		</Action>

		<Action name="CreateRx_dest1" type="CreateDestination">
			<ActionParameter name="structure_id">rx_dest1</ActionParameter>
			<ActionParameter name="type">topic</ActionParameter>
			<ApiParameter name="name">dest1</ApiParameter>
		</Action>
		
			<!--  The producer has now sent retained message 4.  --> 
			
        <Action name="SyncCue_rmdr2" type="SyncAction">
                <ActionParameter name="request">wait</ActionParameter>
                <ActionParameter name="condition">cue_rmdr2</ActionParameter>
                <ActionParameter name="value">1</ActionParameter>
				<ActionParameter name="timeout">60000</ActionParameter>
          </Action>
				
		<Action name="CreateConsumer1Rx_dest1" type="CreateConsumer">
			<ActionParameter name="structure_id">consumer1_dest1</ActionParameter>
			<ActionParameter name="dest_id">rx_dest1</ActionParameter>
			<ActionParameter name="session_id">session1_rx_cf1</ActionParameter>
		</Action>
		
	<Action name="CreateMsgListener_consumer1" type="CreateMessageListener">
			<ActionParameter name="structure_id">msg_listener_consumer1</ActionParameter>
		</Action>
		
		<Action name="SetMsgListener_consumer1" type="SetMessageListener">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="consumer_id">consumer1_dest1</ActionParameter>
		</Action>
		
		<Action name="StartConnectionRx_rx1" type="StartConnection">
			<ActionParameter name="conn_id">connection_rx_cf1</ActionParameter>
		</Action>
		
		<!--  This triggers the producer to send a retained message.  one  consumer is active, one is not yet.  -->
		<Action name="sync_components_ret5" type="SyncComponentAction"> 
			<ActionParameter name="component_name">rx2_ret5</ActionParameter>
			<ActionParameter name="component_list">tx_ret5;rx_ret5;rx2_ret5</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>	
		
			<!--  The producer has now sent retained message 5.   --> 
		<Action name="sync_components_ret6" type="SyncComponentAction"> 
			<ActionParameter name="component_name">rx2_ret6</ActionParameter>
			<ActionParameter name="component_list">tx_ret6;rx2_ret6</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>		

		<Action name="CreateConsumer2Rx_dest1" type="CreateConsumer">
			<dependsOn name="sync_components_ret5"/>
			<ActionParameter name="structure_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="dest_id">rx_dest1</ActionParameter>
			<ActionParameter name="session_id">session2_rx_cf1</ActionParameter>
		</Action>		
				
		<Action name="sync_components_ret7" type="SyncComponentAction"> 
			<ActionParameter name="component_name">rx2_ret7</ActionParameter>
			<ActionParameter name="component_list">tx_ret7;rx2_ret7</ActionParameter>
			<ActionParameter name="timeout">60000</ActionParameter>
		</Action>						
		<Action name="RcvRetainedMessage4_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg4</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<!--  It was a retained message not sent live, so  retained psuedo property should be set  -->
		<Action name="GetRetainedFlag4_consumer1" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_retained_msg4</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">1</ActionParameter>
		</Action>	

		<Action name="GetRetTextMsg4_consumer1" type="GetMessageText">
			<ActionParameter name="message_id">rx_retained_msg4</ActionParameter>
			<ActionParameter name="verifyValue">TEXT: Retained Message4</ActionParameter>
		</Action>				
				
		<!-- CONSUMER 1: Receive the null  retained message sent after consumer was started -->
		<Action name="RcvRetainedMessage5_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg5</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<!--  It was a retained message not sent live, so  retained psuedo property should be set  -->
		<Action name="GetRetainedFlag5_consumer1" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_retained_msg5</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">0</ActionParameter>
		</Action>	

		<Action name="GetEmptyRetTextMsg5_consumer1" type="GetMessageText">
			<ActionParameter name="message_id">rx_retained_msg5</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>
		
		<Action name="RcvRetainedMessage6_consumer1" type="ReceiveMessage">
			<ActionParameter name="listener_id">msg_listener_consumer1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg6</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>
		
		<!--  It was a retained message not sent live, so  retained psuedo property should be set  -->
		<Action name="GetRetainedFlag6_consumer1" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_retained_msg6</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">0</ActionParameter>
		</Action>	

		<Action name="GetEmptyRetTextMsg6_consumer1" type="GetMessageText">
			<ActionParameter name="message_id">rx_retained_msg6</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>		
		
		<!-- CONSUMER 2: Receive messages -->
		
		<!-- CONSUMER 2: Receive retained message sent before consumer was started -->
		<Action name="RcvRetainedMessage_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg2_5</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<!--  It was a retained message not sent live, so  retained psuedo property should be set  -->
		<Action name="GetRetainedFlag_consumer2" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_retained_msg2_5</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">1</ActionParameter>
		</Action>		
		
		<Action name="GetEmptyTextMsg_consumer2" type="GetMessageText">
			<ActionParameter name="message_id">rx_retained_msg2_5</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>	
		
		<Action name="RcvRetainedMessage2_consumer2" type="ReceiveMessage">
			<ActionParameter name="consumer_id">consumer2_dest1</ActionParameter>
			<ActionParameter name="structure_id">rx_retained_msg2_6</ActionParameter>
			<ApiParameter name="timeout">60000</ApiParameter>
		</Action>

		<!--  It was a retained message sent live, so  retained psuedo property should not be set  -->
		<Action name="GetRetainedFlag2_consumer2" type="GetMessageProperty">
			<ActionParameter name="message_id">rx_retained_msg2_6</ActionParameter>
			<ApiParameter name="propertyName">JMS_IBM_Retain</ApiParameter>
			<ActionParameter name="verifyValue">0</ActionParameter>
		</Action>		
		
		<Action name="GetEmptyTextMsg2_consumer2" type="GetMessageText">
			<ActionParameter name="message_id">rx_retained_msg2_6</ActionParameter>
			<ActionParameter name="verifyValue"></ActionParameter>
		</Action>			
				

		<Action name="CloseConnectionRx_cf1" type="CloseConnection">
			<ActionParameter name="conn_id">connection_rx_cf1</ActionParameter>
		</Action>
	</Action>
</LlmJmsTest>
