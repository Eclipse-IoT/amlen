<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
 * Copyright (c) 2013-2021 Contributors to the Eclipse Foundation
 * 
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 * 
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 * 
 * SPDX-License-Identifier: EPL-2.0
 */
-->
<IsmWSTest name="Bridge.HAA1A2" >
<!--  MessageSight Bridge
    Using an HA Bridge Config (two Bridges, B1 and B2) to an HA Paired MessageGateway (A1 and A2) aka BridgeSource, 
    a Publisher will send messages on 4 topics to MS:A1A2 
    The Bridge will receive/forward 4 messages matching the Forwarder Topic pattern transform to MS:A3 TopicMap  (aka BridgeDest)
    The messages checked when received from MS:A3 by the subscriber.
    During the Publish the HA Primary will failover and the Standby will be promoted to Primary, and one Bridge failover before the test ends.
	
	Things to Note:  
	
	THIS IS THE GENERAL MODEL for All NON-HA MQTT Tests 
	Pictorially, the message flow looks like:  
	   M1.PUB(-1883->)A1.MessageGateway(-1883->)B1.BridgeSource --> B1.BridgeDest(-1883->)A2.MessageGateway(-1883->)M2.SUB    


	THIS IS THE GENERAL MODEL for All HA MQTT Tests 
	Pictorially, the message flow looks like:  
	   M1.PUB(-1883->)A1.MessageGateway[Primary]
	                  A2.MessageGateway[StandBy]
	                                   (-1883->)B1.BridgeSource --> B1.BridgeDest(-1883->)
	                                   (-1883->)B2.BridgeSource --> B2.BridgeDest(-1883->)A3.MessageGateway(-1883->)M2.SUB    
	   
	   
-->
<!--  ==========  BridgeConfig : Bridge.HAA1A2.cfg  ==========  -->
    
    <SyncClient>
        <server>
            <include>../common/JMS_syncip.xml</include>
            <include>../common/JMS_syncport.xml</include>
        </server>
        <solution>Bridge.HAA1A2</solution>
    </SyncClient>
 
    
<!--  ==========  A3Subscriber  ==========  -->
    <Action name="A3Subscriber" type="CompositeAction">
    
        <Action name="GetB1ForwarderStats" type="RestAPI">
            <ActionParameter name="structureID">br_Forwarder_Stats</ActionParameter>
            <ActionParameter name="server">``B1_HOST``:``B1_BRIDGEPORT``</ActionParameter>
            <ActionParameter name="path">/admin/forwarder</ActionParameter>
            <ActionParameter name="userID">``B1_REST_USER``</ActionParameter>
            <ActionParameter name="password">``B1_REST_PW``</ActionParameter>
            <ActionParameter name="requireSSL">false</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetB2ForwarderStats" type="RestAPI">
            <ActionParameter name="structureID">br_Forwarder_Stats</ActionParameter>
            <ActionParameter name="server">``B2_HOST``:``B2_BRIDGEPORT``</ActionParameter>
            <ActionParameter name="path">/admin/forwarder</ActionParameter>
            <ActionParameter name="userID">``B2_REST_USER``</ActionParameter>
            <ActionParameter name="password">``B2_REST_PW``</ActionParameter>
            <ActionParameter name="requireSSL">false</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
    
        <Action name="GetA1ServerStats" type="RestAPI">
            <ActionParameter name="structureID">A1_Stats</ActionParameter>
            <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA2ServerStats" type="RestAPI">
            <ActionParameter name="structureID">A2_Stats</ActionParameter>
            <ActionParameter name="server">``A2_HOST``:``A2_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA3ServerStats" type="RestAPI">
            <ActionParameter name="structureID">A3_Stats</ActionParameter>
            <ActionParameter name="server">``A3_HOST``:``A3_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
       
        <Action name="ConnectA3Subscriber" type="CreateConnection">
            <ActionParameter name="structure_id">ConA3</ActionParameter>
            <ActionParameter name="connection_id">CFA3</ActionParameter>
            <include>../common/ConnectionTypeV5.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <include>../common/MQTT_server3.xml</include>
            <ApiParameter name="port">1883</ApiParameter>
            <ApiParameter name="clientId">A:orgDestIoT2:A3Sub:HAA1A2</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
            <ApiParameter name="sessionExpire">30</ApiParameter>
        </Action>
               
        <Action name="SubscribeMS" type="Subscribe" >
            <ActionParameter name="connection_id">CFA3</ActionParameter>
            <ApiParameter name="topic">iot-2/evt/MappedVarResponseTopic/fmt/HAA1A2</ApiParameter> 
            <ApiParameter name="QoS">9</ApiParameter> 
          <!-- QoS:1 + RetainAsPublished:8 -->
            <ApiParameter name="expectedrc">1</ApiParameter>
        </Action>

        <Action name="sync_1" type="SyncComponentAction"> 
            <ActionParameter name="component_name">s1</ActionParameter>
            <ActionParameter name="component_list">s1;p1</ActionParameter>
            <ActionParameter name="timeout">5000</ActionParameter>
        </Action>
        
        <Action name="ReceiveMessageLoopBefore" type="CompositeAction" repeat="100" >
        
            <Action name="ReceiveMessage" type="ReceiveMessage" >
                <ActionParameter name="connection_id">CFA3</ActionParameter>
                <ActionParameter name="structure_id">rxmsgA1</ActionParameter>
                <ActionParameter name="waitTime">3000</ActionParameter>
            </Action>

            <Action name="CheckMessage" type="CompareMessageData">
                <ActionParameter name="structure_id">rxmsgA1</ActionParameter>
                <ActionParameter name="compareBody">{"MSG" :{ "clientId":"d:orgSrcIoT2:A1Pub:HAA1A2" , "Client":"v5 with Properties"}}</ActionParameter>
                <ActionParameter name="compareTopic">iot-2/evt/MappedVarResponseTopic/fmt/HAA1A2</ActionParameter> 
                <ActionParameter name="mqttMessageVersion">5</ActionParameter>
                <ActionParameter name="compareQoS">1</ActionParameter>
                <ActionParameter name="compareRetain">false</ActionParameter> 
                <ApiParameter name="compareCorrelationData">69</ApiParameter>  
                <ApiParameter name="comparePayloadFormatIndicator">true</ApiParameter>
                <ApiParameter name="compareMsgExpire">4294967295</ApiParameter>
                <ApiParameter name="compareContentType">json</ApiParameter>
                <ApiParameter name="compareResponseTopic">iot-2/evt/MappedVarResponseTopic/fmt/HAA1A2</ApiParameter>
                <ApiParameter name="compareTopicAlias">29</ApiParameter>
                <ApiParameter name="compareUserprop.0">Name=Value1</ApiParameter>
                <ApiParameter name="compareUserprop.1">Name=Value2</ApiParameter>
                <ApiParameter name="compareUserprop.2">GVT葛渚噓=Value葛渚噓edibleBeanHappyBeach</ApiParameter>
            </Action>
            
        </Action>


        <Action name="sync_2" type="SyncComponentAction"> 
            <ActionParameter name="component_name">s2</ActionParameter>
            <ActionParameter name="component_list">s2;p2</ActionParameter>
            <ActionParameter name="timeout">5000</ActionParameter>
        </Action>


    <!-- Failover Primary server here -->

        <Action name="RestartPrimary" type="ShellAction" >
            <ActionParameter name="command">python ../scripts/haFunctions.py -a swapPrimary -f bridge.HAA1A2.swapPrimary.log</ActionParameter>
            <ActionParameter name="print_result">true</ActionParameter>
        </Action>

        <Action name="StatusBridgeB1" type="ShellAction" >
            <ActionParameter name="command">../scripts/statusMQTTBridge.sh  -s B1 </ActionParameter>
            <ActionParameter name="print_result">true</ActionParameter>
        </Action>

        <Action name="StatusBridgeB2" type="ShellAction" >
            <ActionParameter name="command">../scripts/statusMQTTBridge.sh  -s B2 </ActionParameter>
            <ActionParameter name="print_result">true</ActionParameter>
        </Action>

        
    <!-- Failover Bridge happens in PUBLISHER while in next receive loop -->


<!-- NOTE: This client is connected to A3, not A1A2 HA Pair, it does not get DISCONNECTED, 
            don't need WaitForReconnection().   Resume receiving mesages.
-->

        
        <Action name="ReceiveMessageLoopAfter" type="CompositeAction" repeat="400" interval="60" repeat_interval="3" >
        
            <Action name="ReceiveMessage" type="ReceiveMessage" >
                <ActionParameter name="connection_id">CFA3</ActionParameter>
                <ActionParameter name="structure_id">rxmsgA1</ActionParameter>
                <ActionParameter name="waitTime">3000</ActionParameter>
            </Action>

            <Action name="CheckMessage" type="CompareMessageData">
                <ActionParameter name="structure_id">rxmsgA1</ActionParameter>
                <ActionParameter name="compareBody">{"MSG" :{ "clientId":"d:orgSrcIoT2:A1Pub:HAA1A2" , "Client":"v5 with Properties"}}</ActionParameter>
                <ActionParameter name="compareTopic">iot-2/evt/MappedVarResponseTopic/fmt/HAA1A2</ActionParameter> 
                <ActionParameter name="mqttMessageVersion">5</ActionParameter>
                <ActionParameter name="compareQoS">1</ActionParameter>
                <ActionParameter name="compareRetain">false</ActionParameter> 
                <ApiParameter name="compareCorrelationData">69</ApiParameter>  
                <ApiParameter name="comparePayloadFormatIndicator">true</ApiParameter>
                <ApiParameter name="compareMsgExpire">4294967295</ApiParameter>
                <ApiParameter name="compareContentType">json</ApiParameter>
                <ApiParameter name="compareResponseTopic">iot-2/evt/MappedVarResponseTopic/fmt/HAA1A2</ApiParameter>
                <ApiParameter name="compareTopicAlias">29</ApiParameter>
                <ApiParameter name="compareUserprop.0">Name=Value1</ApiParameter>
                <ApiParameter name="compareUserprop.1">Name=Value2</ApiParameter>
                <ApiParameter name="compareUserprop.2">GVT葛渚噓=Value葛渚噓edibleBeanHappyBeach</ApiParameter>
            </Action>
            
        </Action>
        
        
        <Action name="ReceiveMessageNoMore" type="ReceiveMessage" rc="1" reason="ISMTEST1143" >
            <ActionParameter name="connection_id">CFA3</ActionParameter>
            <ActionParameter name="structure_id">rxmsgA1</ActionParameter>
            <ActionParameter name="waitTime">1000</ActionParameter>
        </Action>


        <Action name="UnsubscribeMS" type="Unsubscribe" >
            <ActionParameter name="connection_id">CFA3</ActionParameter>
            <ApiParameter name="topic">iot-2/evt/MappedVarResponseTopic/fmt/HAA1A2</ApiParameter> 
        </Action>

        <Action name="DisconnectA2Subscriber" type="CloseConnection">
            <ActionParameter name="connection_id">CFA3</ActionParameter>
        </Action>
               
    </Action>



<!--  ==========  A1Publisher  ==========  -->
    <Action name="A1Publisher" type="CompositeAction">
    
        
        <Action name="ConnectA1Publisher" type="CreateConnection">
            <ActionParameter name="structure_id">ConA1</ActionParameter>
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <include>../common/ConnectionTypeV5.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
<!-- IP of A1, servers2 is server list --> 
            <include>../common/MQTT_server.xml</include>
<!-- PICK SERVER(s) if HA IS running -->
            <include>../common/MQTT_servers2.xml</include>
            <ApiParameter name="port">1883</ApiParameter>
            <ApiParameter name="clientId">d:orgSrcIoT2:A1Pub:HAA1A2</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>

        <Action name="CreateMessage_V5" type="CreateMessage">
            <ActionParameter name="structure_id">txmsg5</ActionParameter>
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <ApiParameter name="msgType">TEXT</ApiParameter>
            <ApiParameter name="payload">{"MSG" :{ "clientId":"d:orgSrcIoT2:A1Pub:HAA1A2" , "Client":"v5 with Properties"}}</ApiParameter>
            <ApiParameter name="correlationData">69</ApiParameter>
            <ApiParameter name="payloadFormatIndicator">true</ApiParameter>
            <ApiParameter name="msgExpire">4294967295</ApiParameter>
            <ApiParameter name="contentType">json</ApiParameter>
            <ApiParameter name="responseTopic">iot-2/evt/MappedVarResponseTopic/fmt/HAA1A2</ApiParameter>
            <ApiParameter name="topicAlias">29</ApiParameter>
            <ApiParameter name="userprop.0">Name=Value1</ApiParameter>
            <ApiParameter name="userprop.1">Name=Value2</ApiParameter>
            <ApiParameter name="userprop.2">GVT葛渚噓=Value葛渚噓edibleBeanHappyBeach</ApiParameter>
        </Action>
           

        <Action name="sync_1" type="SyncComponentAction"> 
            <ActionParameter name="component_name">p1</ActionParameter>
            <ActionParameter name="component_list">s1;p1</ActionParameter>
            <ActionParameter name="timeout">5000</ActionParameter>
        </Action>
           
        <Action name="SendMessageLoopBefore" type="CompositeAction" repeat="300" >
           
            <Action name="SendMessage" type="SendMessage">
                <ActionParameter name="connection_id">CFA1</ActionParameter>
                <ActionParameter name="message_id">txmsg5</ActionParameter>
                <ActionParameter name="topic">wiotp////HA</ActionParameter>
                <ActionParameter name="QoS">1</ActionParameter>
            </Action>            
            <Action name="WaitForPendingDelivery_1d" type="WaitPendingDelivery" >
                <ActionParameter name="connection_id">CFA1</ActionParameter>
            </Action>
           
        </Action>


        <Action name="sync_2" type="SyncComponentAction"> 
            <ActionParameter name="component_name">p2</ActionParameter>
            <ActionParameter name="component_list">s2;p2</ActionParameter>
            <ActionParameter name="timeout">5000</ActionParameter>
        </Action>

<!-- Primary Server is killed here , this client will need to reconnect -->

<!-- Connecting to A2 when A1 is restarted -->
        <Action name="WaitForReconnect" type="WaitForReconnection">
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <ActionParameter name="waitTime">30000</ActionParameter>
        </Action>
           
        <Action name="SendMessageLoopAfterA1" type="CompositeAction" repeat="100" >
           
            <Action name="SendMessage" type="SendMessage">
                <ActionParameter name="connection_id">CFA1</ActionParameter>
                <ActionParameter name="message_id">txmsg5</ActionParameter>
                <ActionParameter name="topic">wiotp////HA</ActionParameter>
                <ActionParameter name="QoS">1</ActionParameter>
            </Action>            
            <Action name="WaitForPendingDelivery_1d" type="WaitPendingDelivery" >
                <ActionParameter name="connection_id">CFA1</ActionParameter>
            </Action>
           
        </Action>

    <!-- Failover Bridge here, until B1 is operational, all msgs will flow through B2 -->


    <!-- STOP Bridge B1 gracefully (shell action)  -->

        <Action name="StopBridgeB1" type="ShellAction" >
            <ActionParameter name="command">../scripts/stopMQTTBridge.sh  -s B1 </ActionParameter>
            <ActionParameter name="print_result">true</ActionParameter>
        </Action>

           
        <Action name="SendMessageLoopAfterB1" type="CompositeAction" repeat="100" >
           
            <Action name="SendMessage" type="SendMessage">
                <ActionParameter name="connection_id">CFA1</ActionParameter>
                <ActionParameter name="message_id">txmsg5</ActionParameter>
                <ActionParameter name="topic">wiotp////HA</ActionParameter>
                <ActionParameter name="QoS">1</ActionParameter>
            </Action>            
            <Action name="WaitForPendingDelivery_1d" type="WaitPendingDelivery" >
                <ActionParameter name="connection_id">CFA1</ActionParameter>
            </Action>
           
        </Action>


    <!-- RESTART Bridge B1 gracefully (shell action)  -->

        <Action name="RestartBridgeB1" type="ShellAction" >
            <ActionParameter name="command">../scripts/statusMQTTBridge.sh  -j true -s B1 </ActionParameter>
            <ActionParameter name="print_result">true</ActionParameter>
        </Action>


        <Action name="DisconnectA1Publisher" type="CloseConnection">
            <ActionParameter name="connection_id">CFA1</ActionParameter>
        </Action>
       
    </Action>



<!--  ==========  SanitySubscriptionClean  ==========  -->
    <Action name="SanitySubscriptionClean" type="CompositeAction">
    
    
        <Action name="GetB1Stats" type="RestAPI">
            <ActionParameter name="structureID">br_Forwarder_Stats</ActionParameter>
            <ActionParameter name="server">``B1_HOST``:``B1_BRIDGEPORT``</ActionParameter>
            <ActionParameter name="path">/admin/forwarder</ActionParameter>
            <ActionParameter name="userID">``B1_REST_USER``</ActionParameter>
            <ActionParameter name="password">``B1_REST_PW``</ActionParameter>
            <ActionParameter name="requireSSL">false</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
    
        <Action name="GetB2Stats" type="RestAPI">
            <ActionParameter name="structureID">br_Forwarder_Stats</ActionParameter>
            <ActionParameter name="server">``B2_HOST``:``B2_BRIDGEPORT``</ActionParameter>
            <ActionParameter name="path">/admin/forwarder</ActionParameter>
            <ActionParameter name="userID">``B2_REST_USER``</ActionParameter>
            <ActionParameter name="password">``B2_REST_PW``</ActionParameter>
            <ActionParameter name="requireSSL">false</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
    
    
        <Action name="GetA2ServerStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A2_Stats</ActionParameter>
            <ActionParameter name="server">``A2_HOST``:``A2_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
        <Action name="GetA2SubscriptionStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A2_Stats</ActionParameter>
            <ActionParameter name="server">``A2_HOST``:``A2_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Subscription</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
        <Action name="GetA2MQTTClientStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A2_Stats</ActionParameter>
            <ActionParameter name="server">``A2_HOST``:``A2_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/MQTTClient</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
    
        <Action name="GetA3ServerStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A3_Stats</ActionParameter>
            <ActionParameter name="server">``A3_HOST``:``A3_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
        <Action name="GetA3SubscriptionStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A3_Stats</ActionParameter>
            <ActionParameter name="server">``A3_HOST``:``A3_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Subscription</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
        <Action name="GetA3MQTTClientStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A3_Stats</ActionParameter>
            <ActionParameter name="server">``A3_HOST``:``A3_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/MQTTClient</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
    
        <Action name="GetA1ServerStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A1_Stats</ActionParameter>
            <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
        <Action name="GetA1SubscriptionStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A1_Stats</ActionParameter>
            <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Subscription</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
        <Action name="GetA1MQTTClientStatsBefore" type="RestAPI">
            <ActionParameter name="structureID">A1_Stats</ActionParameter>
            <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/MQTTClient</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    


        <!-- Clean the HA-A1 End of Bridge 1 Connections -->
        <Action name="ConnectBr1A1Subscriber" type="CreateConnection">
            <ActionParameter name="structure_id">ConA1</ActionParameter>
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <include>../common/ConnectionTypeV5.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="port">1883</ApiParameter>
            <ApiParameter name="clientId">A:orgSrcIoT2:BrHA:P1-m2w</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>
    
        <Action name="DeleteSubscriptionBr1A1" type="RestAPI">
            <ActionParameter name="structureID">A1_Stats</ActionParameter>
            <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/service/Subscription/__SharedM//HAA1A2/wiotp/+/+/+/+</ActionParameter>
            <ActionParameter name="action">DELETE</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
                
        <Action name="DisconnectBr1A1Subscriber" type="CloseConnection">
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>

        <!-- Clean the HA-A1 End of Bridge 2 Connections -->        
        <Action name="ConnectBr2A1Subscriber" type="CreateConnection">
            <ActionParameter name="structure_id">ConA1</ActionParameter>
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <include>../common/ConnectionTypeV5.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <include>../common/MQTT_server.xml</include>
            <ApiParameter name="port">1883</ApiParameter>
            <ApiParameter name="clientId">A:orgSrcIoT2:BrHA:P2-m2w</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>
        
        <Action name="DisconnectBr2A1Subscriber" type="CloseConnection">
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>


        



        <!-- Clean the HA-A2 End of Bridge 1 Connections -->
        <Action name="ConnectBr1A2Subscriber" type="CreateConnection">
            <ActionParameter name="structure_id">ConA1</ActionParameter>
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <include>../common/ConnectionTypeV5.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <include>../common/MQTT_server2.xml</include>
            <ApiParameter name="port">1883</ApiParameter>
            <ApiParameter name="clientId">A:orgSrcIoT2:BrHA:P1-m2w</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>
    
        <Action name="DeleteSubscriptionBr1A2" type="RestAPI">
            <ActionParameter name="structureID">A2_Stats</ActionParameter>
            <ActionParameter name="server">``A2_HOST``:``A2_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/service/Subscription/__SharedM//HAA1A2/wiotp/+/+/+/+</ActionParameter>
            <ActionParameter name="action">DELETE</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
                
        <Action name="DisconnectBr1A2Subscriber" type="CloseConnection">
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>

        <!-- Clean the HA-A2 End of Bridge 2 Connections -->        
        <Action name="ConnectBr2A2Subscriber" type="CreateConnection">
            <ActionParameter name="structure_id">ConA1</ActionParameter>
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <include>../common/ConnectionTypeV5.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <include>../common/MQTT_server2.xml</include>
            <ApiParameter name="port">1883</ApiParameter>
            <ApiParameter name="clientId">A:orgSrcIoT2:BrHA:P2-m2w</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>
        
        <Action name="DisconnectBr2A2Subscriber" type="CloseConnection">
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>


        
        <!-- Clean the A3 End of Bridge 1 Connections -->        
        <Action name="ConnectBr1A3Subscriber" type="CreateConnection">
            <ActionParameter name="structure_id">ConA1</ActionParameter>
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <include>../common/ConnectionTypeV5.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <include>../common/MQTT_server3.xml</include>
            <ApiParameter name="port">1883</ApiParameter>
            <ApiParameter name="clientId">A:orgDestIoT2:BrA3:P1-m2w</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>
    
        <Action name="DeleteSubscriptionBr1A3" type="RestAPI">
            <ActionParameter name="structureID">A3_Stats</ActionParameter>
            <ActionParameter name="server">``A3_HOST``:``A3_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/service/Subscription/__SharedM//HAA1A2/wiotp/+/+/+/+</ActionParameter>
            <ActionParameter name="action">DELETE</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
                        
        <Action name="DisconnectBr1A3Subscriber" type="CloseConnection">
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>

        <!-- Clean the A3 End of Bridge 2 Connections -->
        <Action name="ConnectBr2A3Subscriber" type="CreateConnection">
            <ActionParameter name="structure_id">ConA1</ActionParameter>
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <include>../common/ConnectionTypeV5.xml</include>
            <ApiParameter name="protocol">mqtt</ApiParameter>
            <include>../common/MQTT_server3.xml</include>
            <ApiParameter name="port">1883</ApiParameter>
            <ApiParameter name="clientId">A:orgDestIoT2:BrA3:P2-m2w</ApiParameter>
            <ApiParameter name="cleanSession">true</ApiParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>

        <Action name="DisconnectBr2A3Subscriber" type="CloseConnection">
            <ActionParameter name="connection_id">CFA1</ActionParameter>
            <ApiParameter name="sessionExpire">0</ApiParameter>
        </Action>






    
        <Action name="GetA1ServerStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A1_Stats</ActionParameter>
            <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA2ServerStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A2_Stats</ActionParameter>
            <ActionParameter name="server">``A2_HOST``:``A2_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA3ServerStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A3_Stats</ActionParameter>
            <ActionParameter name="server">``A3_HOST``:``A3_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Server</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
        
    
        <Action name="GetA1SubscriptionStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A1_Stats</ActionParameter>
            <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Subscription</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA2SubscriptionStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A2_Stats</ActionParameter>
            <ActionParameter name="server">``A2_HOST``:``A2_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Subscription</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA3SubscriptionStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A3_Stats</ActionParameter>
            <ActionParameter name="server">``A3_HOST``:``A3_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/Subscription</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA1MQTTClientStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A1_Stats</ActionParameter>
            <ActionParameter name="server">``A1_HOST``:``A1_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/MQTTClient</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA2MQTTClientStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A2_Stats</ActionParameter>
            <ActionParameter name="server">``A2_HOST``:``A2_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/MQTTClient</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
    
        <Action name="GetA3MQTTClientStatsAfter" type="RestAPI">
            <ActionParameter name="structureID">A3_Stats</ActionParameter>
            <ActionParameter name="server">``A3_HOST``:``A3_PORT``</ActionParameter>
            <ActionParameter name="path">/ima/monitor/MQTTClient</ActionParameter>
            <ActionParameter name="action">GET</ActionParameter>
            <ActionParameter name="payload"></ActionParameter>
            <ActionParameter name="printResult">true</ActionParameter>
            <ActionParameter name="expectedStatusCode">-1</ActionParameter>
            <ActionParameter name="expectedMessageCode"></ActionParameter>
        </Action>
        

        
    </Action>           


    
</IsmWSTest>
                
