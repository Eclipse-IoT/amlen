<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SpiderCast C++: The SpiderCast Node</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SpiderCast C++
   &#160;<span id="projectnumber">0.3.2</span>
   </div>
   <div id="projectbrief">Scalable Membership and Group Communication Services</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">SpiderCast (C++) User Manual</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The SpiderCast Node </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="the_node_sec"></a>
Creation and configuration</h1>
<p>SpiderCast is centered around the concept of a node. A node is a unique entity in the overlay, that has a unique name and network endpoints. <a class="el" href="classspdr_1_1_spider_cast.html">SpiderCast</a> is the main class that represents a node. A node is created using the <a class="el" href="classspdr_1_1_spider_cast_factory.html">SpiderCastFactory</a> which is the main factory class. In order to properly create a node some mandatory configuration parameters need to be supplied. Those are encapsulated in the <a class="el" href="classspdr_1_1_spider_cast_config.html">SpiderCastConfig </a> class, which is also created using the SpiderCastFactory. The SpiderCastConfig class also allows additional optional configuration parameters to be supplied.</p>
<p>When the created instance of a SpiderCast node is started, it starts a phase in which it discovers overlay peers and connects to a subset of them. Peers to which a node is connected to are called neighbors. The node then proceeds with a gossip protocol that implements the membership and attribute services, and establishes an internal representation of the overlay node membership.</p>
<p>The services that a SpiderCast node provides, like the membership service, are all created by factory methods from the SpiderCast instance.</p>
<h1><a class="anchor" id="node_example_sec"></a>
Example</h1>
<p>Here is a simple example of how to create a SpiderCast node and start it. </p>
<div class="fragment"><div class="line">SpiderCastFactory&amp; factory = SpiderCastFactory::getInstance();</div>
<div class="line"></div>
<div class="line"><span class="comment">//create a properties object with mandatory properties</span></div>
<div class="line">PropertyMap prop;</div>
<div class="line">prop.setProperty(<a class="code" href="namespacespdr_1_1config.html#ace27d93be2a7d8e5425a1e7ec859d54d" title="Node&#39;s name.">config::NodeName_PROP_KEY</a>,<span class="stringliteral">&quot;node1&quot;</span>);</div>
<div class="line">prop.setProperty(<a class="code" href="namespacespdr_1_1config.html#a349d1c9bc5117f50ce61d08d0fc40a22" title="Bus name.">config::BusName_PROP_KEY</a>,<span class="stringliteral">&quot;/test-bus&quot;</span>);</div>
<div class="line">prop.setProperty(<a class="code" href="namespacespdr_1_1config.html#a9eeaad1234bceacae759d769e44076a1" title="Node&#39;s network interfaces (IP address) and their network-ID.">config::NetworkInterface_PROP_KEY</a>,<span class="stringliteral">&quot;10.0.0.5, Scope1&quot;</span>);</div>
<div class="line">prop.setProperty(<a class="code" href="namespacespdr_1_1config.html#acc7ede5b9ec44de49325afb079aa2272" title="TCP Receiver port.">config::TCPReceiverPort_PROP_KEY</a>,<span class="stringliteral">&quot;34561&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//create a bootstrap set with two other nodes</span></div>
<div class="line">std::vector&lt;NodeID_SPtr &gt; bootstrap_set;</div>
<div class="line"><a class="code" href="namespacespdr.html#acfb3849e5f7b7ffbc63e4ef2cb11a9f6" title="A shared pointer to a NodeID.">NodeID_SPtr</a> id_CSPtr = factory.createNodeID_SPtr(</div>
<div class="line">   <span class="stringliteral">&quot;node2, 10.0.0.6, Scope1, 34561&quot;</span>);</div>
<div class="line">bootstrap_set.push_back(id_CSPtr);</div>
<div class="line">id_CSPtr = factory.createNodeID_SPtr(</div>
<div class="line">   <span class="stringliteral">&quot;node3, 10.0.0.7, Scope1, 34561&quot;</span>);</div>
<div class="line">bootstrap_set.push_back(id_CSPtr);</div>
<div class="line"></div>
<div class="line"><span class="comment">//create the configuration object</span></div>
<div class="line"><a class="code" href="namespacespdr.html#a0749d284effc353e30e02acaa94f764c" title="A shared pointer to a SpiderCastConfig instance.">SpiderCastConfig_SPtr</a> spidercastConfig_SPtr =</div>
<div class="line">   factory.createSpiderCastConfig(prop, bootstrap_set);</div>
<div class="line"></div>
<div class="line"><span class="comment">//create a simple event listener implementation</span></div>
<div class="line">SpiderCastEventListenerPrintStub eventListener;</div>
<div class="line"></div>
<div class="line"><span class="comment">//create the SpiderCast node</span></div>
<div class="line"><a class="code" href="namespacespdr.html#ac5d9127c0ec2a0e02e5784813f171013" title="A shared pointer to a SpiderCast instance.">SpiderCast_SPtr</a> spidercast_SPtr = factory.createSpiderCast(</div>
<div class="line">   *spidercastConfig_SPtr,eventListener);</div>
<div class="line"><span class="comment">//and start it</span></div>
<div class="line">spidercast_SPtr-&gt;start();</div>
<div class="line"><span class="comment">//the node now joins the overlay, let it run for a while</span></div>
<div class="line">boost::this_thread::sleep(boost::posix_time::seconds(60));</div>
<div class="line"><span class="comment">//and close it</span></div>
<div class="line">spidercast_SPtr-&gt;close(<span class="keyword">true</span>);</div>
</div><!-- fragment --><p>The simple implementation of the SpiderCastEventListener is the following.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>SpiderCastEventListenerPrintStub : <span class="keyword">public</span> SpiderCastEventListener {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  SpiderCastEventListenerPrintStub() {}</div>
<div class="line">  ~SpiderCastEventListenerPrintStub() {}</div>
<div class="line">  <span class="comment">//the event handler just prints</span></div>
<div class="line">  <span class="keywordtype">void</span> onEvent(<span class="keyword">const</span> boost::shared_ptr&lt;event::SpiderCastEvent&gt; event) {</div>
<div class="line">    <span class="keywordflow">if</span> (event) {</div>
<div class="line">      std::cout &lt;&lt; <span class="keyword">event</span>-&gt;toString() &lt;&lt; std::endl;</div>
<div class="line">      <span class="keywordflow">switch</span> (event-&gt;getType()) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="namespacespdr_1_1event.html#a76f4860bbc41c8251a073d91e633546eab985068e79b458b4c7891e701e8d1ade" title="Fatal Error (error events)">event::Fatal_Error</a>:</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Opps... fatal error...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Some other event...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;event is null, this can&#39;t be good...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p>Note that these code snippets avoid some boiler-plate code and error paths.</p>
<hr/>
 <a class="el" href="mem_service_page.html">Next</a>: The Membership Service </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 30 2012 15:33:38 for SpiderCast C++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
