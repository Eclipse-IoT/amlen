pipeline {
    agent any
    
    stages {
        stage('Init') {
            steps {
                script {
                    if (env.BUILD_LABEL == null ) {
                        env.BUILD_LABEL = sh(script: "date +%Y%m%d-%H%M", returnStdout: true).toString().trim() +"_eclipse"
                    }
                }
                echo "In BuildAll Init, BUILD_LABEL is ${env.BUILD_LABEL}"    
            }
        }
        stage('BuildFanOut') {
            steps {
                echo "In BuildFanout, BUILD_LABEL is ${env.BUILD_LABEL}"
                
                sh '''
                   echo "JON pwd"
                   pwd
                   echo "JON ls in curr dir"
                   ls -ltr
                   echo "JON ls in parent dir"
                   ls -ltr ..
                '''
                
                //Build the default distro (centos7)
                //script {
                //    build job: 'Jenkinsfile'
                //}
                build job: 'CentOS7Build'
                //Build other distros
                script {
                    build job: 'server_build/buildcontainer/Jenkinsfile.alma8'
                }
                script {
                    build job: 'server_build/buildcontainer/Jenkinsfile.fedora'
                }
            }
        }
    }
}
