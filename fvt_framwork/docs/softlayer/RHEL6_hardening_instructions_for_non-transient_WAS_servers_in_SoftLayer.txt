1) Update to latest RHEL 6 (later may change OS to Centos 7): yum -y update

2) Disable external ssh logins for all users besides root by adding the following to the /etc/ssh/sshd_config:

PermitRootLogin no
DenyUsers mqm db2inst1 db2fenc1 dasusr1 autowebuiuser1 autowebuiuser2 autowebuiuser3 autowebuiuser4
Match Address 10.*,127.0.0.1
        PermitRootLogin yes
        
(We will have to wait and see if that breaks AF.)

3) Stop STAF and unmount /staf

4) Remove all the ssh keys in /root/.ssh

cd /root/.ssh; rm -f id_sample_harness_sshkey imaCA.crt imaCA.key imaCA.srl rootCA.crt rootCA.key rootCA.srl testserver.crt testserver.csr testserver.key

5) Disable the ability to login over ssh with a password, by adding the following to /etc/ssh/sshd_config and restarting sshd:

# To disable tunneled clear text passwords, change to no here!
#PasswordAuthentication yes
#PermitEmptyPasswords no
PasswordAuthentication no

# Change to no to disable s/key passwords
#ChallengeResponseAuthentication yes
ChallengeResponseAuthentication no
PubkeyAuthentication yes
AuthorizedKeysFile      .ssh/authorized_keys

6) Comment out the /etc/sysconfig/vnservers file:

#VNCSERVERS="0:root"
#VNCSERVERARGS[2]="-geometry 1280x1024 -nolisten tcp -localhost"
#VNCSERVERS="0:root 1:autowebuiuser1 2:autowebuiuser2 3:autowebuiuser3 4:autowebuiuser4"
#VNCSERVERS="0:root 1:root 2:root 3:root 4:root"
#VNCSERVERARGS[0]="-geometry 1280x1024"
#VNCSERVERARGS[1]="-geometry 1024x768 -interface <machine_ip_address>"
#VNCSERVERARGS[2]="-geometry 1024x768 -interface <machine_ip_address>"
#VNCSERVERARGS[3]="-geometry 1024x768 -interface <machine_ip_address>"
#VNCSERVERARGS[4]="-geometry 1024x768 -interface <machine_ip_address>"

7) Configure iptables by adding the following to /etc/sysconfig/iptables:

*filter
:FORWARD DROP [0:0]
:INPUT DROP [0:0]
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p udp -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m tcp --dport 113 -j REJECT --reject-with icmp-port-unreachable
-A INPUT -i eth0 -p tcp --dport 6500 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 6550 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 53 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 53 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 4 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 11 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 12 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 9 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT
-A INPUT -m state --state NEW -m udp -p udp --dport 52311 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 4949 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 389 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 1424 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 1415 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 10050 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 10051 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 50000 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 48000 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 48001 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 48002 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 9443 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 9060 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 9100 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 8880 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 9043 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 9080 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 2809 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 9402 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport 9403 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 67:68 -j DROP
-A INPUT -p udp -m udp --dport 67:68 -j DROP
-A INPUT -p tcp -m tcp --dport 137 -j DROP
-A INPUT -p udp -m udp --dport 137 -j DROP
-A INPUT -p tcp -m tcp --dport 138 -j DROP
-A INPUT -p udp -m udp --dport 138 -j DROP
-A INPUT -p tcp -m tcp --dport 139 -j DROP
-A INPUT -p udp -m udp --dport 139 -j DROP
-A INPUT -p tcp -m tcp --dport 1:20 -j DROP
-A INPUT -p tcp -m tcp --dport 111 -j DROP
-A INPUT -p tcp -m tcp --dport 161:162 -j DROP
-A INPUT -p tcp -m tcp --dport 520 -j DROP
-A INPUT -p tcp -m tcp --dport 6348:6349 -j DROP
-A INPUT -p tcp -m tcp --dport 6345:6347 -j DROP
-A INPUT -p tcp -m limit --limit 3/min -j LOG --log-prefix "FIREWALL: " --log-level 6
-A INPUT -p udp -m limit --limit 3/min -j LOG --log-prefix "FIREWALL: " --log-level 6
-A INPUT -j DROP

COMMIT
---

Then enable and start the service:

service iptables start
chkconfig iptables on

8) Cleaned up old logs we don't need wasting space and could provide info to attackers (/var/log, /var/mail/root etc)
